
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Final Project: Data visualisation and analysis of social responsibilities of global warming in terms of CO2 emissions and average temperature &#8212; Climate change in CO2 emissions</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo2.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Climate change in CO2 emissions</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Welcome to your Jupyter Book
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="markdown.html">
   Markdown Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="CO2.html">
   <strong>
    CO2 emissions and climate change
   </strong>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="notebooks.html">
   Content with notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markdown-notebooks.html">
   Notebooks with MyST Markdown
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="CO2%20-%20Responsibility.html">
   Who is reposible for the increase in CO2 emissions?
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/Project_B.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FProject_B.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/Project_B.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Final Project: Data visualisation and analysis of social responsibilities of global warming in terms of CO2 emissions and average temperature
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#by-kathrine-schultz-nielsen-s183929-david-ribberholt-ipsen-s164522-hanlu-he-s183909">
     <em>
      by Kathrine Schultz-Nielsen (s183929), David Ribberholt Ipsen (s164522), Hanlu He (s183909)
     </em>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#course-02806-social-data-analysis-and-visualization-spring-2022-br-course-responsible-sune-lehmann-jorgensen-br-dtu-technical-university-of-denmark">
   <em>
    Course: 02806 -
    <strong>
     Social data analysis and visualization spring 2022
    </strong>
   </em>
   <br/>
   <em>
    Course responsible:
    <strong>
     Sune Lehmann Jørgensen
    </strong>
   </em>
   <br/>
   <em>
    DTU -
    <strong>
     Technical University of Denmark
    </strong>
   </em>
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of Contents:
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction-and-motivation">
   1. Introduction and Motivation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-main-steps-of-this-project-will-involve">
     <strong>
      The main steps of this project will involve:
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dataset-segmentation-and-cleaning">
   2. Dataset segmentation and cleaning
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stage-1-filtering-subsetting-from-the-full-10gb-dataset">
     2.1. Stage 1: Filtering &amp; subsetting from the full 10GB+ dataset
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stage-1-1-loading-the-business-dataframe">
       2.1.1. Stage 1.1: Loading the
       <code class="docutils literal notranslate">
        <span class="pre">
         business
        </span>
       </code>
       dataframe:
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stage-1-2-subsetting-the-business-dataframe-for-las-vegas-data">
       2.1.2. Stage 1.2: Subsetting the
       <code class="docutils literal notranslate">
        <span class="pre">
         business
        </span>
       </code>
       dataframe for
       <strong>
        Las Vegas
       </strong>
       data:
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stage-1-3-subsetting-the-reviews-dataframe-for-las-vegas-data">
       2.1.3. Stage 1.3: Subsetting the
       <code class="docutils literal notranslate">
        <span class="pre">
         reviews
        </span>
       </code>
       dataframe for
       <strong>
        Las Vegas
       </strong>
       data:
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stage-1-4-subsetting-the-checkins-dataframe-for-las-vegas-data">
       2.1.4. Stage 1.4: Subsetting the
       <code class="docutils literal notranslate">
        <span class="pre">
         checkins
        </span>
       </code>
       dataframe for
       <strong>
        Las Vegas
       </strong>
       data:
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stage-1-5-subsetting-the-tips-dataframe-for-las-vegas-data">
       2.1.5. Stage 1.5: Subsetting the
       <code class="docutils literal notranslate">
        <span class="pre">
         tips
        </span>
       </code>
       dataframe for
       <strong>
        Las Vegas
       </strong>
       data:
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stage-1-6-subsetting-the-users-dataframe-for-las-vegas-data">
       2.1.6. Stage 1.6: Subsetting the
       <code class="docutils literal notranslate">
        <span class="pre">
         users
        </span>
       </code>
       dataframe for
       <strong>
        Las Vegas
       </strong>
       data:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stage-2-performing-data-cleaning-on-the-business-dataframe">
     2.2. Stage 2: Performing data cleaning on the
     <code class="docutils literal notranslate">
      <span class="pre">
       business
      </span>
     </code>
     dataframe
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stage-2-1-cleaning-the-attributes-column">
       2.2.1. Stage 2.1: Cleaning the
       <code class="docutils literal notranslate">
        <span class="pre">
         attributes
        </span>
       </code>
       column:
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stage-2-2-cleaning-the-hours-column">
       2.2.2. Stage 2.2: Cleaning the
       <code class="docutils literal notranslate">
        <span class="pre">
         hours
        </span>
       </code>
       column:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filtering-the-dataset-by-geographic-location-and-business-category">
     2.3. Filtering the dataset by geographic location and business category
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#descriptive-statistics-about-the-dataset">
   3. Descriptive statistics about the dataset
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-apparent-problem-the-earth-is-heating-up">
   4. The apparent problem: The Earth is heating up
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-causing-global-warming">
   5.  What is Causing global warming?
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wealth-gdp">
     5.1. Wealth (GDP)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#energy-consumption">
     5.2. Energy consumption
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#population-growth">
     5.3. Population growth
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#urbanisation">
     5.4. Urbanisation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#foreign-investments">
     5.5. Foreign investments
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#who-takes-the-responsibility">
   6. Who takes the responsibility?
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#looking-into-the-future">
   7. Looking into the future
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finding-the-sentiment-trends">
     7.1. Finding the sentiment trends
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#temporal-sentiment-geomapping">
     7.2. Temporal sentiment geomapping
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#geomap-of-the-overall-sentiment-score">
       7.2.1.  Geomap of the overall sentiment score
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#seasonal-temporal-map-based-on-yearly-quarters">
       7.2.2. Seasonal temporal map (based on yearly quarters)
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#time-of-day-temporal-map">
       7.2.3. Time-of-day temporal map
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#discussion">
   8. Discussion
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#contributions">
   9. Contributions
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Final Project: Data visualisation and analysis of social responsibilities of global warming in terms of CO2 emissions and average temperature</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Final Project: Data visualisation and analysis of social responsibilities of global warming in terms of CO2 emissions and average temperature
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#by-kathrine-schultz-nielsen-s183929-david-ribberholt-ipsen-s164522-hanlu-he-s183909">
     <em>
      by Kathrine Schultz-Nielsen (s183929), David Ribberholt Ipsen (s164522), Hanlu He (s183909)
     </em>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#course-02806-social-data-analysis-and-visualization-spring-2022-br-course-responsible-sune-lehmann-jorgensen-br-dtu-technical-university-of-denmark">
   <em>
    Course: 02806 -
    <strong>
     Social data analysis and visualization spring 2022
    </strong>
   </em>
   <br/>
   <em>
    Course responsible:
    <strong>
     Sune Lehmann Jørgensen
    </strong>
   </em>
   <br/>
   <em>
    DTU -
    <strong>
     Technical University of Denmark
    </strong>
   </em>
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of Contents:
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction-and-motivation">
   1. Introduction and Motivation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-main-steps-of-this-project-will-involve">
     <strong>
      The main steps of this project will involve:
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dataset-segmentation-and-cleaning">
   2. Dataset segmentation and cleaning
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stage-1-filtering-subsetting-from-the-full-10gb-dataset">
     2.1. Stage 1: Filtering &amp; subsetting from the full 10GB+ dataset
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stage-1-1-loading-the-business-dataframe">
       2.1.1. Stage 1.1: Loading the
       <code class="docutils literal notranslate">
        <span class="pre">
         business
        </span>
       </code>
       dataframe:
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stage-1-2-subsetting-the-business-dataframe-for-las-vegas-data">
       2.1.2. Stage 1.2: Subsetting the
       <code class="docutils literal notranslate">
        <span class="pre">
         business
        </span>
       </code>
       dataframe for
       <strong>
        Las Vegas
       </strong>
       data:
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stage-1-3-subsetting-the-reviews-dataframe-for-las-vegas-data">
       2.1.3. Stage 1.3: Subsetting the
       <code class="docutils literal notranslate">
        <span class="pre">
         reviews
        </span>
       </code>
       dataframe for
       <strong>
        Las Vegas
       </strong>
       data:
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stage-1-4-subsetting-the-checkins-dataframe-for-las-vegas-data">
       2.1.4. Stage 1.4: Subsetting the
       <code class="docutils literal notranslate">
        <span class="pre">
         checkins
        </span>
       </code>
       dataframe for
       <strong>
        Las Vegas
       </strong>
       data:
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stage-1-5-subsetting-the-tips-dataframe-for-las-vegas-data">
       2.1.5. Stage 1.5: Subsetting the
       <code class="docutils literal notranslate">
        <span class="pre">
         tips
        </span>
       </code>
       dataframe for
       <strong>
        Las Vegas
       </strong>
       data:
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stage-1-6-subsetting-the-users-dataframe-for-las-vegas-data">
       2.1.6. Stage 1.6: Subsetting the
       <code class="docutils literal notranslate">
        <span class="pre">
         users
        </span>
       </code>
       dataframe for
       <strong>
        Las Vegas
       </strong>
       data:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stage-2-performing-data-cleaning-on-the-business-dataframe">
     2.2. Stage 2: Performing data cleaning on the
     <code class="docutils literal notranslate">
      <span class="pre">
       business
      </span>
     </code>
     dataframe
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stage-2-1-cleaning-the-attributes-column">
       2.2.1. Stage 2.1: Cleaning the
       <code class="docutils literal notranslate">
        <span class="pre">
         attributes
        </span>
       </code>
       column:
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stage-2-2-cleaning-the-hours-column">
       2.2.2. Stage 2.2: Cleaning the
       <code class="docutils literal notranslate">
        <span class="pre">
         hours
        </span>
       </code>
       column:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filtering-the-dataset-by-geographic-location-and-business-category">
     2.3. Filtering the dataset by geographic location and business category
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#descriptive-statistics-about-the-dataset">
   3. Descriptive statistics about the dataset
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-apparent-problem-the-earth-is-heating-up">
   4. The apparent problem: The Earth is heating up
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-causing-global-warming">
   5.  What is Causing global warming?
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wealth-gdp">
     5.1. Wealth (GDP)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#energy-consumption">
     5.2. Energy consumption
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#population-growth">
     5.3. Population growth
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#urbanisation">
     5.4. Urbanisation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#foreign-investments">
     5.5. Foreign investments
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#who-takes-the-responsibility">
   6. Who takes the responsibility?
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#looking-into-the-future">
   7. Looking into the future
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finding-the-sentiment-trends">
     7.1. Finding the sentiment trends
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#temporal-sentiment-geomapping">
     7.2. Temporal sentiment geomapping
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#geomap-of-the-overall-sentiment-score">
       7.2.1.  Geomap of the overall sentiment score
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#seasonal-temporal-map-based-on-yearly-quarters">
       7.2.2. Seasonal temporal map (based on yearly quarters)
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#time-of-day-temporal-map">
       7.2.3. Time-of-day temporal map
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#discussion">
   8. Discussion
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#contributions">
   9. Contributions
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="final-project-data-visualisation-and-analysis-of-social-responsibilities-of-global-warming-in-terms-of-co2-emissions-and-average-temperature">
<h1>Final Project: Data visualisation and analysis of social responsibilities of global warming in terms of CO2 emissions and average temperature<a class="headerlink" href="#final-project-data-visualisation-and-analysis-of-social-responsibilities-of-global-warming-in-terms-of-co2-emissions-and-average-temperature" title="Permalink to this headline">¶</a></h1>
<div class="section" id="by-kathrine-schultz-nielsen-s183929-david-ribberholt-ipsen-s164522-hanlu-he-s183909">
<h2><em>by Kathrine Schultz-Nielsen (s183929), David Ribberholt Ipsen (s164522), Hanlu He (s183909)</em><a class="headerlink" href="#by-kathrine-schultz-nielsen-s183929-david-ribberholt-ipsen-s164522-hanlu-he-s183909" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
</div>
</div>
<div class="section" id="course-02806-social-data-analysis-and-visualization-spring-2022-br-course-responsible-sune-lehmann-jorgensen-br-dtu-technical-university-of-denmark">
<h1><em>Course: 02806 - <strong>Social data analysis and visualization spring 2022</strong></em> <br>
<em>Course responsible: <strong>Sune Lehmann Jørgensen</strong></em> <br>
<em>DTU - <strong>Technical University of Denmark</strong></em><a class="headerlink" href="#course-02806-social-data-analysis-and-visualization-spring-2022-br-course-responsible-sune-lehmann-jorgensen-br-dtu-technical-university-of-denmark" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="table-of-contents">
<h1>Table of Contents:<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="#1."><strong>Part 1: Introduction and Motivation</strong></a><br><br></p></li>
<li><p><a class="reference external" href="#2."><strong>Part 2: Dataset segmentation and cleaning</strong></a></p>
<ul>
<li><p><a class="reference external" href="#2.1.">2.1. <u>Stage 1: Filtering &amp; subsetting from the full 10GB+ dataset</u></a></p></li>
<li><p><a class="reference external" href="#2.2.">2.2. <u>Stage 2: Performing data cleaning on the ‘<em>business</em>’ dataframe</u></a></p></li>
<li><p><a class="reference external" href="#2.3.">2.3. <u>Filtering the dataset by geographic location and business category</u></a><br><br></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#3."><strong>Part 3: Descriptive statistics about the dataset</strong></a><br><br></p></li>
<li><p><a class="reference external" href="#4."><strong>Part 4: The apparent problem: The Earth is heating up</strong></a><br><br></p></li>
<li><p><a class="reference external" href="#5."><strong>Part 5: What is Causing global warming?</strong></a></p>
<ul>
<li><p><a class="reference external" href="#5.1.">5.1. <u>Wealth (GDP)</u></a></p></li>
<li><p><a class="reference external" href="#5.2.">5.2. <u>Energy consumption</u></a></p></li>
<li><p><a class="reference external" href="#5.3.">5.3. <u>Population growth</u></a></p></li>
<li><p><a class="reference external" href="#5.4.">5.4. <u>(Urbanisation)</u></a></p></li>
<li><p><a class="reference external" href="#5.5.">5.5. <u>(Foreign investments)</u></a><br><br></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#6."><strong>Part 6: Who is responsible?</strong></a><br><br></p></li>
<li><p><a class="reference external" href="#7."><strong>Part 7: Looking into the future</strong></a></p>
<ul>
<li><p><a class="reference external" href="#7.1.">7.1. <u></u></a></p></li>
<li><p><a class="reference external" href="#7.2.">7.2. <u></u></a><br><br></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#8."><strong>Part 8: Discussion</strong></a><br><br></p></li>
<li><p><a class="reference external" href="#9."><strong>Part 9: Contributions</strong></a><br><br></p></li>
</ul>
<hr class="docutils" />
<p><a id='1.'></a></p>
</div>
<div class="section" id="introduction-and-motivation">
<h1>1. Introduction and Motivation<a class="headerlink" href="#introduction-and-motivation" title="Permalink to this headline">¶</a></h1>
<p>Climate change is</p>
<p>The <em><strong>Yelp</strong></em> online service is an application which stores, aggregates and displays crowdsourced reviews about businesses published in their internal database. One of main benefits of this service for its customers lies in the massive amounts of reviews which Yelp provides about a business, allowing its users to get an informed decision of whether a certain business fits their category of needs or not. However, when using the Web interface of the service, we have noticed some less-desired user experience choices, such as for example not setting a word limit to their reviews or only showing 10 businesses at a time on their comparison map. The lack of a review word limit has allowed reviews to become very generous in size, up to the point where it is difficult to get a quick overview about the performance of a business, since one is met by a “wall of text”.</p>
<p>We have decided to use Data Science to improve upon these points, by providing interactive visualizations for the set of Yelp-relevant businesses across a defined area, as well as analyse their (many and lengthy) reviews automatically using Natural Language Processing, in order to get an informed idea on the top businesses which exist in a chosen geographical region, where Yelp also operates and is active.</p>
<hr class="docutils" />
<p>The original dataset that we have selected to analyse this problem is the <a class="reference external" href="https://www.yelp.com/dataset">Yelp dataset</a>. This dataset contains a large subset of Yelp’s businesses, reviews, check-ins and user-related public anonymous data. It was originally created for the Kaggle <em>Yelp Dataset Challenge</em> which encouraged academics to conduct research or analysis on
the company’s subset of data and show their discoveries to the world.</p>
<p>The original <strong>Yelp Academic Dataset</strong> contains information about 1.637.138 reviews collected from 192.609 businesses across 10 metropolitan areas in multiple countries of the world. Since this dataset is extremely large to work with (containing <strong>10+ GB of data</strong>), we have subsetted the data further into <strong>one geographical area of interest: Las Vegas, US</strong>, and <strong>one business category: Hotels</strong>.</p>
<p>The reason for choosing Las Vegas as our geographical boundary is because it is the city in the dataset with most active Yelp user and business base, meaning that there is a large number of reviews and businesses signed up on the platform. Also, choosing Hotels was a choice of interest, since Las Vegas is famous for their 2-in-1 “Hotel &amp; Casino” buildings and for their good services, so we wanted to understand more about the Hotel landscape in such a dynamic environment.</p>
<hr class="docutils" />
<div class="section" id="the-main-steps-of-this-project-will-involve">
<h2><strong>The main steps of this project will involve:</strong><a class="headerlink" href="#the-main-steps-of-this-project-will-involve" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Segmenting the dataset and cleaning it</p>
<ul class="simple">
<li><p><span style="color:green"> We will segment businesses to only include Las Vegas hotels </span></p></li>
<li><p><span style="color:green"> We will segment reviews to only include the ones directly related to our business </span><br><br></p></li>
</ul>
</li>
<li><p>Finding the top most important keywords which define each Hotel business in part, using the TF-IDF metric</p>
<ul class="simple">
<li><p><span style="color:green"> The top keywords will be detected by analysing all the reviews of each business in part </span><br><br></p></li>
</ul>
</li>
<li><p>Create a network of connected businesses, both statically in a graph-like visualization, as well as a geomap plot of the businesses we are targetting</p>
<ul class="simple">
<li><p><span style="color:green"> Two nodes (i.e. businesses) will be connected if they have a top keyword in common </span></p></li>
<li><p><span style="color:green"> The weight of the edges will be dependent on the total number of top keywords that the businesses share in common </span><br><br></p></li>
</ul>
</li>
<li><p>Identify relevant communities/clusters within the Hotels dataset, and plot their properties in graph, dynamic, as well as temporal visualizations<br><br></p></li>
<li><p>Understand which businesses &amp; communities are seen most positively or negatively, and look into how the sentiments evolve over period of day and year</p>
<ul class="simple">
<li><p><span style="color:green"> This will be done firstly by performing sentiment analysis on the reviews of our dataset </span></p></li>
<li><p><span style="color:green"> Secondly, this involves detecting the temportal change in sentiments across businesses </span></p></li>
</ul>
</li>
</ol>
<hr class="docutils" />
<p><a id='2.'></a></p>
</div>
</div>
<div class="section" id="dataset-segmentation-and-cleaning">
<h1>2. Dataset segmentation and cleaning<a class="headerlink" href="#dataset-segmentation-and-cleaning" title="Permalink to this headline">¶</a></h1>
<p>Before we delve into the deeper analysis of this project, let us import all the necessary libraries for this project:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic libraries</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">itertools</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Network libraries</span>

<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">from</span> <span class="nn">fa2</span> <span class="kn">import</span> <span class="n">ForceAtlas2</span> <span class="k">as</span> <span class="n">FA2</span>
<span class="kn">import</span> <span class="nn">community</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">Input In [2],</span> in <span class="ni">&lt;cell line: 4&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Network libraries</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="kn">from</span> <span class="nn">fa2</span> <span class="kn">import</span> <span class="n">ForceAtlas2</span> <span class="k">as</span> <span class="n">FA2</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="kn">import</span> <span class="nn">community</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;fa2&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NLP libraries</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">from</span> <span class="nn">nltk</span> <span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="kn">from</span> <span class="nn">nltk.stem.porter</span> <span class="kn">import</span> <span class="n">PorterStemmer</span>
<span class="kn">from</span> <span class="nn">nltk.probability</span> <span class="kn">import</span> <span class="n">FreqDist</span>
<span class="kn">from</span> <span class="nn">wordcloud</span> <span class="kn">import</span> <span class="n">WordCloud</span><span class="p">,</span> <span class="n">ImageColorGenerator</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Topic modeling libraries</span>

<span class="kn">import</span> <span class="nn">gensim</span>
<span class="kn">from</span> <span class="nn">gensim</span> <span class="kn">import</span> <span class="n">corpora</span><span class="p">,</span> <span class="n">models</span>
<span class="kn">import</span> <span class="nn">pyLDAvis</span>
<span class="kn">import</span> <span class="nn">pyLDAvis.gensim</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display libraries</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">IFrame</span><span class="p">,</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span> <span class="k">as</span> <span class="n">disp</span><span class="p">,</span> <span class="n">HTML</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">widgets</span><span class="p">,</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">fixed</span><span class="p">,</span> <span class="n">interact_manual</span>
<span class="kn">import</span> <span class="nn">imageio</span>

<span class="kn">from</span> <span class="nn">plotly</span> <span class="kn">import</span> <span class="n">__version__</span>
<span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">plotly.figure_factory</span> <span class="k">as</span> <span class="nn">ff</span>
<span class="kn">import</span> <span class="nn">chart_studio.plotly</span> <span class="k">as</span> <span class="nn">py</span>
<span class="kn">import</span> <span class="nn">plotly.offline</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

<span class="n">pio</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="s1">&#39;notebook&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we will proceed in filtering, subsetting and cleaning the original full Yelp Academic Dataset, according to the flowchart schema below:</p>
<p><img alt="flowchart.png" src="attachment:flowchart.png" /></p>
<p><a id='2.1.'></a></p>
<div class="section" id="stage-1-filtering-subsetting-from-the-full-10gb-dataset">
<h2>2.1. Stage 1: Filtering &amp; subsetting from the full 10GB+ dataset<a class="headerlink" href="#stage-1-filtering-subsetting-from-the-full-10gb-dataset" title="Permalink to this headline">¶</a></h2>
<p><em>Here, we are filtering the 10GB+ original dataset into the subset selected specifically for our analysis, and saving the corresponding data subsets as individual CSV files:</em></p>
<p><a id='2.1.1.'></a></p>
<div class="section" id="stage-1-1-loading-the-business-dataframe">
<h3>2.1.1. Stage 1.1: Loading the <code class="docutils literal notranslate"><span class="pre">business</span></code> dataframe:<a class="headerlink" href="#stage-1-1-loading-the-business-dataframe" title="Permalink to this headline">¶</a></h3>
<p>First, we will load the dataframe containing all businesses in the Yelp dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yelp_all_businesses_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/yelp_academic_dataset_business.json&#39;</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let us check for the most proeminent cities within this dataset, meaning that they have most amount of businesses on the platform:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yelp_all_businesses_df</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Las Vegas               31631
Toronto                 20366
Phoenix                 20171
Charlotte               10422
Scottsdale               9342
                        ...  
Redding                     1
Woodbridge (Vaughan)        1
Columbus                    1
NEWMARKET (OT)              1
Moon Twp.                   1
Name: city, Length: 1251, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>We argue that, even though Yelp businesses are registered every day throughout major cities in the whole world, this is a subsetted dataset, which has been curated by Yelp for research purposes, and, in here, the city where most of the data is present is actually Las Vegas in Nevada, USA.</p>
<p>Since we want to have some substantial amount of analysis data, we want to select a city where Yelp is popular and where it is used actively. Therefore, we will use Las Vegas as the target city where we will do our analysis in.</p>
<p><a id='2.1.2.'></a></p>
</div>
<div class="section" id="stage-1-2-subsetting-the-business-dataframe-for-las-vegas-data">
<h3>2.1.2. Stage 1.2: Subsetting the <code class="docutils literal notranslate"><span class="pre">business</span></code> dataframe for <strong>Las Vegas</strong> data:<a class="headerlink" href="#stage-1-2-subsetting-the-business-dataframe-for-las-vegas-data" title="Permalink to this headline">¶</a></h3>
<p>We are now interested in focusing our analysis on a specific city chosen for this project: <strong>Las Vegas</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_business_las_vegas_df</span> <span class="o">=</span> <span class="n">yelp_all_businesses_df</span><span class="p">[</span><span class="n">yelp_all_businesses_df</span><span class="o">.</span><span class="n">city</span> <span class="o">==</span> <span class="s1">&#39;Las Vegas&#39;</span><span class="p">]</span>

<span class="c1"># We want to drop businesses without any categories, since we won&#39;t be able to filter after them anyway</span>
<span class="n">all_business_las_vegas_df</span> <span class="o">=</span> <span class="n">all_business_las_vegas_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">all_business_las_vegas_df</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We would like to save a dataset relative to all the <em><strong>Hotels</strong></em> in Las Vegas, in order to use it for review analysis and network creation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hotels_las_vegas_df</span> <span class="o">=</span> <span class="n">all_business_las_vegas_df</span><span class="p">[</span><span class="n">all_business_las_vegas_df</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Hotels&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we need to retrieve the ID list of all the Hotels in Las Vegas, in order to subset the subsequent datasets by business ID:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">business_ids_all_business_las_vegas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_business_las_vegas_df</span><span class="o">.</span><span class="n">business_id</span><span class="p">)</span>
<span class="n">business_ids_hotels_las_vegas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hotels_las_vegas_df</span><span class="o">.</span><span class="n">business_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, let us save the subsetted business dataset into its own CSV file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_business_las_vegas_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/las_vegas_all_business.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">hotels_las_vegas_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/las_vegas_hotel_business.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">yelp_all_businesses_df</span>
<span class="k">del</span> <span class="n">all_business_las_vegas_df</span>
<span class="k">del</span> <span class="n">hotels_las_vegas_df</span>
</pre></div>
</div>
</div>
</div>
<p><a id='2.1.3.'></a></p>
</div>
<div class="section" id="stage-1-3-subsetting-the-reviews-dataframe-for-las-vegas-data">
<h3>2.1.3. Stage 1.3: Subsetting the <code class="docutils literal notranslate"><span class="pre">reviews</span></code> dataframe for <strong>Las Vegas</strong> data:<a class="headerlink" href="#stage-1-3-subsetting-the-reviews-dataframe-for-las-vegas-data" title="Permalink to this headline">¶</a></h3>
<p>The <em>reviews</em> JSON file is very large (1.5GB+), and often is bound to give memory errors when trying to read it directly from using the specialized <code class="docutils literal notranslate"><span class="pre">read_json</span></code> functions of <code class="docutils literal notranslate"><span class="pre">pandas</span></code> or <code class="docutils literal notranslate"><span class="pre">dask</span></code>. Therefore, we need a more Python-traditional approach:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/yelp_academic_dataset_review.json&#39;</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
    
<span class="n">yelp_all_reviews_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>After we are able to load the data, we will filter the reviews and only keep the ones relevant to Las Vegas, in order to diminish its heavy memory consumption.</p>
<p>Initially, we will filter by all reviews relevant to all businesses in <strong>Las Vegas</strong>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_reviews_las_vegas_df</span> <span class="o">=</span> <span class="n">yelp_all_reviews_df</span><span class="p">[</span><span class="n">yelp_all_reviews_df</span><span class="o">.</span><span class="n">business_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">business_ids_all_business_las_vegas</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we will also filter the reviews of hotels in Las Vegas:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hotels_reviews_las_vegas_df</span> <span class="o">=</span> <span class="n">all_reviews_las_vegas_df</span><span class="p">[</span><span class="n">all_reviews_las_vegas_df</span><span class="o">.</span><span class="n">business_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">business_ids_hotels_las_vegas</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>Lastly, in order to filter the <code class="docutils literal notranslate"><span class="pre">Tips</span></code> and <code class="docutils literal notranslate"><span class="pre">Users</span></code> datasets, we will also store the IDs of the users writing all these reviews:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_ids_all_reviews_las_vegas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_reviews_las_vegas_df</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
<span class="n">user_ids_hotels_las_vegas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hotels_reviews_las_vegas_df</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let us save these 2 datasets for analysis at a later stage:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_reviews_las_vegas_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/las_vegas_all_reviews.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">hotels_reviews_las_vegas_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/las_vegas_hotel_reviews.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">yelp_all_reviews_df</span>
<span class="k">del</span> <span class="n">all_reviews_las_vegas_df</span>
<span class="k">del</span> <span class="n">hotels_reviews_las_vegas_df</span>
</pre></div>
</div>
</div>
</div>
<p><a id='2.1.4.'></a></p>
</div>
<div class="section" id="stage-1-4-subsetting-the-checkins-dataframe-for-las-vegas-data">
<h3>2.1.4. Stage 1.4: Subsetting the <code class="docutils literal notranslate"><span class="pre">checkins</span></code> dataframe for <strong>Las Vegas</strong> data:<a class="headerlink" href="#stage-1-4-subsetting-the-checkins-dataframe-for-las-vegas-data" title="Permalink to this headline">¶</a></h3>
<p>Just like before, we will repeat identical steps for the <code class="docutils literal notranslate"><span class="pre">Checkins</span></code> dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yelp_all_checkins_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/yelp_academic_dataset_checkin.json&#39;</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">all_checkins_las_vegas_df</span> <span class="o">=</span> <span class="n">yelp_all_checkins_df</span><span class="p">[</span><span class="n">yelp_all_checkins_df</span><span class="o">.</span><span class="n">business_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">business_ids_all_business_las_vegas</span><span class="p">)]</span>
<span class="n">hotels_checkins_las_vegas_df</span> <span class="o">=</span> <span class="n">all_checkins_las_vegas_df</span><span class="p">[</span><span class="n">all_checkins_las_vegas_df</span><span class="o">.</span><span class="n">business_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">business_ids_hotels_las_vegas</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_checkins_las_vegas_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/las_vegas_all_checkins.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">hotels_checkins_las_vegas_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/las_vegas_hotel_checkins.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">yelp_all_checkins_df</span>
<span class="k">del</span> <span class="n">all_checkins_las_vegas_df</span>
<span class="k">del</span> <span class="n">hotels_checkins_las_vegas_df</span>
</pre></div>
</div>
</div>
</div>
<p><a id='2.1.5.'></a></p>
</div>
<div class="section" id="stage-1-5-subsetting-the-tips-dataframe-for-las-vegas-data">
<h3>2.1.5. Stage 1.5: Subsetting the <code class="docutils literal notranslate"><span class="pre">tips</span></code> dataframe for <strong>Las Vegas</strong> data:<a class="headerlink" href="#stage-1-5-subsetting-the-tips-dataframe-for-las-vegas-data" title="Permalink to this headline">¶</a></h3>
<p>The same steps will be used for the <code class="docutils literal notranslate"><span class="pre">Tips</span></code> dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yelp_all_tips_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/yelp_academic_dataset_tip.json&#39;</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">all_tips_las_vegas_df</span> <span class="o">=</span> <span class="n">yelp_all_tips_df</span><span class="p">[(</span><span class="n">yelp_all_tips_df</span><span class="o">.</span><span class="n">business_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">business_ids_all_business_las_vegas</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">yelp_all_tips_df</span><span class="o">.</span><span class="n">user_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">user_ids_all_reviews_las_vegas</span><span class="p">)))]</span>
<span class="n">hotels_tips_las_vegas_df</span> <span class="o">=</span> <span class="n">all_tips_las_vegas_df</span><span class="p">[(</span><span class="n">all_tips_las_vegas_df</span><span class="o">.</span><span class="n">business_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">business_ids_hotels_las_vegas</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">all_tips_las_vegas_df</span><span class="o">.</span><span class="n">user_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">user_ids_hotels_las_vegas</span><span class="p">))]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_tips_las_vegas_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/las_vegas_all_tips.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">hotels_tips_las_vegas_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/las_vegas_hotel_tips.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">yelp_all_tips_df</span>
<span class="k">del</span> <span class="n">all_tips_las_vegas_df</span>
<span class="k">del</span> <span class="n">hotels_tips_las_vegas_df</span>
</pre></div>
</div>
</div>
</div>
<p><a id='2.1.6.'></a></p>
</div>
<div class="section" id="stage-1-6-subsetting-the-users-dataframe-for-las-vegas-data">
<h3>2.1.6. Stage 1.6: Subsetting the <code class="docutils literal notranslate"><span class="pre">users</span></code> dataframe for <strong>Las Vegas</strong> data:<a class="headerlink" href="#stage-1-6-subsetting-the-users-dataframe-for-las-vegas-data" title="Permalink to this headline">¶</a></h3>
<p>Finally, precisely similar steps will also be used upon the <code class="docutils literal notranslate"><span class="pre">Users</span></code> dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/yelp_academic_dataset_user.json&#39;</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
    
<span class="n">yelp_all_users_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_users_las_vegas_df</span> <span class="o">=</span> <span class="n">yelp_all_users_df</span><span class="p">[</span><span class="n">yelp_all_users_df</span><span class="o">.</span><span class="n">user_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">user_ids_all_reviews_las_vegas</span><span class="p">)]</span>
<span class="n">hotels_users_las_vegas_df</span> <span class="o">=</span> <span class="n">all_users_las_vegas_df</span><span class="p">[</span><span class="n">all_users_las_vegas_df</span><span class="o">.</span><span class="n">user_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">user_ids_hotels_las_vegas</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_users_las_vegas_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/las_vegas_all_users.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">hotels_users_las_vegas_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/las_vegas_hotel_users.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">yelp_all_users_df</span>
<span class="k">del</span> <span class="n">all_users_las_vegas_df</span>
<span class="k">del</span> <span class="n">hotels_users_las_vegas_df</span>
</pre></div>
</div>
</div>
</div>
<p><a id='2.2.'></a></p>
</div>
</div>
<div class="section" id="stage-2-performing-data-cleaning-on-the-business-dataframe">
<h2>2.2. Stage 2: Performing data cleaning on the <code class="docutils literal notranslate"><span class="pre">business</span></code> dataframe<a class="headerlink" href="#stage-2-performing-data-cleaning-on-the-business-dataframe" title="Permalink to this headline">¶</a></h2>
<p>We need to read again the dataframes containing the businesses of Las Vegas, because we previously deleted them from memory, in order to make space for other operations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">las_vegas_all_business_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/las_vegas_all_business.csv&#39;</span><span class="p">)</span>
<span class="n">las_vegas_hotel_business_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/las_vegas_hotel_business.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id='2.2.1.'></a></p>
<div class="section" id="stage-2-1-cleaning-the-attributes-column">
<h3>2.2.1. Stage 2.1: Cleaning the <code class="docutils literal notranslate"><span class="pre">attributes</span></code> column:<a class="headerlink" href="#stage-2-1-cleaning-the-attributes-column" title="Permalink to this headline">¶</a></h3>
<p>Here, we will clean the <code class="docutils literal notranslate"><span class="pre">attributes</span></code> column into a JSON-parsable format:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">wrangle_attributes</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">attributes_data</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">attributes</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">attributes_data</span><span class="p">)):</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;attributes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">row</span>
        
    <span class="n">attributes_data</span> <span class="o">=</span> <span class="n">attributes_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">u</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">attributes_data</span> <span class="o">=</span> <span class="n">attributes_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">attributes_data</span> <span class="o">=</span> <span class="n">attributes_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="n">attributes_data</span> <span class="o">=</span> <span class="n">attributes_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;{&#39;</span><span class="p">,</span> <span class="s1">&#39;{&#39;</span><span class="p">)</span>
    <span class="n">attributes_data</span> <span class="o">=</span> <span class="n">attributes_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span>
    <span class="n">attributes_data</span> <span class="o">=</span> <span class="n">attributes_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; False&#39;</span><span class="p">,</span> <span class="s1">&#39; &quot;False&quot;&#39;</span><span class="p">)</span>
    <span class="n">attributes_data</span> <span class="o">=</span> <span class="n">attributes_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; True&#39;</span><span class="p">,</span> <span class="s1">&#39; &quot;True&quot;&#39;</span><span class="p">)</span>
    <span class="n">attributes_data</span> <span class="o">=</span> <span class="n">attributes_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; None&#39;</span><span class="p">,</span> <span class="s1">&#39; &quot;None&quot;&#39;</span><span class="p">)</span>
    
    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;attributes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attributes_data</span>
    <span class="k">return</span> <span class="n">row</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we will apply the above-created function to each row in the datasets, using a <code class="docutils literal notranslate"><span class="pre">lambda</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">las_vegas_all_business_df</span> <span class="o">=</span> <span class="n">las_vegas_all_business_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">wrangle_attributes</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">las_vegas_hotel_business_df</span> <span class="o">=</span> <span class="n">las_vegas_hotel_business_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">wrangle_attributes</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id='2.2.2.'></a></p>
</div>
<div class="section" id="stage-2-2-cleaning-the-hours-column">
<h3>2.2.2. Stage 2.2: Cleaning the <code class="docutils literal notranslate"><span class="pre">hours</span></code> column:<a class="headerlink" href="#stage-2-2-cleaning-the-hours-column" title="Permalink to this headline">¶</a></h3>
<p>Next, we need to properly convert the <code class="docutils literal notranslate"><span class="pre">hours</span></code> column into a fixed and consistent hour format:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">wrangle_hours</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">hours_data</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">hours</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">hours_data</span><span class="p">)):</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;hours&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">row</span>
        
    <span class="n">hours_data</span> <span class="o">=</span> <span class="n">hours_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">hours_data</span> <span class="o">=</span> <span class="n">hours_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="n">hours_data</span> <span class="o">=</span> <span class="n">hours_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;{&#39;</span><span class="p">,</span> <span class="s1">&#39;{&#39;</span><span class="p">)</span>
    <span class="n">hours_data</span> <span class="o">=</span> <span class="n">hours_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span>
    <span class="n">hours_data</span> <span class="o">=</span> <span class="n">hours_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:0&#39;</span><span class="p">,</span> <span class="s1">&#39;:00&#39;</span><span class="p">)</span>
    
    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;hours&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hours_data</span>
    <span class="k">return</span> <span class="n">row</span>
</pre></div>
</div>
</div>
</div>
<p>Let us apply the time format conversion function to all necessary rows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">las_vegas_all_business_df</span> <span class="o">=</span> <span class="n">las_vegas_all_business_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">wrangle_hours</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">las_vegas_hotel_business_df</span> <span class="o">=</span> <span class="n">las_vegas_hotel_business_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">wrangle_hours</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Lastly, we will save our updated datasets in place of the un-wrangled ones:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">las_vegas_all_business_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/las_vegas_all_business.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">las_vegas_hotel_business_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;yelp_dataset/las_vegas_hotel_business.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id='2.3.'></a></p>
</div>
</div>
<div class="section" id="filtering-the-dataset-by-geographic-location-and-business-category">
<h2>2.3. Filtering the dataset by geographic location and business category<a class="headerlink" href="#filtering-the-dataset-by-geographic-location-and-business-category" title="Permalink to this headline">¶</a></h2>
<p>Let us remember that, previously, after every dataframe segmentation, we have deleted the dataframe from memory in order to free up resources for the subsequent parts of the cleaning process.</p>
<p>Therefore, now, let us reload only the dataframes which are of immediate interest, and, since we did not filter yet by either <em><strong>geographic location</strong></em> or <em><strong>business category</strong></em>, we will need to take care of that now.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">business_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./yelp_dataset/las_vegas_all_business.csv&#39;</span><span class="p">)</span>
<span class="n">review_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./yelp_dataset/las_vegas_all_reviews.csv&#39;</span><span class="p">)</span>
<span class="n">user_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./yelp_dataset/las_vegas_all_users.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here, we will filter data according to a specific kind of business category (<em>Hotels</em>, in this case). However, the dificulty here rises, since there are two category types which we can encounter:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Hotels</span> <span class="pre">&amp;</span> <span class="pre">Travel</span></code>, which are referring to any kind of business directly or indirectly relating to the Hotel industry, including also car rentals services or Spas.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Hotels</span></code>, which are referring specifically to the businesses providing lodging as an accredited Hotel. <strong>This business category is the only one that we are interested in.</strong></p></li>
</ol>
<p>Since one of the categories contains the name of the other, we have decided to solve this problem with the use of <em><strong>Regular Expressions</strong></em> for filtering the category:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter the business_id according to the &quot;Hotels&quot; category</span>
<span class="n">filter_business_id</span> <span class="o">=</span> <span class="n">business_df</span><span class="p">[</span><span class="n">business_df</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(Hotels, )|(, Hotels$)&quot;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">business_id</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we will re-update the business and review dataframes to only contain the filtered dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Update the business dataframe with only the relevant Hotel businesses</span>
<span class="n">business_df</span> <span class="o">=</span> <span class="n">business_df</span><span class="p">[</span><span class="n">business_df</span><span class="o">.</span><span class="n">business_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">filter_business_id</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> \
                        <span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;stars&#39;</span><span class="p">:</span> <span class="s1">&#39;stars_business&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter all the reviews based strictly on the &#39;business_id&#39; corresponding to a Hotel&#39;s business_id</span>
<span class="n">review_df</span> <span class="o">=</span> <span class="n">review_df</span><span class="p">[</span><span class="n">review_df</span><span class="o">.</span><span class="n">business_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">filter_business_id</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> \
                        <span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;stars&#39;</span><span class="p">:</span> <span class="s1">&#39;stars_review&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p><a id='3.'></a></p>
</div>
</div>
<div class="section" id="descriptive-statistics-about-the-dataset">
<h1>3. Descriptive statistics about the dataset<a class="headerlink" href="#descriptive-statistics-about-the-dataset" title="Permalink to this headline">¶</a></h1>
<p>After the full segmentation and cleaning has been performed, let us try to understand our dataset a little bit better. We will afterwards jump into the <strong>Text Analytics</strong> part for finding important top business keywords, so it is important to know how large a  scale does our analysis have to deal with.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The total number of unique businesses/hotels in our dataset is:&#39;</span><span class="p">,</span> <span class="n">business_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The total number of unique businesses/hotels in our dataset is: 438
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">business_df</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">memory_usage</span> <span class="o">=</span> <span class="s1">&#39;deep&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 438 entries, 0 to 437
Data columns (total 14 columns):
 #   Column        Non-Null Count  Dtype  
---  ------        --------------  -----  
 0   business_id   438 non-null    object 
 1   name          438 non-null    object 
 2   address       432 non-null    object 
 3   city          438 non-null    object 
 4   state         438 non-null    object 
 5   postal_code   438 non-null    float64
 6   latitude      438 non-null    float64
 7   longitude     438 non-null    float64
 8   stars         438 non-null    float64
 9   review_count  438 non-null    int64  
 10  is_open       438 non-null    int64  
 11  attributes    438 non-null    object 
 12  categories    438 non-null    object 
 13  hours         438 non-null    object 
dtypes: float64(4), int64(2), object(8)
memory usage: 452.7 KB
</pre></div>
</div>
</div>
</div>
<p>It seems that our Hotels dataframe contains <strong>438 unique businesses</strong>, which will also be the starting nodes for our network analysis graph later on. The dataframe uses about ~450 KB of memory, since we have filtered the dataset appropriately until we now a compact dataframe. The original <code class="docutils literal notranslate"><span class="pre">all_business</span></code> dataframe was requiring 20.3 MB of memory, which would not be a problem either.</p>
<p>The real challenge is working upon the large Reviews dataframe, since the original size of the <code class="docutils literal notranslate"><span class="pre">all_reviews</span></code> file was 1.6 GB alone. Let us see how many relevant reviews are we working with, and how large is our current dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The total number of unique reviews (relating to the hotel businesses in our dataset) is:&#39;</span><span class="p">,</span> <span class="n">review_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The total number of unique reviews (relating to the hotel businesses in our dataset) is: 172159
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">review_df</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">memory_usage</span> <span class="o">=</span> <span class="s1">&#39;deep&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 172159 entries, 0 to 172158
Data columns (total 9 columns):
 #   Column       Non-Null Count   Dtype  
---  ------       --------------   -----  
 0   review_id    172159 non-null  object 
 1   user_id      172159 non-null  object 
 2   business_id  172159 non-null  object 
 3   stars        172159 non-null  float64
 4   useful       172159 non-null  int64  
 5   funny        172159 non-null  int64  
 6   cool         172159 non-null  int64  
 7   text         172159 non-null  object 
 8   date         172159 non-null  object 
dtypes: float64(1), int64(3), object(5)
memory usage: 208.1 MB
</pre></div>
</div>
</div>
</div>
<p>As we can see from the memory usage footprint, the Reviews dataframe has also been reduced significantly in size to only 12.5% of the original size, while the number of reviews we will be analyzing is kept at a larger scale. This is really relevant, since more reviews will allow us to extract the important features when doing: <strong>keyword detection, topic modeling, sentiment analysis</strong>.</p>
<p>The network graph is highly dependent on the NLP analysis we will perform next. The nodes in our network will be connected depending on the amount of top keywords which their aggregated reviews have in common, therefore we cannot give a direct estimation of the number of edges in the network just yet.</p>
<p>Let us move onwards to the TFIDF-powered keyword detection, in order to identify what kind of keywords are best representing each Hotel business, and what makes the businesses “stand out”.</p>
<hr class="docutils" />
<p><a id='4.'></a></p>
</div>
<div class="section" id="the-apparent-problem-the-earth-is-heating-up">
<h1>4. The apparent problem: The Earth is heating up<a class="headerlink" href="#the-apparent-problem-the-earth-is-heating-up" title="Permalink to this headline">¶</a></h1>
<p>Before we can analyze the aggregated reviews for each unique business, we would like to perform a JOIN operation on the <code class="docutils literal notranslate"><span class="pre">reviews</span></code> and the <code class="docutils literal notranslate"><span class="pre">business</span></code> dataframes, so that every review will also have metadata about the actual business that it is linked to.</p>
<p>Since the <code class="docutils literal notranslate"><span class="pre">reviews</span></code> and the <code class="docutils literal notranslate"><span class="pre">business</span></code> dataframes share the common attribute <code class="docutils literal notranslate"><span class="pre">business_id</span></code>, we can JOIN the two tables/dataframes on that variable:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">business_review_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">business_df</span><span class="p">,</span> <span class="n">review_df</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;business_id&#39;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;outer&#39;</span><span class="p">)</span>
<span class="n">business_review_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>business_id</th>
      <th>name</th>
      <th>address</th>
      <th>city</th>
      <th>state</th>
      <th>postal_code</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>stars_x</th>
      <th>review_count</th>
      <th>...</th>
      <th>categories</th>
      <th>hours</th>
      <th>review_id</th>
      <th>user_id</th>
      <th>stars_y</th>
      <th>useful</th>
      <th>funny</th>
      <th>cool</th>
      <th>text</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>izw7OBVSeNmlVhjly1amQg</td>
      <td>Wyndham Vacation Ownership</td>
      <td>3475 Las Vegas Blvd S</td>
      <td>Las Vegas</td>
      <td>NV</td>
      <td>89109.0</td>
      <td>36.119725</td>
      <td>-115.172396</td>
      <td>1.5</td>
      <td>154</td>
      <td>...</td>
      <td>Hotels &amp; Travel, Hotels, Event Planning &amp; Serv...</td>
      <td>{}</td>
      <td>h4mPmRnFUgekEvtbvXMeWw</td>
      <td>ANGEDyzIN7xlEOdxe5U5Wg</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Went to the presentation and spent 4 hours the...</td>
      <td>2018-06-19 18:13:32</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 22 columns</p>
</div></div></div>
</div>
<p>When tokenizing the text of the reviews, we have performed multiple tests, and since we are dealing with user-written reviews of amenities they might have strong opinions on, the most important parts of speech for our analysis are: <em><strong>adjectives</strong></em>. More specifically, the NLTK algorithm will consider an adjective to be any word which directly precedes a noun. A list of English nouns is predefined in their models.</p>
<p>Therefore, in order to remove neutral words and enhance the understanding of the customers’ feelings towards hotels, the full text in a review has been tokenized and cleaned, yet only the adjectives in such a review have been extracted.</p>
<p>Also, since this decision has been made, we have also opted for not lemmatizing our wordset, since adjectives normally only have 1 single form of conjugating, therefore lemmatizing would be an unnecessary process for us.</p>
<p>The function below is responsible for the text parsing and cleaning, including operations such as:</p>
<ul class="simple">
<li><p>Tokenizing (separating long text into words/tokens)</p></li>
<li><p>Removing punctuation and non-alphanumeric characters</p></li>
<li><p>Removing stopwords (very frequenct English auxiliary words with no meaningful value)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function for tokenizing the text into a list of words</span>

<span class="k">def</span> <span class="nf">tokenize_text</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># Replace all the non-alphanumeric characters with space</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\W]&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    
    <span class="c1"># Function to test if something is an adjective</span>
    <span class="n">is_adj</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">pos</span><span class="p">:</span> <span class="n">pos</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;JJ&#39;</span><span class="p">)</span>

    <span class="c1"># Tokenize texts into lists of tokens</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">word_tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>    
   
    <span class="n">stop_words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">))</span>
    
    <span class="c1"># Remove punctuation and set words to lowercase</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">]</span>
    
    <span class="c1"># Remove stopwords and letters (stopwords are lowercase, so this step should be done after word.lower())</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span>
                 <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop_words</span>
                 <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>    
    
    <span class="c1"># Keep adjectives only</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span> <span class="ow">in</span> <span class="n">nltk</span><span class="o">.</span><span class="n">pos_tag</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_adj</span><span class="p">(</span><span class="n">pos</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">words</span>
</pre></div>
</div>
</div>
</div>
<p>The function below has been written for two purposes:</p>
<ol class="simple">
<li><p>For a specific business, it concatenates all the individual reviews into one large string</p></li>
<li><p>For a specific community, (which we will discuss later in the Network Analysis part), it will concatenate all the reviews from businesses belonging to a community into one large string</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reviews</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">dict_communities</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;community&#39;</span><span class="p">:</span>
        <span class="c1"># Create a dictionary for storing text of each community</span>
        <span class="n">community_reviews</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">comm</span> <span class="ow">in</span> <span class="n">dict_communities</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">community_text</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
            <span class="k">for</span> <span class="n">business_id</span> <span class="ow">in</span> <span class="n">dict_communities</span><span class="p">[</span><span class="n">comm</span><span class="p">]:</span>
                <span class="n">business_text</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">business_id</span> <span class="o">==</span> <span class="n">business_id</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="n">community_text</span> <span class="o">+=</span> <span class="n">business_text</span>
                
            <span class="n">community_reviews</span><span class="p">[</span><span class="n">comm</span><span class="p">]</span> <span class="o">=</span> <span class="n">community_text</span>
            
        <span class="k">return</span> <span class="n">community_reviews</span>
      
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;business&#39;</span><span class="p">:</span>
        <span class="c1"># For each business, find its reviews</span>
        <span class="n">business_reviews</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">business_id</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">business_id</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>      
            <span class="c1"># Concatenate all reviews of a specific business into one text</span>
            <span class="n">business_text</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">business_id</span> <span class="o">==</span> <span class="n">business_id</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">business_reviews</span><span class="p">[</span><span class="n">business_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">business_text</span>
            
        <span class="k">return</span> <span class="n">business_reviews</span>
</pre></div>
</div>
</div>
</div>
<p>In the next code paragraphs, we create functions for calculating some of the most important NLP metrics for our review analysis: the TF score, the IDF score, and their combined TF-IDF metric upon the aggregated reviews for each unique Hotel.</p>
<p>First, we will define how to compute the Term Frequency for each word, which is simply a frequency count for each of the words.</p>
<p>From literature, we can find numerous ways of calculating the weights of terms which can be applied:</p>
<ul class="simple">
<li><p><strong>Raw count</strong>: This method simply counts the occurrence of each word.</p></li>
<li><p><strong>Term frequency</strong>: This method takes the total number of words of each document into account. For instance, if the counts of a word is high, but not high comparing to the total amount of words shown in a text, then this word is likely to not be too important.</p></li>
<li><p><strong>Log</strong>: This method uses the logarithm scale, which manages to shrink the difference of weights between highly frequent words and less frequent ones.</p></li>
<li><p><strong>Double normalization</strong>: This method aims to mitigate the case that we observe higher term frequencies in longer documents, merely because longer documents tend to repeat the same words over and over again.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function for computing TF (using different methods)</span>

<span class="k">def</span> <span class="nf">tf</span><span class="p">(</span><span class="n">reviews</span><span class="p">,</span> <span class="n">tf_method</span><span class="p">):</span>

    <span class="c1"># Create a nested dictionary {business: {word: tf score}} or {business: {word: tf score}} for storing term-frequency</span>
    <span class="n">term_frequency</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">comm</span><span class="p">,</span> <span class="n">review</span> <span class="ow">in</span> <span class="n">reviews</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Create a dictionary for each either community or business to store words and counts of words</span>
        <span class="n">term_frequency</span><span class="p">[</span><span class="n">comm</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Total word amount for one business (for tf_method==&#39;term_frequency&#39;)</span>
        <span class="n">total_word_amount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">review</span><span class="p">)</span>
        
        <span class="c1"># Tokenize the text into a list of words</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">tokenize_text</span><span class="p">(</span><span class="n">review</span><span class="p">)</span>
        
        <span class="c1"># Count words</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">term_frequency</span><span class="p">[</span><span class="n">comm</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">term_frequency</span><span class="p">[</span><span class="n">comm</span><span class="p">][</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">term_frequency</span><span class="p">[</span><span class="n">comm</span><span class="p">][</span><span class="n">word</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>       

        <span class="c1"># Compute different types of term frequency</span>
        <span class="k">if</span> <span class="n">tf_method</span> <span class="o">==</span> <span class="s1">&#39;raw_count&#39;</span><span class="p">:</span>
            <span class="n">term_frequency</span> <span class="o">=</span> <span class="n">term_frequency</span>

        <span class="k">elif</span> <span class="n">tf_method</span> <span class="o">==</span> <span class="s1">&#39;term_frequency&#39;</span><span class="p">:</span>
            <span class="n">term_frequency</span><span class="p">[</span><span class="n">comm</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span> <span class="p">:</span> <span class="n">v</span><span class="o">/</span><span class="n">total_word_amount</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">term_frequency</span><span class="p">[</span><span class="n">comm</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">elif</span> <span class="n">tf_method</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">term_frequency</span><span class="p">[</span><span class="n">comm</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span> <span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">term_frequency</span><span class="p">[</span><span class="n">comm</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">elif</span> <span class="n">tf_method</span> <span class="o">==</span> <span class="s1">&#39;double_normalization&#39;</span><span class="p">:</span>
            <span class="n">term_frequency</span><span class="p">[</span><span class="n">comm</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span> <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">v</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">term_frequency</span><span class="p">[</span><span class="n">comm</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">term_frequency</span><span class="p">[</span><span class="n">comm</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>        

    <span class="k">return</span> <span class="n">term_frequency</span>
</pre></div>
</div>
</div>
</div>
<p>For our further analysis, we chose to use the <em><strong><code class="docutils literal notranslate"><span class="pre">term</span> <span class="pre">frequency</span></code></strong></em> calculation method for our scenarios, since it normalizes the original frequency (i.e. raw counts) by also considering the length of reviews.</p>
<p>This is very useful considering that the written reviews vary significantly in terms of their size and amount of words. In order to avoid words which would get high weights because they appear often in longer texts, the <code class="docutils literal notranslate"><span class="pre">term</span> <span class="pre">frequency</span></code> function will solve that problem by adjusting the score to the review length.</p>
<p>Next in our analysis, after the TF (Term Frequency) score is computed, we also need to define the computation of the IDF (Inverse Document Frequency) score, which measures how informative a word is across all the documents.</p>
<p>Here we will implement two ways of calculating IDF scores:</p>
<ul class="simple">
<li><p><strong>idf</strong>: This method calculates the IDF score directly using the logarithm of the ratio <span class="math notranslate nohighlight">\(\frac{N}{n_t}\)</span>, where <span class="math notranslate nohighlight">\(N\)</span> denotes the total number of documents, while <span class="math notranslate nohighlight">\(n_t\)</span> denotes the number of documents where the word occurs in. If the IDF score is low, it means that the word is common not only in one document, but tends to show up in several documents. This suggests that such a word might not be informative.</p></li>
<li><p><strong>idf_smooth</strong>: This method is a modified version of original IDF, to solve the situation when a word occurs 0 times.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function for computing IDF (using different methods)</span>

<span class="k">def</span> <span class="nf">idf</span><span class="p">(</span><span class="n">reviews</span><span class="p">,</span> <span class="n">term_frequency</span><span class="p">,</span> <span class="n">idf_method</span><span class="p">):</span>
    
    <span class="c1"># Total number of documents (i.e. total number of businesses in this case, because we concatenate all the reviews of one specific business)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reviews</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    
    <span class="c1"># Create a nested dictionary for {business: {word: idf score}} storing term-frequency</span>
    <span class="n">inverse_document_frequency</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">comm1</span> <span class="ow">in</span> <span class="n">term_frequency</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="c1"># Update the idf dictionary into form as {business: {word: 0}}</span>
        <span class="n">inverse_document_frequency</span><span class="p">[</span><span class="n">comm1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span> <span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">term_frequency</span><span class="p">[</span><span class="n">comm1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">term_frequency</span><span class="p">[</span><span class="n">comm1</span><span class="p">]:</span>
            <span class="c1"># If a specific word occurs in another business, add 1 to the count of this word</span>
            <span class="k">for</span> <span class="n">comm2</span> <span class="ow">in</span> <span class="n">term_frequency</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">term_frequency</span><span class="p">[</span><span class="n">comm2</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">inverse_document_frequency</span><span class="p">[</span><span class="n">comm1</span><span class="p">][</span><span class="n">word</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># Compute different types of inverse document frequency based on the number of occurance of a word in all the businesses</span>
        <span class="k">if</span> <span class="n">idf_method</span> <span class="o">==</span> <span class="s1">&#39;idf&#39;</span><span class="p">:</span>
            <span class="n">inverse_document_frequency</span><span class="p">[</span><span class="n">comm1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span> <span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inverse_document_frequency</span><span class="p">[</span><span class="n">comm1</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">elif</span> <span class="n">idf_method</span> <span class="o">==</span> <span class="s1">&#39;idf_smooth&#39;</span><span class="p">:</span>
            <span class="n">inverse_document_frequency</span><span class="p">[</span><span class="n">comm1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span> <span class="p">:</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">v</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inverse_document_frequency</span><span class="p">[</span><span class="n">comm1</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    
    <span class="k">return</span> <span class="n">inverse_document_frequency</span>
</pre></div>
</div>
</div>
</div>
<p>Lastly, the TF-IDF metric considers TF and IDF together by multiplying these two metrics in a word-wise fashion. TF shows how frequently a word occurs, while IDF could help to see whether the word is unique or not in corpus.</p>
<p>Let us define how to compute the TF-IDF scores for our reviews below, based on the TF and IDF scores retrieved from the earlier functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function for computing TD-IDF score</span>
<span class="k">def</span> <span class="nf">tf_idf</span><span class="p">(</span><span class="n">term_frequency</span><span class="p">,</span> <span class="n">inverse_document_frequency</span><span class="p">):</span>
    
    <span class="n">tf_idf</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">comm</span> <span class="ow">in</span> <span class="n">term_frequency</span><span class="p">:</span>
        <span class="n">tf_idf</span><span class="p">[</span><span class="n">comm</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span> <span class="p">:</span> <span class="n">v</span><span class="o">*</span><span class="n">term_frequency</span><span class="p">[</span><span class="n">comm</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inverse_document_frequency</span><span class="p">[</span><span class="n">comm</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    
    <span class="k">return</span> <span class="n">tf_idf</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have defined the necessary functions to perform the calculations of these metrics, let us run them upon our <code class="docutils literal notranslate"><span class="pre">reviews</span></code> dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert reviews of each business into one text for analysis</span>

<span class="n">business_reviews</span> <span class="o">=</span> <span class="n">reviews</span><span class="p">(</span><span class="n">df</span> <span class="o">=</span> <span class="n">business_review_df</span><span class="p">,</span> 
                           <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;business&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate term frequency for each business</span>

<span class="n">business_term_frequency</span> <span class="o">=</span> <span class="n">tf</span><span class="p">(</span><span class="n">reviews</span> <span class="o">=</span> <span class="n">business_reviews</span><span class="p">,</span> 
                             <span class="n">tf_method</span> <span class="o">=</span> <span class="s1">&#39;term_frequency&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate inverse document frequency for each business</span>

<span class="n">business_inverse_document_frequency</span> <span class="o">=</span> <span class="n">idf</span><span class="p">(</span><span class="n">reviews</span> <span class="o">=</span> <span class="n">business_reviews</span><span class="p">,</span> 
                                          <span class="n">term_frequency</span> <span class="o">=</span> <span class="n">business_term_frequency</span><span class="p">,</span> 
                                          <span class="n">idf_method</span> <span class="o">=</span> <span class="s1">&#39;idf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate TF-IDF score for each business</span>

<span class="n">business_tf_idf</span> <span class="o">=</span> <span class="n">tf_idf</span><span class="p">(</span><span class="n">term_frequency</span> <span class="o">=</span> <span class="n">business_term_frequency</span><span class="p">,</span>  
                         <span class="n">inverse_document_frequency</span> <span class="o">=</span> <span class="n">business_inverse_document_frequency</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>By sorting the word terms descendingly by their TF-IDF score, we are able to find the top <span class="math notranslate nohighlight">\(N\)</span> keywords which best identify and describe a particular hotel, based on all the reviews from its users. Let us create this function below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function for extracting top keywords with highest TF-IDF score of each business</span>
<span class="k">def</span> <span class="nf">retrieve_top_n_keywords</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">tf_idf_score</span> <span class="o">=</span> <span class="n">business_tf_idf</span><span class="p">):</span>
    
    <span class="c1"># Create a dictionary, which will contain top n keywords for each business</span>
    <span class="n">top_keywords_dict</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c1"># For each business, we will save its business_id and its top n keywords in a dictionary</span>
    <span class="k">for</span> <span class="n">business_id</span><span class="p">,</span> <span class="n">term_dict</span> <span class="ow">in</span> <span class="n">tf_idf_score</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        
        <span class="c1"># Sort the terms by their TF-IDF score (descendingly), and keep the top n keywords</span>
        <span class="n">top_n_keywords_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">tf_idf_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">tf_idf_tuple</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">term_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)][</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span>
        <span class="n">top_keywords_dict</span><span class="p">[</span><span class="n">business_id</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">top_n_keywords_list</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">top_keywords_dict</span>
</pre></div>
</div>
</div>
</div>
<p>We will apply the function by appropriately selecting <span class="math notranslate nohighlight">\(N\)</span>, which is the number of top keywords that we want to retrieve from the TF-IDF term ranking.</p>
<p>At the same time, this number is essential for our Network Analysis, since <span class="math notranslate nohighlight">\(N\)</span> dictates how many keywords each node will have available to check for matching with keywords of other nodes. The smaller the <span class="math notranslate nohighlight">\(N\)</span> is selected to be, the fewer keywords will be available for nodes to match on and create edges between them, therefore a smaller number of top keywords will be directly proportional to a smaller number of edges created in our network.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">business_top_keywords</span> <span class="o">=</span> <span class="n">retrieve_top_n_keywords</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For the sake of easy retrieval, let us also store these top keywords of each business in the original <code class="docutils literal notranslate"><span class="pre">business</span></code> dataframe, in a new column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add a column containing top keywords of each business to the original dataframe</span>
<span class="n">business_df</span><span class="p">[</span><span class="s1">&#39;top_keywords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">business_df</span><span class="p">[</span><span class="s1">&#39;business_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">business_top_keywords</span><span class="p">)</span>
<span class="n">business_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>business_id</th>
      <th>name</th>
      <th>address</th>
      <th>city</th>
      <th>state</th>
      <th>postal_code</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>stars</th>
      <th>review_count</th>
      <th>is_open</th>
      <th>attributes</th>
      <th>categories</th>
      <th>hours</th>
      <th>top_keywords</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>izw7OBVSeNmlVhjly1amQg</td>
      <td>Wyndham Vacation Ownership</td>
      <td>3475 Las Vegas Blvd S</td>
      <td>Las Vegas</td>
      <td>NV</td>
      <td>89109.0</td>
      <td>36.119725</td>
      <td>-115.172396</td>
      <td>1.5</td>
      <td>154</td>
      <td>1</td>
      <td>{"BusinessAcceptsCreditCards": "True", "Restau...</td>
      <td>Hotels &amp; Travel, Hotels, Event Planning &amp; Serv...</td>
      <td>{}</td>
      <td>[wyndham, timeshare, interested, drake, salesp...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<hr class="docutils" />
<p><a id='5.'></a></p>
</div>
<div class="section" id="what-is-causing-global-warming">
<h1>5.  What is Causing global warming?<a class="headerlink" href="#what-is-causing-global-warming" title="Permalink to this headline">¶</a></h1>
<p><a id='5.1.'></a></p>
<div class="section" id="wealth-gdp">
<h2>5.1. Wealth (GDP)<a class="headerlink" href="#wealth-gdp" title="Permalink to this headline">¶</a></h2>
<p>After we have determined the top <span class="math notranslate nohighlight">\(N\)</span> most relevant keywords for each business in part, it is now time to investigate graph analytics upon the business network determined by the Yelp hotels.</p>
<p>The purpose of creating and visualizing such a network is to be able to identify hotels which are “connected” with each other by their unique words in their reviews, thereby identifying what each hotel is “distinguishing” itself compared to the others in the hotel landscape of Las Vegas. At the same time, two hotels/nodes who are strongly connected in our network can identify a potential “competitor” relationship between two businesses, since the hotels would share in common multiple distinguishing words.</p>
<p>First let us create the <strong>undirected network graph</strong>, where the nodes are our analyzed businesses:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>

<span class="c1"># Add nodes</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">business_top_keywords</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initially, the total number of nodes/businesses in the network is:&#39;</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">())</span>

<span class="c1"># Assign business name as an attribute to each node/business (for plotting it later)</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
    <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;business_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">business_df</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">business_df</span><span class="o">.</span><span class="n">business_id</span> <span class="o">==</span> <span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initially, the total number of nodes/businesses in the network is: 438
</pre></div>
</div>
</div>
</div>
<p>We will remodel the “top keywords” dictionary into a dataframe in long-format, where each row corresponds to a (business_id, unique_keyword) combination. This specific form for the dataframe is necessary, so that we can group by keywords afterwards, and identify which businesses share a keyword in common.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keyword_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">business_top_keywords</span><span class="p">)</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span> <span class="o">=</span> <span class="s1">&#39;business_id&#39;</span><span class="p">,</span> <span class="n">value_name</span> <span class="o">=</span> <span class="s1">&#39;keywords&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Group keywords by &#39;business_id&#39;, to find the businesses sharing top keywords</span>

<span class="n">grouped_keyword_df</span> <span class="o">=</span> <span class="n">keyword_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;keywords&#39;</span><span class="p">,</span> <span class="s1">&#39;business_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Here, we will connect the nodes by their keywords, creating edges. Also, the <strong>weight of the edges</strong> will be taken into account as representing the total number of top keywords that two hotel businesses share in common.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here, we are iterating through the grouped set of keywords, </span>
<span class="c1"># and if two businesses have the same keyword in common, we will create a network edge between the two busineses</span>

<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">business_sub_df</span> <span class="ow">in</span> <span class="n">grouped_keyword_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    
    <span class="c1"># This is a list of combinations of 2 businesses which have the same top keyword in common</span>
    <span class="n">edges_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">business_sub_df</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span> <span class="ow">in</span> <span class="n">edges_list</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">):</span>
            <span class="c1"># we added this connection before, just increase the weight by one</span>
            <span class="n">G</span><span class="p">[</span><span class="n">node1</span><span class="p">][</span><span class="n">node2</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># new edge, therefore initialize link with weight = 1</span>
            <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using the top n = </span><span class="si">%d</span><span class="s1"> keywords from TF-IDF, the initialized number of edges is: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using the top n = 10 keywords from TF-IDF, the initialized number of edges is: 10791
</pre></div>
</div>
</div>
</div>
<p>As we can see above, the number of edges connecting different parts of this network is quite large (&gt; 10000 edges), especially since we have selected a more generous number (<span class="math notranslate nohighlight">\(N = 10\)</span>) of top keywords that the nodes are allowed to match on. The reason behind this choice is that if we decrease this number to 5 or 3 keywords, the degrees of the nodes in the graph will fall dramatically and there will be more isolated nodes in the graph, which is a behaviour we do not want.</p>
<p>Finally here, let us remove the (few) isolated nodes in the graph, locate the main connected component of the graph (GCC) and focus our analysis on specifically these kinds of nodes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove the isolated nodes from the graph</span>
<span class="n">G</span><span class="o">.</span><span class="n">remove_nodes_from</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">isolates</span><span class="p">(</span><span class="n">G</span><span class="p">)))</span>

<span class="c1"># Remove nodes outside the main connected component (i.e. outside the GCC)</span>
<span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">to_undirected</span><span class="p">())):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">component</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">component</span><span class="p">:</span>
            <span class="n">G</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After removal of isolated or non-GCC nodes, the total number of nodes/businesses in the network is:&#39;</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Also, the number of edges present in the network now is:&#39;</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>After removal of isolated or non-GCC nodes, the total number of nodes/businesses in the network is: 421
Also, the number of edges present in the network now is: 10790
</pre></div>
</div>
</div>
</div>
<p>Through the code above, we have also presented preliminary descriptive statistics upon the network graph, which contains <em><strong>421 nodes</strong></em> which we are working with, as well as <em><strong>10790 edges</strong></em> connecting the various hotel busineses together.</p>
<p><a id='5.2.'></a></p>
</div>
<div class="section" id="energy-consumption">
<h2>5.2. Energy consumption<a class="headerlink" href="#energy-consumption" title="Permalink to this headline">¶</a></h2>
<p>In order to visualize how the constructed graph looks like, we will use a <strong>force-directed layout</strong> for our graph, based on the Force Atlas algorithm, which computes node positions spatializing our undirected weighted graph.</p>
<p>The node positions will be calculated at the next step, before being fed into the plotting function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create instance for FA2</span>
<span class="n">forceatlas2</span> <span class="o">=</span> <span class="n">FA2</span><span class="p">(</span><span class="n">scalingRatio</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">gravity</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">outboundAttractionDistribution</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Calculate positions of nodes in the visualization</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">forceatlas2</span><span class="o">.</span><span class="n">forceatlas2_networkx_layout</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████████████████████████████████████████████████████████████████████████| 1000/1000 [00:12&lt;00:00, 80.92it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BarnesHut Approximation  took  1.90  seconds
Repulsion forces  took  9.32  seconds
Gravitational forces  took  0.15  seconds
Attraction forces  took  0.29  seconds
AdjustSpeedAndApplyForces step  took  0.31  seconds
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Here, we will also create a list of node sizes based on the total number of reviews that each hotel has, multiplied by a minimizing constant, so as to make the sizes reasonable to display. Therefore, very popular hotels will have higher node sizes than most others.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">node_sizes</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="p">:</span>
    
    <span class="n">total_reviews</span> <span class="o">=</span> <span class="n">business_df</span><span class="p">[</span><span class="n">business_df</span><span class="o">.</span><span class="n">business_id</span> <span class="o">==</span> <span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">review_count</span>
    
    <span class="c1"># Append the appropriate size to a node</span>
    <span class="n">node_sizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_reviews</span> <span class="o">*</span> <span class="mf">0.025</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, here we will plot the static graph visualization using networkx and matplotlib’s underlying drawing functions. This graph helps us understand how connected the hotel business landscape in Las Vegas is, and also helps us identify what role in the network the very popular hotels are playing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">positions</span><span class="p">,</span> <span class="n">node_size</span> <span class="o">=</span> <span class="n">node_sizes</span><span class="p">,</span> <span class="n">node_color</span> <span class="o">=</span> <span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Project_B_138_0.png" src="_images/Project_B_138_0.png" />
</div>
</div>
<p>The results of the graph plotting are very interesting: it seems that some hotels which are not so popular are having similar degree of connecting as the very popular nodes in the network. Therefore, it does not appear that there is a relationship between how popular a business is and how many competitors it has.</p>
<p>At the same time, it appears that there are many edge nodes which have fewer links to other nodes in the network than the majority. These results are just detected from eye-measuring the graph, and in order to make a responsible analysis with concrete numbers, we will have a look at the degree distribution of this network, in order to check for any network effects there.</p>
<p>However, before checking the degree distribution, we wanted to take the graph visualizations to a dynamical space, where we can actually manipulate and zoom into the graph’s structure in order to understand its connections, since this is not a traditional easy-to-interpret graph.</p>
<p>We will perform an interactive representation of the previous plot using the Python library <em><strong><code class="docutils literal notranslate"><span class="pre">Plotly</span></code></strong></em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract latitude of hotel corresponding to each node</span>
<span class="n">lat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">business_df</span><span class="p">[</span><span class="n">business_df</span><span class="o">.</span><span class="n">business_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">())]</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>

<span class="c1"># Extract longitude of hotel corresponding to each node</span>
<span class="n">lon</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">business_df</span><span class="p">[</span><span class="n">business_df</span><span class="o">.</span><span class="n">business_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">())]</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span>

<span class="c1"># Define position of nodes using latitude and longitude</span>
<span class="n">position</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)))</span>

<span class="c1"># Use review_count (while minimizing it to a reasonable scale for plotting) to indicate the node size</span>
<span class="n">node_size</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">business_df</span><span class="p">[</span><span class="n">business_df</span><span class="o">.</span><span class="n">business_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">())]</span><span class="o">.</span><span class="n">review_count</span><span class="o">*</span><span class="mf">0.005</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add position information of edges</span>
<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">positions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
    
<span class="n">edge_x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">edge_y</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
    <span class="n">edge_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
    <span class="n">edge_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
    <span class="n">edge_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">edge_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y0</span><span class="p">)</span>
    <span class="n">edge_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
    <span class="n">edge_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># Plot edges using position and other args</span>
<span class="n">edge_trace_business</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">edge_x</span><span class="p">,</span> 
                                 <span class="n">y</span> <span class="o">=</span> <span class="n">edge_y</span><span class="p">,</span>
                                 <span class="n">line</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkred&#39;</span><span class="p">),</span>
                                 <span class="n">hoverinfo</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                 <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;lines&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add position information of nodes</span>
<span class="n">node_x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">node_y</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
    <span class="n">node_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">node_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Plot nodes using position and other args</span>
<span class="n">node_trace_business</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">node_x</span><span class="p">,</span> 
                                 <span class="n">y</span> <span class="o">=</span> <span class="n">node_y</span><span class="p">,</span>
                                 <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
                                 <span class="n">hoverinfo</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
                                 <span class="n">marker</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">showscale</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                               <span class="n">colorscale</span> <span class="o">=</span> <span class="s1">&#39;Blackbody&#39;</span><span class="p">,</span>
                                               <span class="n">reversescale</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                               <span class="n">color</span> <span class="o">=</span> <span class="p">[],</span>
                                               <span class="n">size</span> <span class="o">=</span> <span class="n">node_size</span><span class="p">,</span>
                                               <span class="n">colorbar</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">thickness</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
                                                               <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Node Connections&#39;</span><span class="p">,</span>
                                                               <span class="n">xanchor</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                                               <span class="n">titleside</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">),</span> 
                                               <span class="n">line_width</span> <span class="o">=</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">node_adjacency</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">node_text</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">node_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">adjacency</span><span class="p">():</span>
    <span class="c1"># Store the adjacency of nodes into a list</span>
    <span class="n">node_adjacency</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    
    <span class="c1"># Store the explanatory texts to indicate the number of adjacency for the plot</span>
    <span class="n">node_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;# of connections: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
    
    <span class="c1"># Extract the names of nodes/hotels to show on plot</span>
    <span class="n">node_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">get_node_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;business_name&#39;</span><span class="p">)[</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assign different colors for different sizes of the adjacency number</span>
<span class="n">node_trace_business</span><span class="o">.</span><span class="n">marker</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">node_adjacency</span>

<span class="c1"># Combine names and explanatory texts of nodes for plotting</span>
<span class="n">node_trace_business</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">node_names</span><span class="p">,</span> <span class="n">node_text</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Plotly will use the original Force-Atlas positions of each hotel to plot a representational graph, where the nodes are holding the exact same coordinates as for the static plot seen above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot interactive graph</span>
<span class="n">fig_network_business</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">edge_trace_business</span><span class="p">,</span> <span class="n">node_trace_business</span><span class="p">],</span>
                                 <span class="n">layout</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">plot_bgcolor</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span>
                                                    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Hotels Network&#39;</span><span class="p">,</span>
                                                    <span class="n">titlefont_size</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
                                                    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                    <span class="n">hovermode</span> <span class="o">=</span> <span class="s1">&#39;closest&#39;</span><span class="p">,</span>
                                                    <span class="n">margin</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">60</span><span class="p">),</span>
                                                    <span class="n">annotations</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">showarrow</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                                        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Interactive visualization of the Yelp hotels network in Las Vegas&#39;</span><span class="p">,</span>
                                                                        <span class="n">xref</span> <span class="o">=</span> <span class="s1">&#39;paper&#39;</span><span class="p">,</span> 
                                                                        <span class="n">yref</span> <span class="o">=</span> <span class="s1">&#39;paper&#39;</span><span class="p">,</span>
                                                                        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">,</span> 
                                                                        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.002</span><span class="p">)],</span>
                                                    <span class="n">xaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">showgrid</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zeroline</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">showticklabels</span> <span class="o">=</span> <span class="kc">False</span><span class="p">),</span>
                                                    <span class="n">yaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">showgrid</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zeroline</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">showticklabels</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)))</span>

<span class="c1"># fig_network_business.show()</span>
</pre></div>
</div>
</div>
</div>
<p><em>Screenshot image, since the Plotly interactive graph does not show without re-running the notebook:</em></p>
<p><img alt="Image of Hotels Network Graph" src="https://i.imgur.com/giMQAjU.png" /></p>
<p><em><strong>In order to view the above dynamic visualization “in action”, please find it on our website, with link <a class="reference external" href="https://hanlululu.github.io/SocialGraphYelp.io/Page3_Network.html">here</a>.</strong></em></p>
<p>By hovering over the interactive graph, we are able to find how many connections each hotel has with its neighbors/competitors. It can be clearly seen that the most popular nodes are also some of the ones with highest degree of connection, meaning that they share a larger number of competitors than most other businesses (<em><strong>let’s remember that node size is solely determined by the number of reviews a hotel received</strong></em>).</p>
<p><a id='5.3.'></a></p>
</div>
<div class="section" id="population-growth">
<h2>5.3. Population growth<a class="headerlink" href="#population-growth" title="Permalink to this headline">¶</a></h2>
<p>The visualization of the hotel network graph is slightly challenging to interpret, since, on one hand it doesn’t seem to exhibit strong Barabasi-Albert properties, however on the other hand, it does not seem for the nodes to be connected randomly either.</p>
<p>One way to verify whether such assumptions are correct is by plotting the linear and log-log degree distribution of the network, as done below.</p>
<p>The network edges are weight-adjusted depending on the number of common review keyworks, with higher thickness/weight meaning higher number of common keywords found.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">degree_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">())]</span>

<span class="n">max_degree</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">degree_list</span><span class="p">)</span>
<span class="n">min_degree</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">degree_list</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The maximum degree in our network is:&#39;</span><span class="p">,</span> <span class="n">max_degree</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The minimum degree in our network is:&#39;</span><span class="p">,</span> <span class="n">min_degree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The maximum degree in our network is: 160
The minimum degree in our network is: 1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hist</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">degree_list</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">degree_list</span><span class="p">)))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">counts</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">degree_list</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="p">,</span> <span class="n">ec</span> <span class="o">=</span> <span class="s2">&quot;darkblue&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram of the degree distribution for the YELP hotel network [Isolated]&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">));</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Degree (linear)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">hist</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Degree distribution (Log-Log) for the YELP hotel network [Isolated]&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Degree (log-log)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Project_B_154_0.png" src="_images/Project_B_154_0.png" />
</div>
</div>
<p>As we can see above, there seems to be some form of a weak scale-free behavior in the network, since the log “degree distribution” tends to follow a power law, albeit with a rather large number of deviations from such behavior.</p>
<p>Another sign which demonstrates the weak presence of a scale-free influence in the graph is the large maximum degree number present in the dataset, indicating the presence of a certain number of hubs, although the linear scale demonstrates that the distribution has many modes and a large number local minima points, thus deviating from the expected behavior of Barabasi-Albert graphs. The minimum degree number being <span class="math notranslate nohighlight">\(1\)</span> also is a sign referring to a BA-graph behaviour, since, after all, a BA network a fully connected graph.</p>
<p>Let us try to compare these results with the results of a random network having the same number of starting nodes and a probability <span class="math notranslate nohighlight">\(p\)</span> of connection to other nodes. The network that we will compare against is an <strong>undirected Erdős-Rényi (random) graph</strong>, with <span class="math notranslate nohighlight">\(p\)</span> being computed by calculation upon the degrees of our hotel network.</p>
<p>Let us first compute <span class="math notranslate nohighlight">\(p\)</span> below, knowing that <span class="math notranslate nohighlight">\(p = \frac{&lt;k&gt;}{N-1}\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the average of all degrees in the Hotels graph</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">())])</span>

<span class="c1"># N is the total number of nodes</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The value of &quot;p&quot; is:&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The value of &quot;p&quot; is: 0.1220450175319534
</pre></div>
</div>
</div>
</div>
<p>Now, let us generate the (undirected) random network:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">fast_gnp_random_graph</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">directed</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, let us take a look at the degree distribution for the random network, and see how it compares with the previous results from our Hotels network:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here, we have discarded the nodes with degree 0</span>
<span class="n">degree_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">random_G</span><span class="o">.</span><span class="n">degree</span><span class="p">())</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">max_degree</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">degree_list</span><span class="p">)</span>
<span class="n">min_degree</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">degree_list</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The maximum degree in the random network is:&#39;</span><span class="p">,</span> <span class="n">max_degree</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The minimum degree in the random network is:&#39;</span><span class="p">,</span> <span class="n">min_degree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The maximum degree in the random network is: 128
The minimum degree in the random network is: 77
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hist</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">degree_list</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">degree_list</span><span class="p">)))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">counts</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">degree_list</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="p">,</span> <span class="n">ec</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram of the degree distribution for the Random Network [Isolated]&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">));</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Degree (linear)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">hist</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Degree distribution (Log-Log) for the Random Network [Isolated]&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Degree (log-log)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Project_B_162_0.png" src="_images/Project_B_162_0.png" />
</div>
</div>
<p>The degree distribution for the random network can easily be approximated with a Poisson distribution centered unimodally. This is very different than the scale-free behaviour we have seen in BA graphs, as well in our graph, where the distribution resembled a power law much more than a Poisson.</p>
<p>In conclusion, it seems that, in our Hotel network graph, there will be some “hubs” which will represent important competitors for most other hotels, even though the large selected number of top keywords available (<span class="math notranslate nohighlight">\(N = 10\)</span>) has generally given a significant “boost” to the degree values for all nodes across the entire span of the graph.</p>
<p><a id='5.4.'></a></p>
</div>
<div class="section" id="urbanisation">
<h2>5.4. Urbanisation<a class="headerlink" href="#urbanisation" title="Permalink to this headline">¶</a></h2>
<p>Looking at the original graph, it is good to visualize an overview of our Hotels network, however we are wondering if there are any groupings or clusters of hotels which are similar in terms of their special features or experiences (which get mentioned in users’ reviews).</p>
<p>For this, we will try to compute and maximize the modularity score of each group of nodes through using the <strong>Louvain</strong> algorithm, which looks as how much more densely connected the nodes in a community are, compared to how connected the same nodes would be in a random network. The Louvain algorithm is an unsupervised clustering method, and allows finding of the best partition of nodes into communities from a full-scale graph.</p>
<p>We will also set a set a seed for the algorithm, in order to achieve reproducibility of our results when re-running this project notebook:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find the best community partition for the DC universe</span>
<span class="n">partition_hotels</span> <span class="o">=</span> <span class="n">community</span><span class="o">.</span><span class="n">best_partition</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The Louvain algorithm has found&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">partition_hotels</span><span class="o">.</span><span class="n">values</span><span class="p">())),</span> <span class="s2">&quot;communities for hotel landscape in Las Vegas.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The Louvain algorithm has found 4 communities for hotel landscape in Las Vegas.
</pre></div>
</div>
</div>
</div>
<p>From the optimal partition, we have identified 4 communities which these hotels are grouped into. It is very important and relevant to visualize the distribution of each community’s nodes across the original graph landscape, which is why we want to visualize the community graph.</p>
<p>The Force-Atlas positions computed previously will be kept and reused for this visualization, since then it allows for the graph layout to be preserved in its entirely, allowing us to only focus on the presence of communities.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For this visualization, let us split the nodes by their community number</span>
<span class="n">dict_communities</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">community_nr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">partition_hotels</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">dict_communities</span><span class="p">[</span><span class="n">community_nr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">comm</span> <span class="ow">in</span> <span class="n">partition_hotels</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">comm</span> <span class="o">==</span> <span class="n">community_nr</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">character_color_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">community_color_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#00FA9A&#39;</span><span class="p">,</span> <span class="s1">&#39;#0000FF&#39;</span><span class="p">,</span> <span class="s1">&#39;#228B22&#39;</span><span class="p">,</span> <span class="s1">&#39;#6495ED&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">community_nr</span><span class="p">,</span> <span class="n">character_name_list</span> <span class="ow">in</span> <span class="n">dict_communities</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    
    <span class="c1"># For every node in this community, we assign them a previously-computed color</span>
    <span class="k">for</span> <span class="n">character_name</span> <span class="ow">in</span> <span class="n">character_name_list</span><span class="p">:</span>
        <span class="n">character_color_dict</span><span class="p">[</span><span class="n">character_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">community_color_list</span><span class="p">[</span><span class="n">community_nr</span><span class="p">]</span>
                
        
<span class="c1"># The node colors in the DICT are not in the same order as the nodes in the graph, therefore we need to create a separate list to deal with that</span>
<span class="n">node_color_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># At the same time, we will create a list of node sizes by looking directly at the degree of each individual node (within the undirected Comics network)</span>
<span class="n">node_size_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="p">:</span>
    
    <span class="c1"># Append the appropriate color to a node</span>
    <span class="n">node_color_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">character_color_dict</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>

    <span class="c1"># Append the appropriate size to a node</span>
    <span class="n">node_size_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>

<span class="c1"># We will reuse the Force-Atlas positions computed previously, for consistency and efficiency</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">positions</span><span class="p">,</span> <span class="n">node_size</span> <span class="o">=</span> <span class="n">node_size_list</span><span class="p">,</span> <span class="n">node_color</span> <span class="o">=</span> <span class="n">node_color_list</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.025</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="mf">0.80</span> <span class="c1"># This is the starting Y, for the figure text</span>
<span class="c1"># Indicating community colors</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dict_communities</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;Community #&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">17</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">community_color_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="mf">0.03</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Louvain community partitioning for the Yelp-registered hotels in Las Vegas, using Force-Atlas node coordinates&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Project_B_170_0.png" src="_images/Project_B_170_0.png" />
</div>
</div>
<p>The visual representation shows a clear separation of the network plot into the 4 communities, which is a very nice result. It seems that there are 3 large communities of approximatively similar sizes, and one smaller community whose nodes are scattered across the graph due to their interaction with a wide variety of hotels located all across the graph.</p>
<p>The plot shows that, for each community, there seems to interact a significant interaction with other community’s nodes, although nodes from a community will always interact most with other nodes from the same community, as per the modularity maximization principle which the Louvain algorithm used for finding the best partition. This means that, although communities have been found, there are some top keywords which are shared highly by a large number of hotels across all communities.</p>
<p>Of course, besides the static visualization, an interactive method of finding <strong>exactly which Hotels (identified by name) belong to which community</strong> can be useful. We will again use the <em><strong><code class="docutils literal notranslate"><span class="pre">Plotly</span></code></strong></em> library to show which businesses belong to which communities, in an aesthetically-pleasing manner.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add position information of edges</span>
<span class="n">edge_trace_community</span> <span class="o">=</span> <span class="n">edge_trace_business</span>

<span class="c1"># Add position information of nodes</span>
<span class="n">node_trace_community</span> <span class="o">=</span> <span class="n">node_trace_business</span>

<span class="c1"># Change color of edges</span>
<span class="n">edge_trace_community</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;darkred&#39;</span>

<span class="c1"># Remove colorbar</span>
<span class="n">node_trace_community</span><span class="p">[</span><span class="s1">&#39;marker&#39;</span><span class="p">][</span><span class="s1">&#39;showscale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">node_group</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">node_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">adjacency</span><span class="p">():</span>
    
    <span class="c1"># Extract the names of nodes/hotels to show on plot</span>
    <span class="n">node_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">get_node_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;business_name&#39;</span><span class="p">)[</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    
    <span class="c1"># Store the texts to indicates which community the node belongs to on the plot</span>
    <span class="n">node_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Community: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">dict_communities</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assign different colors to the nodes which belong to different communities </span>
<span class="c1"># The color list is the same one used in community partition</span>
<span class="n">node_trace_community</span><span class="o">.</span><span class="n">marker</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">node_color_list</span>

<span class="c1"># Combine names and explanatory texts of nodes for plotting</span>
<span class="n">node_trace_community</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">node_names</span><span class="p">,</span> <span class="n">node_group</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot interactive graph</span>
<span class="n">fig_network_community</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">edge_trace_community</span><span class="p">,</span> <span class="n">node_trace_community</span><span class="p">],</span>
                                  <span class="n">layout</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">plot_bgcolor</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span>
                                  <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Communities Network&#39;</span><span class="p">,</span>
                                  <span class="n">titlefont_size</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
                                  <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                  <span class="n">hovermode</span> <span class="o">=</span> <span class="s1">&#39;closest&#39;</span><span class="p">,</span>
                                  <span class="n">margin</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">60</span><span class="p">),</span>
                                  <span class="n">annotations</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">showarrow</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                      <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Interactive visualization of the Yelp communities of hotels in Las Vegas&#39;</span><span class="p">,</span>
                                                      <span class="n">xref</span> <span class="o">=</span> <span class="s1">&#39;paper&#39;</span><span class="p">,</span> 
                                                      <span class="n">yref</span> <span class="o">=</span> <span class="s1">&#39;paper&#39;</span><span class="p">,</span>
                                                      <span class="n">x</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">,</span> 
                                                      <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.002</span><span class="p">)],</span>
                                  <span class="n">xaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">showgrid</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zeroline</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">showticklabels</span> <span class="o">=</span> <span class="kc">False</span><span class="p">),</span>
                                  <span class="n">yaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">showgrid</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zeroline</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">showticklabels</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)))</span>

<span class="c1"># fig_network_community.show()</span>
</pre></div>
</div>
</div>
</div>
<p><em>Screenshot image, since the Plotly interactive graph does not show without re-running the notebook:</em></p>
<p><img alt="Image of Communities Network Graph" src="https://i.imgur.com/mhdxdu4.png" /></p>
<p><em><strong>In order to view the above dynamic visualization “in action”, please find it on our website, with link <a class="reference external" href="https://hanlululu.github.io/SocialGraphYelp.io/Page3_Network.html">here</a>.</strong></em></p>
<p>The visualization helps easily see that some of the very popular hotels are residing in Community 3, and that perhaps might have an important effect as to why they have been grouped together in the same community.</p>
<p>By hovering over the interactive graph, we are able to find which hotels are belonging to what community.</p>
<p><a id='5.5.'></a></p>
</div>
<div class="section" id="foreign-investments">
<h2>5.5. Foreign investments<a class="headerlink" href="#foreign-investments" title="Permalink to this headline">¶</a></h2>
<p>Lastly in this network analysis project part, we will take a look at what words characterize each community. It is relevant to see this, in order to understand if there is a trend for why certain hotels were grouped together, and also for understanding what kind of experiences do you normally get from hotels in that community.</p>
<p>Firstly, we need to aggregate all the reviews for each community independently, and calculate TF, IDF and TF-IDF scores upon their aggregated reviews.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert reviews of each community into one text for analysis</span>
<span class="n">community_reviews</span> <span class="o">=</span> <span class="n">reviews</span><span class="p">(</span><span class="n">df</span> <span class="o">=</span> <span class="n">business_review_df</span><span class="p">,</span> 
                            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;community&#39;</span><span class="p">,</span> 
                            <span class="n">dict_communities</span> <span class="o">=</span> <span class="n">dict_communities</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate term frequency of each community</span>
<span class="n">community_term_frequency</span> <span class="o">=</span> <span class="n">tf</span><span class="p">(</span><span class="n">reviews</span> <span class="o">=</span> <span class="n">community_reviews</span><span class="p">,</span> 
                              <span class="n">tf_method</span> <span class="o">=</span> <span class="s1">&#39;term_frequency&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate inverse document frequency of each community</span>
<span class="n">community_inverse_document_frequency</span> <span class="o">=</span> <span class="n">idf</span><span class="p">(</span><span class="n">reviews</span> <span class="o">=</span> <span class="n">community_reviews</span><span class="p">,</span> 
                                           <span class="n">term_frequency</span> <span class="o">=</span> <span class="n">community_term_frequency</span><span class="p">,</span> 
                                           <span class="n">idf_method</span> <span class="o">=</span> <span class="s1">&#39;idf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate TF-IDF score of each community</span>
<span class="n">community_tf_idf</span> <span class="o">=</span> <span class="n">tf_idf</span><span class="p">(</span><span class="n">term_frequency</span> <span class="o">=</span> <span class="n">community_term_frequency</span><span class="p">,</span> 
                          <span class="n">inverse_document_frequency</span> <span class="o">=</span> <span class="n">community_inverse_document_frequency</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The function below will convert separate words into a large text-string, which is necessary for feeding into the wordcloud:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function for converting the word dictionary into a string</span>
<span class="k">def</span> <span class="nf">dict_to_string</span><span class="p">(</span><span class="n">word_dict</span><span class="p">,</span> <span class="n">amplify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="n">total_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_dict</span><span class="p">:</span>
        
        <span class="c1"># If the tf-idf scores of words are too small, we times the original score by 1e8 for differentiating them better</span>
        <span class="k">if</span> <span class="n">amplify</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">repeat_nr</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">word_dict</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">))</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">repeat_nr</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">word_dict</span><span class="p">[</span><span class="n">word</span><span class="p">])</span>
        
        <span class="c1"># Create a string of one term (occuring, in a proportional manner, according to the TF-TR scores)</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">word</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repeat_nr</span><span class="p">)])</span>
        
        <span class="c1"># Concatenate the current elements to the total string</span>
        <span class="n">total_string</span> <span class="o">+=</span> <span class="n">string</span>
        
    <span class="k">return</span> <span class="n">total_string</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">wordclouds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">comm</span> <span class="ow">in</span> <span class="n">community_tf_idf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">text</span><span class="p">[</span><span class="n">comm</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict_to_string</span><span class="p">(</span><span class="n">community_tf_idf</span><span class="p">[</span><span class="n">comm</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here, we have decided to create wordclouds for each community in an interactive manner, with an “interactive twist”. More specifically, through the use of the <strong>IPython widgets</strong> function, we created a clickable drop-down menu for the community ID that you want to analyse words from, as well as another drop-down menu for the maximum number of words which should be shown in the wordcloud.</p>
<p>Since there are 4 communities, we decided to add a playful twist to the wordcloud figure, and represent each of them using the famous playing card suit set: <em>club, diamond, spade and heart</em>.</p>
<p>Here, the community wordclouds are represented, and by changing the options in the drop-down menu, different wordclouds come into view:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@interact</span>   
<span class="k">def</span> <span class="nf">create_wordcloud</span><span class="p">(</span><span class="n">frame</span> <span class="o">=</span> <span class="n">fixed</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="p">,</span> <span class="n">community</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">maximum</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span> <span class="p">,</span> <span class="n">atitle</span> <span class="o">=</span> <span class="n">fixed</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)):</span>
    
    <span class="k">if</span> <span class="n">community</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mk</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;./club.jpg&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">community</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">mk</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;./diamond.png&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">community</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">mk</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;./spade.jpg&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">community</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">mk</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;./heart.jpg&#39;</span><span class="p">)</span>
   
    <span class="n">wordcloud</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">max_font_size</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span> 
                                       <span class="n">max_words</span> <span class="o">=</span> <span class="n">maximum</span><span class="p">,</span> 
                                       <span class="n">background_color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span>
                                       <span class="n">collocations</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                       <span class="n">mask</span> <span class="o">=</span> <span class="n">mk</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="n">community</span><span class="p">])</span>
    
    <span class="n">image_colors</span> <span class="o">=</span> <span class="n">ImageColorGenerator</span><span class="p">(</span><span class="n">mk</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;Wordcloud for community &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">community</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; and the top &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; most important words&#39;</span><span class="p">),</span> 
                 <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud</span><span class="o">.</span><span class="n">recolor</span><span class="p">(</span><span class="n">color_func</span> <span class="o">=</span> <span class="n">image_colors</span><span class="p">),</span> <span class="n">interpolation</span> <span class="o">=</span> <span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    
<span class="c1"># w = interact(create_wordcloud, </span>
<span class="c1">#              frame = fixed(text), </span>
<span class="c1">#              community = [0, 1, 2, 3], </span>
<span class="c1">#              maximum = [50, 100, 300], </span>
<span class="c1">#              atitle = fixed(&#39;&#39;))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "45fda9b609a94888a56c619417b930de", "version_major": 2, "version_minor": 0}
</script></div>
</div>
<p><em>Screenshot image, since the &#64;interact ipywidgets dropdown-menu does not show without re-running the notebook:</em></p>
<p><img alt="Image of the interactive wordclouds" src="https://i.imgur.com/g1wp0lX.png" /></p>
<p>Unfortunately, because the interactive widgets cannot be saved in the Jupyter Notebook’s state (without re-running the notebook again), besides the screenshot above showing you how they work, we will also create a traditional plot of wordclouds, in similar style to the one above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">wordclouds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">comm</span> <span class="ow">in</span> <span class="n">community_tf_idf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">text</span><span class="p">[</span><span class="n">comm</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict_to_string</span><span class="p">(</span><span class="n">community_tf_idf</span><span class="p">[</span><span class="n">comm</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
    
    <span class="c1"># Static wordclouds (as interactive one does not show on the jupyter notebook)</span>
    <span class="k">if</span> <span class="n">comm</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mk</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;./club.jpg&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">comm</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">mk</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;./diamond.png&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">comm</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">mk</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;./spade.jpg&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">comm</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">mk</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;./heart.jpg&#39;</span><span class="p">)</span>
   
    <span class="n">wordclouds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WordCloud</span><span class="p">(</span><span class="n">max_font_size</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span> 
                                                <span class="n">max_words</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> 
                                                <span class="n">background_color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span>
                                                <span class="n">collocations</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                <span class="n">mask</span> <span class="o">=</span> <span class="n">mk</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="n">comm</span><span class="p">]))</span>
    <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ImageColorGenerator</span><span class="p">(</span><span class="n">mk</span><span class="p">))</span>
    
    
<span class="c1"># Display the generated images</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordclouds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">recolor</span><span class="p">(</span><span class="n">color_func</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">interpolation</span> <span class="o">=</span> <span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Community 0&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordclouds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">recolor</span><span class="p">(</span><span class="n">color_func</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">interpolation</span> <span class="o">=</span> <span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Community 1&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordclouds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">recolor</span><span class="p">(</span><span class="n">color_func</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">interpolation</span> <span class="o">=</span> <span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Community 2&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordclouds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">recolor</span><span class="p">(</span><span class="n">color_func</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="n">interpolation</span> <span class="o">=</span> <span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Community 3&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Project_B_194_0.png" src="_images/Project_B_194_0.png" />
</div>
</div>
<p>The community wordplot shows multiple very interesting and relevant findings:</p>
<ul class="simple">
<li><p>Community 0 contains many keywords related to casino (‘<em>tip</em>’, ‘<em>carlo</em>’, ‘<em>shark’</em>, ‘<em>booth</em>’, etc.), as well as words related to the adult night life of Las Vegas.</p></li>
<li><p>Community 1 is the hardest one to pin-point. It seems that a central “theme” of the reviews belonging to hotels in this community is centered about the hotel staff, and words related to security. Later on, we will find that this community is also the one with the lowest sentiment score, which indicates that the comments regarding the staff here are not encouraging ones.</p></li>
<li><p>Community 2 (<em>which we will later see that it is the happiest community</em>) is related very strongly to food, desserts and fruits. The hotels grouped in this community seem to have the common specialization in exquisite and delicious culinary adventures.</p></li>
<li><p>Community 3 seems to have most words related to games, alcoholic drinking, as well as swear words, indicating that this community may be strongly involved with bar-hotels and the ones of a more “frivolous” nature.</p></li>
</ul>
<hr class="docutils" />
<p><a id='6.'></a></p>
</div>
</div>
<div class="section" id="who-takes-the-responsibility">
<h1>6. Who takes the responsibility?<a class="headerlink" href="#who-takes-the-responsibility" title="Permalink to this headline">¶</a></h1>
<p><strong>Topic modelling</strong> is a tool for discovering hidden abstract semantic structures of texts, where <strong>Latent Dirichlet allocation</strong> (known as LDA) as an unsupervised learning method is one way of performing topic modelling.</p>
<p>Normally, LDA can be applied when we are trying to understand the latent topics in a large document collection without knowing what kind of topics there will be. The main idea of it is that <em><strong>each document can be described by a distribution of topics and each topic can be described by a distribution of words</strong></em>. Applying LDA on a bag of words will result in several generated topics, each of which is composed of a distribution of keywords.</p>
<p>After performing community detection using Louvain algorithm, the original dataset containing reviews has been split into 4 communities with their own wordclouds generated from reviews.</p>
<p>Since the Louvain algorithm has given us 4 communities, upon which we have plotted 4 wordclouds (each corresponding to a community), we decided to use topic modelling to check whether the results from a completely different unsupervised method will generate similar word structure patterns as the ones we have for the wordclouds. In order to understand if these two methods (<strong>LDA vs. wordclouds</strong>) find similar features in clustering words, we have set the input number of topics to 4 in the LDA model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert reviews into bag of words</span>
<span class="n">total_review_text</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">business_reviews</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> 
                                 <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;business_id&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">review</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">tokenize_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create dictionary of words</span>
<span class="n">dictionary</span> <span class="o">=</span> <span class="n">corpora</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">(</span><span class="n">total_review_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute the term frequency of terms in each document</span>
<span class="n">corpus</span> <span class="o">=</span> <span class="p">[</span><span class="n">dictionary</span><span class="o">.</span><span class="n">doc2bow</span><span class="p">(</span><span class="n">review</span><span class="p">)</span> <span class="k">for</span> <span class="n">review</span> <span class="ow">in</span> <span class="n">total_review_text</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute LDA model (num_topics = 4, since we want to compare the topics to the previous 4 wordclouds)</span>
<span class="n">lda_model</span> <span class="o">=</span> <span class="n">gensim</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ldamodel</span><span class="o">.</span><span class="n">LdaModel</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span> <span class="n">num_topics</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">id2word</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">,</span> <span class="n">passes</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The words and scores defining each topic are:&#39;</span><span class="p">)</span>
<span class="n">lda_model</span><span class="o">.</span><span class="n">print_topics</span><span class="p">(</span><span class="n">num_topics</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">num_words</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The words and scores defining each topic are:
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(0,
  &#39;0.030*&quot;great&quot; + 0.028*&quot;nice&quot; + 0.017*&quot;good&quot; + 0.012*&quot;free&quot; + 0.011*&quot;clean&quot; + 0.009*&quot;beautiful&quot; + 0.009*&quot;next&quot; + 0.009*&quot;venetian&quot;&#39;),
 (1,
  &#39;0.035*&quot;great&quot; + 0.028*&quot;nice&quot; + 0.026*&quot;good&quot; + 0.013*&quot;clean&quot; + 0.011*&quot;free&quot; + 0.009*&quot;best&quot; + 0.009*&quot;next&quot; + 0.009*&quot;little&quot;&#39;),
 (2,
  &#39;0.042*&quot;good&quot; + 0.030*&quot;great&quot; + 0.014*&quot;best&quot; + 0.014*&quot;nice&quot; + 0.010*&quot;little&quot; + 0.010*&quot;much&quot; + 0.010*&quot;table&quot; + 0.009*&quot;bad&quot;&#39;),
 (3,
  &#39;0.024*&quot;good&quot; + 0.021*&quot;great&quot; + 0.021*&quot;nice&quot; + 0.016*&quot;clean&quot; + 0.013*&quot;old&quot; + 0.012*&quot;free&quot; + 0.012*&quot;bad&quot; + 0.012*&quot;new&quot;&#39;)]
</pre></div>
</div>
</div>
</div>
<p>Once you provide the algorithm with the number of topics, it will rearrange the topic distribution in the document, as well as the keyword distribution within the topic, in order to get a good combination of topic-keyword distribution.</p>
<p>Let us interactively check for the different kinds of relevant terms in each of the topic. The following visualization makes use of Jupyter notebook’s interactivity, in order to dynamically the top 30 most relevant keywords, depending on a relevance metric <span class="math notranslate nohighlight">\(\lambda\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vis</span> <span class="o">=</span> <span class="n">pyLDAvis</span><span class="o">.</span><span class="n">gensim</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">topic_model</span><span class="o">=</span><span class="n">lda_model</span><span class="p">,</span> <span class="n">corpus</span><span class="o">=</span><span class="n">corpus</span><span class="p">,</span> <span class="n">dictionary</span><span class="o">=</span><span class="n">dictionary</span><span class="p">)</span>
<span class="n">pyLDAvis</span><span class="o">.</span><span class="n">enable_notebook</span><span class="p">()</span>
<span class="n">pyLDAvis</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">vis</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/bmabey/pyLDAvis/files/ldavis.v1.0.0.css">


<div id="ldavis_el1320814014550495448262675019"></div>
<script type="text/javascript">

var ldavis_el1320814014550495448262675019_data = {"mdsDat": {"x": [-0.03325886425578023, -0.028571231786874235, -0.013236136934104943, 0.07506623297675942], "y": [-0.030596607495646008, 0.021134280729101316, 0.012729864540661927, -0.003267537774117239], "topics": [1, 2, 3, 4], "cluster": [1, 1, 1, 1], "Freq": [38.64397426757827, 28.388748944636266, 21.17099071245003, 11.796286075335436]}, "tinfo": {"Term": ["good", "great", "best", "venetian", "table", "delicious", "buffet", "prime", "beautiful", "fresh", "nice", "worth", "red", "grand", "salad", "little", "wynn", "suite", "excellent", "old", "much", "favorite", "many", "spacious", "mgm", "huge", "special", "golden", "asian", "dessert", "adventuredome", "cortez", "quad", "pyramid", "manor", "nomad", "midway", "eataly", "kreme", "ip", "sphinx", "krispy", "aurora", "castle", "fulton", "riviera", "monaco", "apa", "rollercoaster", "thunder", "strat", "egypt", "dome", "sideways", "el", "prizes", "nightingale", "roller", "buca", "linq", "plaza", "titanic", "imperial", "criss", "egyptian", "luxor", "excalibur", "stratosphere", "artisan", "circus", "medieval", "harrahs", "fremont", "tropicana", "lvh", "harrah", "paris", "cheap", "old", "scary", "monte", "freemont", "filthy", "worst", "dirty", "horrible", "gross", "bad", "clean", "new", "downtown", "older", "flamingo", "sleep", "decent", "loud", "low", "nasty", "good", "free", "next", "front", "small", "last", "nice", "stay", "much", "little", "first", "great", "extra", "terrible", "ok", "shower", "sure", "hot", "right", "many", "big", "overall", "friendly", "open", "strip", "comfortable", "best", "gondola", "venezia", "bluegreen", "lavo", "venice", "canal", "prestige", "grazie", "bella", "hrh", "rialto", "phantom", "bouchon", "ihg", "sunken", "mozen", "espa", "octavius", "gondolas", "vdara", "piazza", "sushisamba", "nirvana", "octavious", "palazzo", "augustus", "tao", "rehab", "yardbird", "ugupewqih0yiccg8anm1pa", "mandarin", "delano", "venetian", "xs", "oriental", "encore", "panoramic", "embassy", "forum", "sectional", "palms", "aria", "nobu", "westin", "couch", "beautiful", "suite", "gorgeous", "luxurious", "spacious", "wynn", "separate", "nice", "modern", "great", "hard", "large", "huge", "comfortable", "high", "spa", "free", "front", "big", "ready", "quiet", "able", "clean", "best", "many", "next", "good", "first", "small", "little", "much", "sure", "stay", "last", "overall", "new", "bad", "full", "strip", "equestrian", "chandelier", "eggslut", "lsi", "tabu", "wraparound", "tahiti", "galavantier", "bora", "coronado", "sexxy", "tavo", "dolphin", "eyecandy", "stk", "terrace", "uph", "republic", "nlhe", "hakkasan", "marquee", "shibuya", "rabbit", "momofuku", "fiamma", "straddle", "cpk", "southpoint", "siegfried", "holstein", "silverado", "trump", "roy", "shaun", "cosmo", "senor", "bigelow", "mgm", "cosmopolitan", "lazy", "elara", "mirage", "ph", "secret", "grand", "tuscany", "aladdin", "south", "signature", "balcony", "boulevard", "bamboo", "west", "great", "nice", "planet", "good", "huge", "large", "spacious", "big", "strip", "best", "full", "clean", "many", "free", "comfortable", "little", "next", "beautiful", "first", "much", "sure", "vegas", "awesome", "new", "friendly", "last", "overall", "right", "stay", "bad", "front", "small", "hugo", "veal", "foie", "picasso", "oxtail", "horseradish", "teppanyaki", "sorbet", "ox", "tableside", "lamb", "sams", "scallop", "hibachi", "cellar", "sommelier", "fondant", "saut\u00e9ed", "leek", "congee", "brulee", "firelight", "shellfish", "longhorn", "osso", "alaskan", "lebanese", "figs", "quail", "snapper", "crab", "santana", "sashimi", "portuguese", "dessert", "flavorful", "poached", "salad", "rib", "shrimp", "asparagus", "creamy", "sam", "garlic", "lobster", "pasta", "salmon", "seafood", "vegan", "aloha", "vegetarian", "prime", "entree", "fried", "cal", "delicious", "buffet", "brunch", "dish", "cheese", "fish", "chicken", "chinese", "asian", "tasty", "legs", "sushi", "fresh", "good", "table", "red", "steak", "best", "italian", "great", "meal", "worth", "dry", "golden", "wynn", "excellent", "little", "much", "special", "many", "bad", "nice", "favorite", "sure", "different", "first", "last", "next", "small", "old", "free", "overall", "big", "full", "high", "new"], "Freq": [65765.0, 74734.0, 21912.0, 7912.0, 9567.0, 4526.0, 4154.0, 3210.0, 13098.0, 5000.0, 63365.0, 8791.0, 4173.0, 6610.0, 1552.0, 24805.0, 3757.0, 10476.0, 6558.0, 19767.0, 23552.0, 7390.0, 19960.0, 10090.0, 3107.0, 15567.0, 6529.0, 2449.0, 1922.0, 1114.0, 142.51521198935882, 153.3300285532354, 213.35722794503985, 699.7669660839285, 161.7795204441829, 94.75455163294963, 30.18054940992146, 33.20947906053341, 21.07526039442416, 147.25765649975588, 15.970611093271211, 41.0282177053665, 15.933720882327362, 141.93397417690005, 19.8157399774583, 55.74019908336422, 16.800661685717643, 14.813559273127192, 33.65650897416234, 12.776478072490061, 43.53596368379502, 24.631665482365623, 131.99480455167915, 29.469288101476998, 294.9871802245878, 15.623558654390465, 9.707731213564347, 13.610933848093742, 10.685377709320877, 834.021348171443, 339.06164699070786, 193.78316755359035, 1067.9266775569447, 109.69415088087665, 344.9060448935811, 2094.15802458226, 990.6090404650001, 444.49271006091936, 225.6797636902352, 416.13804416216, 77.76385210828062, 181.4950166839403, 2628.853876432535, 444.8468682146842, 179.87595600085572, 490.9837301130494, 1560.1970509010475, 6904.067237530742, 13404.128318580153, 674.2296161696647, 602.4477621099581, 441.7084144727809, 1201.9840288496678, 5372.6582717621795, 2745.8890769552986, 5476.016175475438, 2219.291318122343, 12604.066613595434, 16325.732235803649, 12066.229427436081, 1661.8187306515856, 2597.999424017279, 1316.9436442746992, 3070.295277489044, 4850.265291995908, 3336.5969814161076, 3491.1545106080234, 1424.97570789542, 24669.114220123884, 12916.128461877852, 11005.140549274616, 7751.74138252982, 8434.827560214944, 8688.764778242212, 21740.70755545917, 6724.764726650092, 9623.88299714661, 9985.442571176989, 8937.357604184721, 21953.543992019793, 5415.659378555258, 3578.682515144305, 4014.7686082825494, 4982.038323196848, 7054.841096255244, 5254.581458148822, 5658.841347115659, 6862.891743248098, 6807.817239448728, 5655.468111988088, 5397.21938229985, 4758.694062728838, 5397.101976446136, 5613.405281728407, 5639.070589468775, 89.17085537226349, 62.422618701771576, 108.64323901264352, 65.07286629571166, 39.38443797326975, 441.1035579848886, 85.43836287662603, 50.81585370346151, 25.82800662943985, 115.81066262203856, 17.414237755259588, 35.720945258711424, 43.8326671109118, 30.182015049922118, 224.10235664618577, 19.992852934529868, 17.21993798030038, 42.66021378714099, 13.55564057921884, 729.1314817139174, 16.0997015724921, 11.640355787985168, 38.53633179038697, 29.50504814891852, 1087.4062111761807, 23.89073357013056, 215.177631320439, 126.18078314396097, 8.757341479674492, 8.742204880671569, 235.5548779952218, 174.25754517880125, 6727.957535581635, 165.1675054992257, 416.7893950249817, 79.05170237658244, 434.84177146821276, 118.85500613682036, 195.1980612823071, 174.94703623198976, 346.7791504232789, 838.4266448919597, 284.6226685632452, 175.2420248445013, 2000.69843993182, 7052.904677471451, 5736.568770136856, 2360.34798606434, 1524.007712342227, 4908.488266665303, 2069.847887135509, 2771.3868071873962, 21543.32411918237, 3411.654879468568, 23119.69978352784, 4035.2799183189386, 5097.434587482754, 5937.885767979482, 5936.156154162047, 4606.113422635253, 1429.4593513327436, 9467.483345111841, 5413.672359321742, 6047.989426715911, 3266.670972414656, 2578.860617013006, 3913.175883145901, 8753.774758171403, 6350.96943956154, 5889.747760668639, 6987.765275573113, 12934.16973909439, 6116.473295142749, 5501.553705932739, 6331.149982650852, 6009.8930162124525, 5140.550905387526, 4497.436436907519, 5300.156874276986, 4492.880563545006, 5463.82581401309, 5346.8767622019695, 4086.13940329513, 4052.8968173496046, 52.05180647226412, 373.7737403974839, 21.86585034354237, 31.86274004664668, 18.988267623506367, 28.950112891571525, 335.15275881700654, 19.782175554985052, 17.102036259275096, 14.363411358462761, 53.16209025584157, 12.509111813988088, 59.97872187756115, 30.195788172326086, 43.39992787546619, 61.578282204853494, 10.491318985193898, 301.79326403522185, 15.614648440441021, 129.17610073206347, 256.75774507837195, 8.638695144877346, 25.247660127663117, 8.63518852108921, 8.62283253894188, 8.539128832136484, 9.426888655236887, 31.589662562707925, 11.07496342112939, 6.748965981817878, 9.235317463078331, 527.7837684470477, 37.6487741583601, 32.271923330402444, 618.1614249218437, 31.55924448313877, 20.81437194008632, 2227.4729799500838, 1068.9371560166571, 1110.3351469207657, 152.07611179296683, 344.29005173975713, 283.7760264803536, 614.1704997909379, 3720.410282440243, 167.385278534798, 109.70670252198262, 1274.5830255325725, 98.3086915790394, 277.80623386160545, 87.12170723111662, 58.92177407540313, 771.2203340888565, 20035.255870732984, 15699.338113300195, 307.00076284369004, 14916.496440717448, 4574.3255328196165, 3794.6315760189163, 3089.5998534776645, 5201.944922714455, 4000.3746571406145, 5381.384656318258, 3481.525153549695, 7153.304914904955, 4522.140907585555, 6162.290336183245, 3813.772760471811, 5230.708926544956, 5309.017227265445, 3296.5397735900365, 4612.6371382985735, 4803.175606650894, 3999.4810811497982, 3090.3786094720404, 2820.032535769785, 4562.95037956115, 3303.046505842023, 3898.8939801014617, 3291.5089567089617, 2995.1069832126213, 3064.181310978635, 3607.254378587111, 3148.151938560622, 3200.0673215345114, 145.31779900480726, 118.57595743770877, 133.24498821756868, 206.91245977358477, 46.227546571969306, 71.89925519940813, 25.607266847423464, 51.149501852211586, 23.820055102394136, 30.327645166824134, 258.4245099833405, 26.17197065857388, 40.9179918835008, 22.801764370334872, 252.2687916139895, 102.02852825530704, 24.446974653401384, 21.182077188046463, 20.35749128728691, 25.179209969205896, 37.375980186062165, 17.84182641214861, 41.335955219960056, 40.526449468590435, 20.267778629338853, 141.70407965822878, 14.542396399698308, 19.307599809463714, 15.326022698746783, 14.5183577113544, 171.85274379160006, 44.91867661023542, 32.89109470131132, 28.124971488050058, 999.107541746788, 299.1554173067407, 36.13699677824489, 1334.9785527251609, 97.00656314590523, 411.5487124960903, 78.91582633792258, 183.8966114288357, 245.64404056691245, 246.3498757869076, 185.6560809748416, 170.1057696893115, 321.0662981915115, 175.48762208953985, 266.7558609656729, 63.40216835396322, 286.78044817864946, 2216.4085594375133, 244.53072429935423, 321.47999919328055, 248.10121866655513, 2550.7706391443544, 2347.937784394434, 468.6959116340502, 584.0728411065627, 947.0668139412957, 720.3277873420586, 488.73438267337934, 858.3396855230486, 1062.116122135425, 735.8327262830686, 385.9736306721231, 328.1971795003286, 2101.4356678236286, 13245.6791918238, 3040.95812159556, 1619.0911033436728, 569.8725005367121, 4541.077198959223, 778.3144211330623, 9625.597720657519, 493.11045366909207, 2202.730732044499, 817.2030557700899, 938.0815717612951, 1168.9360606797234, 1597.1955316914268, 3257.970546711107, 3115.29042480441, 1530.332208730731, 2686.039537520524, 2889.483873006547, 4382.070289638518, 1516.2952530293974, 2084.9598976969746, 1761.6426795301138, 2227.753163532561, 2124.2196562682902, 2242.633367311243, 1983.5008932545334, 1914.9654392714735, 2072.231501885253, 1659.4787469443327, 1744.9896407085905, 1590.7374420958856, 1538.4602079364197, 1547.3495591557455], "Total": [65765.0, 74734.0, 21912.0, 7912.0, 9567.0, 4526.0, 4154.0, 3210.0, 13098.0, 5000.0, 63365.0, 8791.0, 4173.0, 6610.0, 1552.0, 24805.0, 3757.0, 10476.0, 6558.0, 19767.0, 23552.0, 7390.0, 19960.0, 10090.0, 3107.0, 15567.0, 6529.0, 2449.0, 1922.0, 1114.0, 145.45399998639283, 157.98204666500763, 221.4569692074714, 727.5049689933396, 168.52404747960102, 98.7841354356825, 31.972434792731544, 35.21554247110757, 22.360873510558477, 156.2548364725143, 17.01711038634296, 43.757242475188185, 17.011399736681177, 152.06672258048528, 21.257933310965075, 59.8270714545593, 18.04496351277902, 15.917065316820203, 36.24502414912495, 13.762388091375097, 46.92814261682436, 26.56835916880895, 142.6037115577651, 31.867344963184166, 319.18373743887366, 16.915593986051874, 10.528952287206577, 14.785189493119361, 11.611761158690669, 908.2757156138094, 369.68815156860495, 212.19409843445382, 1198.5348810633975, 120.39723728940167, 383.25101082372896, 2405.7756189025217, 1124.6165380112434, 499.41358513440576, 250.290077540598, 467.5298566175559, 85.3362274285861, 205.2114326239268, 3286.5688602307023, 523.8401916555931, 204.60309388385568, 588.9025472153108, 2018.6058673287978, 9743.665381313542, 19767.672625198466, 847.8943611204828, 754.0299637668398, 540.7977010452213, 1630.825745098114, 8609.867621216406, 4125.490309232852, 9025.404447869227, 3336.7620964410153, 24447.68162739106, 33440.710577223566, 23640.355180166065, 2443.7109278529233, 4119.046531975117, 1892.1269911602594, 5088.522283518878, 8831.70413449895, 5742.622089927678, 6072.9499686451945, 2109.011443337235, 65765.45959175951, 30618.133645058188, 25544.556419424418, 17067.894477185655, 19119.94948093673, 20012.03528888895, 63365.44007758025, 14700.39525150985, 23552.242044814368, 24805.272027083905, 21894.221201158605, 74734.09736693813, 11829.211363830538, 6628.508658646416, 7850.67963034386, 10744.593519688688, 18279.832980489544, 11920.883080773088, 13631.313788897594, 19960.819949022814, 19802.741229587686, 15099.336379186389, 13931.3873876388, 10962.769336740126, 14262.759004079797, 15962.538705110406, 21912.5018843078, 90.6124164530736, 63.59012874855337, 110.82477897299212, 66.46965759307771, 40.428690380348236, 455.59431000181235, 88.59535009842821, 52.82528584054394, 26.875641171780728, 121.14142323626913, 18.23705286337415, 37.427741587992024, 46.04713758539142, 31.708950476221112, 236.38951503211723, 21.100073114454165, 18.209833959517976, 45.21616617311893, 14.37642959756672, 773.9705887833926, 17.205798540411585, 12.444107663534066, 41.23494917160574, 31.66326147959184, 1171.2853267748585, 25.88739759061093, 233.31617265850207, 137.2090156539939, 9.547143771773225, 9.545275395577344, 260.15974996186503, 191.96643762235522, 7912.4714183798615, 183.65754431426154, 479.29054237643123, 87.50736814242968, 525.5910713697248, 136.1612716595354, 229.7733545288301, 206.5439960962917, 429.196569009498, 1109.3923525100906, 348.66570561129413, 208.02875875950573, 3106.46460886254, 13098.031716378144, 10476.115363528725, 3998.3835780851314, 2524.125016926245, 10090.384552648798, 3757.2375699372715, 5419.1229033939335, 63365.44007758025, 7409.57756774813, 74734.09736693813, 9155.655227410469, 12878.88216075908, 15567.237104804502, 15962.538705110406, 11913.973048905302, 2768.92276148463, 30618.133645058188, 17067.894477185655, 19802.741229587686, 8720.086059859721, 6355.9011046266205, 11261.361825224241, 33440.710577223566, 21912.5018843078, 19960.819949022814, 25544.556419424418, 65765.45959175951, 21894.221201158605, 19119.94948093673, 24805.272027083905, 23552.242044814368, 18279.832980489544, 14700.39525150985, 20012.03528888895, 15099.336379186389, 23640.355180166065, 24447.68162739106, 12956.51241606499, 14262.759004079797, 53.63525161470157, 391.3689218817195, 22.953516440276886, 33.49912774586961, 20.051640121514367, 30.594085029244223, 355.4770867803286, 20.985651438321767, 18.166211928676976, 15.26773579530097, 56.67103264311586, 13.35494344940052, 64.21803567708858, 32.47167337390822, 46.70146322572596, 66.91461528036132, 11.418355035770272, 328.8241651136605, 17.03703465547926, 141.02925098813435, 280.9412836013048, 9.498185278895322, 27.785752045669675, 9.509427193697231, 9.497835882419396, 9.445014317431145, 10.443850990658543, 35.07394453796346, 12.356033273136033, 7.588216066053657, 10.386807065116, 629.3138792518514, 43.06376261913718, 37.13703500948167, 790.6000374810916, 36.430180192585055, 23.64866972417416, 3107.298012130611, 1457.2192049483388, 1555.0689238619902, 194.06149300748237, 465.24541307198575, 386.69817610076603, 899.7055260117486, 6610.109235224474, 221.9052715934673, 141.8311769743468, 2198.230209180834, 127.56288235191266, 432.4814219643283, 114.41678074810478, 72.52519530184225, 1540.5674852891032, 74734.09736693813, 63365.44007758025, 542.6662411203121, 65765.45959175951, 15567.237104804502, 12878.88216075908, 10090.384552648798, 19802.741229587686, 14262.759004079797, 21912.5018843078, 12956.51241606499, 33440.710577223566, 19960.819949022814, 30618.133645058188, 15962.538705110406, 24805.272027083905, 25544.556419424418, 13098.031716378144, 21894.221201158605, 23552.242044814368, 18279.832980489544, 12357.726732721596, 10675.374763374513, 23640.355180166065, 13931.3873876388, 20012.03528888895, 15099.336379186389, 13631.313788897594, 14700.39525150985, 24447.68162739106, 17067.894477185655, 19119.94948093673, 148.4700704095523, 122.1420559015391, 137.5541498668383, 213.61869415502997, 47.777856824411636, 74.31502599974417, 26.475067840873333, 52.93792538233122, 24.76920087040675, 31.62064915883968, 269.4916313963676, 27.326380901921922, 42.734150424108, 23.850404224954865, 264.1724730738285, 106.92351653443313, 25.656441498238046, 22.23450553786364, 21.36920277590475, 26.45806062839794, 39.30389466394147, 18.806167628731842, 43.57679472708641, 42.74909362060524, 21.388699074806837, 149.82842639697554, 15.402481749810033, 20.4827593304967, 16.260827038470367, 15.405154123663944, 182.58519549935227, 47.91250489364636, 34.98404567837774, 29.871456998192187, 1114.180165850588, 330.708353360157, 38.48246738376476, 1552.7169039143484, 105.69811768155691, 469.0349638770758, 85.83779199739351, 205.38056519357374, 280.47299453933846, 282.11566156285033, 210.59294202233642, 192.80294103043786, 376.4674127611609, 200.68540725125732, 312.0870990469633, 68.81316780450116, 343.06550128524526, 3210.6053403824794, 295.85522651788006, 400.26491137380805, 314.0500149697773, 4526.794922674121, 4154.2038843606115, 661.1510542991219, 862.4446309553914, 1549.1812111901777, 1128.7670892023623, 711.1900986038148, 1443.7102102197155, 1922.7312791052263, 1213.2652538864945, 534.1026205863434, 440.31783320425245, 5000.777484820765, 65765.45959175951, 9567.713999949385, 4173.528681232199, 960.9723684380779, 21912.5018843078, 1601.9724881308573, 74734.09736693813, 804.3901211213182, 8791.130068853488, 1821.1768071947836, 2449.714516173948, 3757.2375699372715, 6558.335779033368, 24805.272027083905, 23552.242044814368, 6529.772012616086, 19960.819949022814, 24447.68162739106, 63365.44007758025, 7390.484834674855, 18279.832980489544, 12126.273002881224, 21894.221201158605, 20012.03528888895, 25544.556419424418, 19119.94948093673, 19767.672625198466, 30618.133645058188, 15099.336379186389, 19802.741229587686, 12956.51241606499, 11913.973048905302, 23640.355180166065], "Category": ["Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4", "Topic4"], "logprob": [30.0, 29.0, 28.0, 27.0, 26.0, 25.0, 24.0, 23.0, 22.0, 21.0, 20.0, 19.0, 18.0, 17.0, 16.0, 15.0, 14.0, 13.0, 12.0, 11.0, 10.0, 9.0, 8.0, 7.0, 6.0, 5.0, 4.0, 3.0, 2.0, 1.0, -8.897100448608398, -8.82390022277832, -8.493499755859375, -7.305799961090088, -8.770299911499023, -9.30519962310791, -10.449299812316895, -10.353699684143066, -10.80840015411377, -8.864299774169922, -11.085800170898438, -10.142200469970703, -11.08810043334961, -8.901100158691406, -10.869999885559082, -9.835800170898438, -11.035099983215332, -11.16100025177002, -10.340299606323242, -11.308899879455566, -10.082900047302246, -10.65250015258789, -8.973699569702148, -10.473199844360352, -8.169599533081055, -11.10770034790039, -11.583600044250488, -11.245599746704102, -11.487600326538086, -7.130199909210205, -8.03030014038086, -8.589799880981445, -6.882999897003174, -9.15880012512207, -8.013199806213379, -6.20959997177124, -6.958199977874756, -7.7596001625061035, -8.437399864196777, -7.825500011444092, -9.502799987792969, -8.65530014038086, -5.9822001457214355, -7.758800029754639, -8.664199829101562, -7.660099983215332, -6.503900051116943, -5.016600131988525, -4.3531999588012695, -7.342899799346924, -7.45550012588501, -7.765900135040283, -6.764800071716309, -5.267399787902832, -5.938600063323975, -5.2484002113342285, -6.151599884033203, -4.414700031280518, -4.156000137329102, -4.4583001136779785, -6.440800189971924, -5.99399995803833, -6.673399925231934, -5.827000141143799, -5.369699954986572, -5.743800163269043, -5.698500156402588, -6.594600200653076, -3.7432000637054443, -4.3902997970581055, -4.5503997802734375, -4.9008002281188965, -4.816400051116943, -4.7866997718811035, -3.8696000576019287, -5.043000221252441, -4.684500217437744, -4.647600173950195, -4.758500099182129, -3.859800100326538, -5.259500026702881, -5.673799991607666, -5.558800220489502, -5.342899799346924, -4.994999885559082, -5.289700031280518, -5.2154998779296875, -5.022600173950195, -5.030700206756592, -5.216100215911865, -5.262899875640869, -5.388800144195557, -5.262899875640869, -5.223599910736084, -5.218999862670898, -9.057600021362305, -9.414199829101562, -8.859999656677246, -9.372599601745605, -9.874699592590332, -7.458799839019775, -9.100299835205078, -9.61989974975586, -10.296600341796875, -8.796199798583984, -10.690799713134766, -9.972399711608887, -9.7677001953125, -10.140899658203125, -8.13599967956543, -10.55270004272461, -10.70199966430664, -9.7947998046875, -10.941300392150879, -6.956299781799316, -10.76930046081543, -11.093600273132324, -9.896499633789062, -10.16349983215332, -6.556600093841553, -10.374600410461426, -8.176600456237793, -8.710399627685547, -11.378199577331543, -11.379899978637695, -8.086199760437012, -8.38759994506836, -4.734099864959717, -8.441100120544434, -7.515500068664551, -9.178000450134277, -7.473100185394287, -8.7701997756958, -8.274100303649902, -8.383600234985352, -7.699399948120117, -6.8165998458862305, -7.896900177001953, -8.3818998336792, -5.946899890899658, -4.6869001388549805, -4.893499851226807, -5.781499862670898, -6.218999862670898, -5.0493998527526855, -5.912899971008301, -5.620999813079834, -3.5703001022338867, -5.4131999015808105, -3.4997000694274902, -5.245299816131592, -5.011600017547607, -4.859000205993652, -4.859300136566162, -5.11299991607666, -6.283100128173828, -4.392499923706055, -4.951399803161621, -4.84060001373291, -5.456600189208984, -5.692999839782715, -5.276000022888184, -4.470900058746338, -4.7916998863220215, -4.867099761962891, -4.696199893951416, -4.08050012588501, -4.829400062561035, -4.935299873352051, -4.794899940490723, -4.84689998626709, -5.003200054168701, -5.1367998123168945, -4.972599983215332, -5.137899875640869, -4.942200183868408, -4.963799953460693, -5.232800006866455, -5.240900039672852, -9.302499771118164, -7.331099987030029, -10.1697998046875, -9.793299674987793, -10.31089973449707, -9.889200210571289, -7.440199851989746, -10.270000457763672, -10.415599822998047, -10.590100288391113, -9.281399726867676, -10.728300094604492, -9.160799980163574, -9.847000122070312, -9.484299659729004, -9.134400367736816, -10.904199600219727, -7.545000076293945, -10.506500244140625, -8.393600463867188, -7.706600189208984, -11.09850025177002, -10.026000022888184, -11.098899841308594, -11.100299835205078, -11.110099792480469, -11.011199951171875, -9.801899909973145, -10.850099563598633, -11.345399856567383, -11.031700134277344, -6.986100196838379, -9.626399993896484, -9.780599594116211, -6.828000068664551, -9.802900314331055, -10.219099998474121, -5.54610013961792, -6.280300140380859, -6.242300033569336, -8.230400085449219, -7.413300037384033, -7.606599807739258, -6.834499835968018, -5.033199787139893, -8.134400367736816, -8.556900024414062, -6.104400157928467, -8.666600227355957, -7.627799987792969, -8.787400245666504, -9.178500175476074, -6.606800079345703, -3.3494999408721924, -3.593400001525879, -7.527900218963623, -3.6445000171661377, -4.826499938964844, -5.013400077819824, -5.218999862670898, -4.697999954223633, -4.960599899291992, -4.664000034332275, -5.0995001792907715, -4.37939977645874, -4.8379998207092285, -4.528500080108643, -5.008399963378906, -4.692399978637695, -4.677599906921387, -5.154099941253662, -4.81820011138916, -4.777699947357178, -4.9608001708984375, -5.218699932098389, -5.310200214385986, -4.828999996185303, -5.152100086212158, -4.986299991607666, -5.155600070953369, -5.25, -5.227200031280518, -5.064000129699707, -5.200200080871582, -5.183800220489502, -7.690999984741211, -7.8942999839782715, -7.777699947357178, -7.337600231170654, -8.836299896240234, -8.394599914550781, -9.427000045776367, -8.735099792480469, -9.49940013885498, -9.257800102233887, -7.115300178527832, -9.405200004577637, -8.95829963684082, -9.543100357055664, -7.139400005340576, -8.044599533081055, -9.473400115966797, -9.616700172424316, -9.656499862670898, -9.443900108337402, -9.04889965057373, -9.788399696350098, -8.948200225830078, -8.967900276184082, -9.660900115966797, -7.71619987487793, -9.992799758911133, -9.709400177001953, -9.940299987792969, -9.994500160217285, -7.5233001708984375, -8.864999771118164, -9.1766996383667, -9.333200454711914, -5.763000011444092, -6.968900203704834, -9.082599639892578, -5.473199844360352, -8.095100402832031, -6.650000095367432, -8.30150032043457, -7.45550012588501, -7.165999889373779, -7.163099765777588, -7.446000099182129, -7.5335001945495605, -6.8983001708984375, -7.502299785614014, -7.083600044250488, -8.520400047302246, -7.011199951171875, -4.966300010681152, -7.170599937438965, -6.896999835968018, -7.156099796295166, -4.825699806213379, -4.908599853515625, -6.519899845123291, -6.299900054931641, -5.816500186920166, -6.090199947357178, -6.478099822998047, -5.914899826049805, -5.701900005340576, -6.068900108337402, -6.714099884033203, -6.876299858093262, -5.019499778747559, -3.178499937057495, -4.650000095367432, -5.280300140380859, -6.32450008392334, -4.249000072479248, -6.012800216674805, -3.4976999759674072, -6.469200134277344, -4.972400188446045, -5.964000225067139, -5.826099872589111, -5.606100082397461, -5.293900012969971, -4.580999851226807, -4.625800132751465, -5.336699962615967, -4.774099826812744, -4.701099872589111, -4.284599781036377, -5.345900058746338, -5.027400016784668, -5.195899963378906, -4.96120023727417, -5.008699893951416, -4.954500198364258, -5.077300071716309, -5.112400054931641, -5.0335001945495605, -5.2555999755859375, -5.205399990081787, -5.297900199890137, -5.331399917602539, -5.3256001472473145], "loglift": [30.0, 29.0, 28.0, 27.0, 26.0, 25.0, 24.0, 23.0, 22.0, 21.0, 20.0, 19.0, 18.0, 17.0, 16.0, 15.0, 14.0, 13.0, 12.0, 11.0, 10.0, 9.0, 8.0, 7.0, 6.0, 5.0, 4.0, 3.0, 2.0, 1.0, 0.9304, 0.9209, 0.9135, 0.9119, 0.9099, 0.9091, 0.8931, 0.8921, 0.8916, 0.8915, 0.8873, 0.8864, 0.8853, 0.8818, 0.8805, 0.88, 0.8793, 0.8789, 0.8767, 0.8764, 0.8757, 0.8751, 0.8735, 0.8725, 0.8719, 0.8713, 0.8696, 0.868, 0.8676, 0.8655, 0.8643, 0.86, 0.8354, 0.8577, 0.8454, 0.8121, 0.8239, 0.8343, 0.8473, 0.8343, 0.8579, 0.828, 0.7275, 0.7873, 0.822, 0.7689, 0.6932, 0.6063, 0.5623, 0.7216, 0.7263, 0.7484, 0.6457, 0.4792, 0.5437, 0.4511, 0.543, 0.2883, 0.2337, 0.2782, 0.5652, 0.4899, 0.5884, 0.4456, 0.3515, 0.4078, 0.3972, 0.5587, -0.0298, 0.0877, 0.1087, 0.1615, 0.1324, 0.1165, -0.119, 0.1687, 0.0558, 0.0409, 0.0548, -0.2742, 0.1695, 0.3344, 0.2802, 0.1822, -0.0013, 0.1316, 0.0716, -0.1169, -0.117, -0.0312, 0.0025, 0.1162, -0.021, -0.0943, -0.4066, 1.2431, 1.2406, 1.2393, 1.2379, 1.233, 1.2269, 1.2229, 1.2204, 1.2194, 1.2142, 1.213, 1.2125, 1.2099, 1.2098, 1.2058, 1.2053, 1.2033, 1.201, 1.2004, 1.1995, 1.1927, 1.1924, 1.1915, 1.1886, 1.1849, 1.1789, 1.1782, 1.1754, 1.1728, 1.1713, 1.1598, 1.1624, 1.097, 1.1531, 1.1195, 1.1576, 1.0696, 1.1232, 1.0961, 1.0931, 1.046, 0.9791, 1.0562, 1.0877, 0.8192, 0.6402, 0.6569, 0.7321, 0.7546, 0.5386, 0.663, 0.5886, 0.1803, 0.4836, 0.0859, 0.4399, 0.3323, 0.2954, 0.27, 0.3088, 0.598, 0.0854, 0.1109, 0.0731, 0.2773, 0.3571, 0.2021, -0.0811, 0.0207, 0.0386, -0.0371, -0.367, -0.0161, 0.0135, -0.1064, -0.1066, -0.0095, 0.0748, -0.0694, 0.047, -0.2056, -0.2608, 0.1052, 0.001, 1.5226, 1.5065, 1.504, 1.5025, 1.498, 1.4973, 1.4937, 1.4935, 1.4922, 1.4915, 1.4886, 1.4871, 1.4842, 1.4799, 1.4792, 1.4694, 1.4679, 1.4668, 1.4654, 1.4647, 1.4625, 1.4577, 1.4567, 1.4561, 1.4559, 1.4517, 1.4501, 1.4479, 1.4431, 1.4353, 1.435, 1.3766, 1.4182, 1.4121, 1.3065, 1.409, 1.4249, 1.2197, 1.2427, 1.2157, 1.3087, 1.2515, 1.2431, 1.1707, 0.9778, 1.2706, 1.2957, 1.0075, 1.292, 1.1099, 1.28, 1.3448, 0.8606, 0.2361, 0.1572, 0.9829, 0.0689, 0.3278, 0.3305, 0.369, 0.2158, 0.2813, 0.1484, 0.2384, 0.0103, 0.0678, -0.0506, 0.1209, -0.004, -0.0185, 0.1729, -0.0049, -0.0374, 0.0329, 0.1666, 0.2213, -0.0924, 0.1132, -0.0831, 0.0292, 0.0371, -0.0156, -0.3611, -0.1378, -0.235, 2.1159, 2.1078, 2.1056, 2.1055, 2.1044, 2.1043, 2.1041, 2.103, 2.0983, 2.0956, 2.0955, 2.0942, 2.094, 2.0924, 2.0913, 2.0905, 2.0891, 2.0889, 2.0889, 2.0878, 2.0871, 2.0847, 2.0846, 2.084, 2.0836, 2.0816, 2.0799, 2.0783, 2.0782, 2.0781, 2.0768, 2.0729, 2.0757, 2.0771, 2.0284, 2.0371, 2.0745, 1.9863, 2.0516, 2.0066, 2.0533, 2.0269, 2.0048, 2.0018, 2.0114, 2.0121, 1.9782, 2.0032, 1.9804, 2.0555, 1.9582, 1.7668, 1.9469, 1.9182, 1.9017, 1.5638, 1.5668, 1.7934, 1.7476, 1.6453, 1.6882, 1.7623, 1.6174, 1.5439, 1.6373, 1.8126, 1.8435, 1.2704, 0.535, 0.9912, 1.1905, 1.6149, 0.5635, 1.4155, 0.0879, 1.648, 0.7533, 1.336, 1.1775, 0.9698, 0.7249, 0.1074, 0.1145, 0.6865, 0.1317, 0.0019, -0.534, 0.5535, -0.0337, 0.2083, -0.1478, -0.1055, -0.2954, -0.1285, -0.197, -0.5556, -0.0708, -0.2917, 0.04, 0.0905, -0.589]}, "token.table": {"Topic": [1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 2, 1, 2, 3, 4, 1, 2, 3, 4, 3, 4, 1, 2, 3, 4, 3, 1, 2, 4, 1, 2, 3, 4, 3, 4, 1, 2, 3, 4, 1, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 4, 3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 1, 2, 3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 2, 3, 2, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 2, 3, 1, 2, 3, 4, 3, 4, 1, 2, 3, 4, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 3, 4, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 3, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 2, 3, 2, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 2, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 4, 1, 2, 3, 4, 3, 1, 2, 3, 4, 1, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 2, 3, 1, 2, 3, 4, 4, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 2, 3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 4, 1, 2, 3, 4, 1, 2, 3, 4, 3, 1, 2, 1, 2, 3, 4, 2, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 3, 4, 1, 2, 3, 4, 4, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 2, 3, 2, 3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 3, 4, 2, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 4, 1, 2, 3, 4, 1, 2, 3, 4, 4, 1, 2, 3, 4, 1, 2, 3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 2, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 1, 3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 4, 1, 3, 4, 2, 3, 4, 4, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 1, 2, 3, 4, 2, 3, 4, 3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 2, 3, 1, 2, 3, 4, 2, 3, 1, 2, 3, 4, 1, 2, 3, 4, 4, 1, 2, 3, 4, 2, 3, 4, 1, 2, 3, 4, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 1, 2, 3, 4, 1, 2, 3, 4, 2, 3, 4, 3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 2, 1, 2, 3, 4, 3, 4, 3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 3, 4, 2, 3, 4, 1, 2, 3, 4, 1, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 2, 3, 1, 2, 3, 4, 1, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 2, 2, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 2, 3, 1, 2, 3, 4, 1, 2, 3, 4, 2], "Freq": [0.36638552814795483, 0.34747129705354995, 0.215515675427796, 0.0706841687847242, 0.9831286868245466, 0.0068750257819898365, 0.0068750257819898365, 0.0068750257819898365, 0.14806335565979475, 0.04935445188659825, 0.7755699582179725, 0.028202543935198998, 0.006674300892345127, 0.013348601784690254, 0.03337150446172563, 0.947750726713008, 0.043596307156255724, 0.014532102385418575, 0.02906420477083715, 0.9155224502813702, 0.9423847739161375, 0.06282565159440917, 0.04777390062233905, 0.7553684664437759, 0.1622509832456798, 0.03425298535186573, 0.9029522952756365, 0.023972184830326634, 0.023972184830326634, 0.05193973379904104, 0.16903038065269524, 0.17943225023132262, 0.09933785447589166, 0.5523392746251149, 0.011649880276864127, 0.011649880276864127, 0.05824940138432063, 0.920340541872266, 0.038628834609574225, 0.9270920306297815, 0.038628834609574225, 0.038628834609574225, 0.9405457662310805, 0.3036895726717509, 0.3187710104262703, 0.2641593445201535, 0.11343864050138505, 0.5155499074349259, 0.21871194502178268, 0.14753955221499349, 0.11817071426368621, 0.15260771133295933, 0.14798323523196058, 0.6428021780388288, 0.0578059512624846, 0.041364935144460005, 0.08272987028892001, 0.8135103911743801, 0.055153246859280004, 0.09909885913445642, 0.5384778532167342, 0.25171720998944747, 0.11078000354706953, 0.9674187802187154, 0.25734167781353423, 0.28983454438619544, 0.24556757728580028, 0.20723329649782923, 0.34379078740008107, 0.30541226236716956, 0.26269090423842856, 0.088119113397935, 0.887999208620744, 0.08457135320197562, 0.009023252825468743, 0.9835345579760929, 0.009023252825468743, 0.009023252825468743, 0.9358032410248387, 0.021716876497384123, 0.9555425658849014, 0.021716876497384123, 0.13109965078482128, 0.07865979047089276, 0.7603779745519634, 0.026219930156964256, 0.025442771220263546, 0.9413825351497512, 0.11495103805070184, 0.07108814195240772, 0.10436344244076877, 0.7093689058655153, 0.9473153856396017, 0.22748040931684999, 0.08641848353941708, 0.12108216495912755, 0.5652105831491679, 0.089157773174106, 0.070052536065369, 0.050947298956632005, 0.7896831338277961, 0.010974676132325072, 0.9679664348710714, 0.015364546585255101, 0.004389870452930029, 0.9338006211374931, 0.0394563642734152, 0.0197281821367076, 0.006576060712235867, 0.026497840288014052, 0.007570811510861158, 0.011356217266291737, 0.9539222503685059, 0.007665401702250307, 0.025551339007501023, 0.9556200788805383, 0.012775669503750512, 0.7085629206069136, 0.11617804549927958, 0.0860045955197847, 0.08928878055156646, 0.12458193954710137, 0.11812691677264016, 0.14523801242537723, 0.6112906567414766, 0.12795453730113543, 0.08014734754027164, 0.10545703623719953, 0.6875798762665409, 0.14130259560120007, 0.14060993581884124, 0.12398610104222947, 0.5943020932638708, 0.8897827467311723, 0.05561142167069827, 0.021389008334883948, 0.032083512502325925, 0.48820732927605975, 0.2617767340734183, 0.21390095714269602, 0.03612363431125078, 0.3516357957649304, 0.37187067230725585, 0.23893442455860409, 0.037525359284374366, 0.944891628722289, 0.9169663522936291, 0.9684644757415266, 0.006329833174781219, 0.006329833174781219, 0.01898949952434366, 0.031621551751568076, 0.16063748289796584, 0.7816847592987629, 0.026562103471317187, 0.03774312046755509, 0.19283303366150872, 0.7335890141784799, 0.03568440480568845, 0.18606360373493516, 0.6441406073937808, 0.15709176232292105, 0.012876373960895167, 0.8617510923939848, 0.010953790610077667, 0.010953790610077667, 0.03833826713527184, 0.9420259924666794, 0.02434504937352489, 0.03895207899763982, 0.03895207899763982, 0.8958978169457159, 0.9136422269855778, 0.02491751528142485, 0.04152919213570808, 0.016611676854283233, 0.5491578891388162, 0.1508202697593615, 0.1888650224914527, 0.11119031899676651, 0.020836975721083992, 0.9064084438671536, 0.057301683232980974, 0.010418487860541996, 0.1038262187769611, 0.15772748980159623, 0.17473731713314092, 0.5635333704255909, 0.02602810648478992, 0.03141323196440163, 0.045773566576699516, 0.8966233923553493, 0.38255777343110825, 0.26075612838740336, 0.21144171827492167, 0.14530433213744617, 0.6656178524657902, 0.17767585063999425, 0.1214401107375677, 0.0351473374390166, 0.05565574678901645, 0.12754441972482936, 0.1402988616973123, 0.6771449192663668, 0.015571949366815893, 0.04671584810044768, 0.9343169620089536, 0.925642106773148, 0.014024880405653757, 0.014024880405653757, 0.04207464121696127, 0.6801131758494263, 0.03437395112596379, 0.027826531863875445, 0.2573954197408479, 0.23391468544791175, 0.16472865172388151, 0.15264855059746352, 0.44861102819470394, 0.9370862319407602, 0.028396552483053342, 0.9584588077056578, 0.940968911220901, 0.03763875644883604, 0.03763875644883604, 0.9001933204520053, 0.06001288803013369, 0.033920328017032084, 0.007827768003930482, 0.9242325513419836, 0.03446290869410786, 0.012531966797857404, 0.025063933595714807, 0.01030601161005644, 0.19581422059107237, 0.7832568823642895, 0.00515300580502822, 0.10281925124059002, 0.8739636355450152, 0.014688464462941432, 0.007344232231470716, 0.022855218279959448, 0.9027811220583982, 0.045710436559918896, 0.022855218279959448, 0.027040252403709077, 0.03718034705509998, 0.11154104116529995, 0.8281077298635905, 0.018644454344759653, 0.9695116259275021, 0.9335615051621261, 0.8811892467386893, 0.025786567260768906, 0.0844732375783809, 0.008002727770583454, 0.17870387236756285, 0.2922997639322679, 0.2854382671263461, 0.24350689775682413, 0.45784962610104124, 0.2930880084365417, 0.17794930999680425, 0.0711797239987217, 0.06159214454303574, 0.9238821681455361, 0.16250625322510903, 0.34598542006378336, 0.28631409810518793, 0.20512862605267718, 0.9475842825057762, 0.9276093954641635, 0.7370499292232384, 0.13919328946229212, 0.10117573903646783, 0.022687892996056423, 0.9571328063937817, 0.40818990170461367, 0.2793431172457667, 0.2106948659016877, 0.10176201197246047, 0.1373179653116304, 0.07707524504588287, 0.1470631112369719, 0.6378640969314444, 0.6960420765375852, 0.2806365547771129, 0.011627126563270215, 0.012155632316146135, 0.009071437021528328, 0.030238123405094422, 0.05442862212916996, 0.9041198898123233, 0.02180959282511071, 0.9668919485799082, 0.03897656656979008, 0.935437597674962, 0.047873261991393384, 0.84866237166561, 0.047873261991393384, 0.056577491444374, 0.42184151881134213, 0.30919585464439264, 0.20125328576304508, 0.06767231549838192, 0.8173111667185881, 0.02218944344032366, 0.014792962293549105, 0.14792962293549106, 0.7999223846523806, 0.015517703163663526, 0.013996359716245533, 0.1706947348002988, 0.2203657337973912, 0.19956896763139417, 0.159975124353823, 0.42013467033422763, 0.14490403318374742, 0.02498345399719783, 0.027481799396917615, 0.8019688733100504, 0.38739860215133426, 0.2765697265312379, 0.23709052860957144, 0.09891333588373886, 0.4541860749351338, 0.3172037422212093, 0.18443985602371016, 0.0441765093525659, 0.29313443911733517, 0.3153626430314459, 0.2687451598226859, 0.12279539037274362, 0.940825230159311, 0.047041261507965546, 0.9530321257255863, 0.04765160628627931, 0.021267872782253554, 0.07089290927417852, 0.031901809173380334, 0.8719827840723957, 0.5294494486752281, 0.05225098645368481, 0.03551434235523889, 0.382901760105909, 0.9822053476091916, 0.011036015141676311, 0.9738161971988906, 0.37510571891587685, 0.19666858682791968, 0.22680598740724062, 0.20141271850337283, 0.06327557000450777, 0.5902385186191239, 0.2771119824703344, 0.06952809668479511, 0.17125284314027803, 0.23040466440162846, 0.5627743608496769, 0.035551606128944646, 0.9654467399181962, 0.018930328233690123, 0.2937614927254384, 0.30936347416471416, 0.26808378913884295, 0.1288033218992015, 0.6650159453581607, 0.1441517213687586, 0.12467175902162905, 0.06593218025182306, 0.028362910332244085, 0.028362910332244085, 0.9147038582148718, 0.021272182749183063, 0.31019079786857034, 0.4407112216196061, 0.14854207221875199, 0.10059356508343426, 0.833754247322832, 0.07811139587953211, 0.044149919410170324, 0.044149919410170324, 0.8820171356227652, 0.05847627418493471, 0.038984182789956474, 0.019492091394978237, 0.9643442426831039, 0.27396402414221577, 0.38660486985264886, 0.21025731632238065, 0.1290921167679926, 0.9224829576631223, 0.6067318125884993, 0.19855065890405238, 0.12553454047895723, 0.06913817586837538, 0.01345622889243748, 0.01345622889243748, 0.9688484802554986, 0.4408230467821353, 0.26977867144649803, 0.1866472462588489, 0.10267695704307014, 0.008254814689188867, 0.9575585039459086, 0.016509629378377733, 0.0247644440675666, 0.2349164450557089, 0.38144212489494106, 0.29382220937511966, 0.08980398966034484, 0.006735364220152358, 0.006735364220152358, 0.006735364220152358, 0.9766278119220919, 0.03153683691769965, 0.9461051075309896, 0.03153683691769965, 0.8910879582014495, 0.059238993475939056, 0.027533616685999844, 0.022527504561272598, 0.9407708799199808, 0.025599207616870227, 0.012799603808435114, 0.01919940571265267, 0.16042722450237668, 0.2303410344022451, 0.12359762821583883, 0.4856512866258718, 0.9391404137268657, 0.0447209720822317, 0.9369877460456602, 0.022853359659650248, 0.022853359659650248, 0.022853359659650248, 0.007421380729475807, 0.007421380729475807, 0.025974832553165326, 0.9573581141023791, 0.22307836690623667, 0.3957641615458017, 0.2946684310508765, 0.08649819030057349, 0.4341887206657232, 0.264840628326428, 0.1948327565744798, 0.10613613105006285, 0.9778897974460039, 0.015044458422246214, 0.18327161942906478, 0.07330864777162592, 0.7137947283026734, 0.029580682434164843, 0.9738690325138677, 0.9359263520373994, 0.12357175841516096, 0.06740277731736052, 0.08799807038655402, 0.722707556791699, 0.9182233826832922, 0.04734245258439036, 0.024221719926897395, 0.009908885424639843, 0.402535396068133, 0.2552280012526139, 0.21088258956759176, 0.1313430466089111, 0.009496994442424718, 0.04273647499091124, 0.06647896109697303, 0.8832204831454988, 0.023392308825888088, 0.023392308825888088, 0.9590846618614116, 0.5810934356716526, 0.19120185566900644, 0.17622611833974, 0.051544398249568225, 0.574844189071889, 0.17931977138335348, 0.1509974567112352, 0.09468215660737213, 0.029851523525811757, 0.9552487528259762, 0.8704053626394513, 0.03865697169315615, 0.08396460518298432, 0.006650661796672026, 0.13707720405280946, 0.6037735808568833, 0.2270093581568203, 0.032090328116409154, 0.8797520926158536, 0.0635376511333672, 0.024437558128218156, 0.03421258137950542, 0.019218960660643755, 0.9071349431823853, 0.053813089849802515, 0.019218960660643755, 0.9612871422377229, 0.017801613745143018, 0.005933871248381005, 0.017801613745143018, 0.3438235512131845, 0.29507805866904513, 0.22654379988139592, 0.13456361045586676, 0.01423785051710863, 0.05695140206843452, 0.9147818957242295, 0.017797313146385788, 0.11810189795415463, 0.11810189795415463, 0.15166770053059858, 0.6128866914884025, 0.9140315004582849, 0.05859176284989006, 0.011718352569978012, 0.011718352569978012, 0.1921283371177679, 0.07498476138767154, 0.7166998438212212, 0.01609115051237587, 0.9383082706863493, 0.03127694235621164, 0.03127694235621164, 0.10317135570033688, 0.10747016218785091, 0.7393947158524142, 0.049436274606411416, 0.23631576618100678, 0.4604850909249544, 0.2654672256299488, 0.0377889289152952, 0.9464292450722084, 0.9420911263112834, 0.05541712507713432, 0.7983767607757158, 0.12068485918702682, 0.071615191165928, 0.007957243462880889, 0.9478640140966819, 0.4086235179516156, 0.25517740470586137, 0.2039296297507907, 0.13225917065869522, 0.6756720095103532, 0.14651414100961344, 0.11142661209468982, 0.06638181146066628, 0.5103984228681644, 0.23113019911749133, 0.19301740457048186, 0.06543894912788416, 0.4308158583498304, 0.2735612192774752, 0.2078329297573148, 0.08780735759006537, 0.34310501076583433, 0.33998027905470624, 0.24775334915656283, 0.06915441595031903, 0.9497621156618506, 0.9457996380132627, 0.024251272769570842, 0.024251272769570842, 0.05869566037880842, 0.9391305660609347, 0.15774422065276505, 0.8174018706552371, 0.008604230217423547, 0.017208460434847094, 0.9616928829817383, 0.02024616595751028, 0.01012308297875514, 0.01012308297875514, 0.031582343488037, 0.9474703046411099, 0.031582343488037, 0.031582343488037, 0.022115983831342636, 0.9509873047477333, 0.022115983831342636, 0.022115983831342636, 0.5114206908254825, 0.2011290836397103, 0.15310776348000746, 0.134383269942935, 0.6780767900270417, 0.13274197978446414, 0.09232245164125269, 0.09687533966739666, 0.6307284901572202, 0.16727172044585248, 0.13231217364729986, 0.06991909359710524, 0.43410564008228325, 0.27000476878410556, 0.2204734885645889, 0.07543714317042409, 0.03755550842032458, 0.8700359450708529, 0.06050609689941183, 0.031296257016937154, 0.04675366166509269, 0.9350732333018539, 0.3745197708023188, 0.2975627462802508, 0.21802282678713233, 0.10987237838391632, 0.9689452689882394, 0.020930197929871556, 0.9627891047740915, 0.014513969919532422, 0.9280403119136319, 0.032442991584837176, 0.024759125156849426, 0.0419388254699717, 0.8084873576711211, 0.04659869496663522, 0.10251712892659749, 0.028539297596720997, 0.827639630304909, 0.12176766974600958, 0.020928818237595397, 0.7728105943060264, 0.07133636255132551, 0.11938932899214895, 0.03665896408887561, 0.031119857238343568, 0.03630650011140083, 0.051866428730572615, 0.8817292884197344, 0.10343984655768527, 0.14481578518075938, 0.7344229105595655, 0.018101973147594923, 0.9618533866213801, 0.02671814962837167, 0.9299190596949335, 0.05811994123093334, 0.004681238240667587, 0.004681238240667587, 0.02340619120333794, 0.9690163158181907, 0.24508618727678175, 0.16769054918937698, 0.5657252593531729, 0.022113039453544217, 0.9169890854267478, 0.05950961616338777, 0.008114947658643786, 0.016229895317287572, 0.05197171948604765, 0.9354909507488577, 0.033476773498544776, 0.9373496579592536, 0.011287274093832393, 0.9594182979757535, 0.022574548187664786, 0.011287274093832393, 0.16134029103006808, 0.04858896795500119, 0.09935821011311143, 0.6902125191556581, 0.9458727853833068, 0.05911704908645667, 0.9621927407157113, 0.012371049523487717, 0.020618415872479527, 0.005498244232661207, 0.9618121333560359, 0.018062199687437292, 0.009031099843718646, 0.009031099843718646, 0.9224623055464852, 0.2883934110720686, 0.40576465202120293, 0.2599159384021044, 0.04578422401635132, 0.07197933662953326, 0.03598966831476663, 0.8997417078691657, 0.3316481030287588, 0.3746522657658904, 0.24128202239713295, 0.05240773965565103, 0.19072589666856865, 0.20989432849455544, 0.2115715662793293, 0.38792113907840786, 0.03644075410182027, 0.9183070033658708, 0.04372890492218433, 0.007288150820364054, 0.009123417066878366, 0.054740502401270194, 0.9184239847324221, 0.01824683413375673, 0.9321681593708296, 0.009460906418530179, 0.009460906418530179, 0.06622634492971126, 0.9177079225974274, 0.4151470714883793, 0.2673256632803771, 0.2197146985523407, 0.09786290746872203, 0.9360311083007615, 0.05014452365896937, 0.016714841219656457, 0.016714841219656457, 0.9468935116804037, 0.9380597971217202, 0.05517998806598354, 0.04644276018536329, 0.04644276018536329, 0.8824124435219024, 0.023221380092681643, 0.03606581461103813, 0.039930009033649363, 0.06375920797308526, 0.8597832590309983, 0.021250179242141665, 0.05046917570008645, 0.07437562734749582, 0.8526634420909344, 0.06061189608618673, 0.042784867825543575, 0.021392433912771788, 0.8770897904236432, 0.9514615233285929, 0.0208713779882673, 0.0417427559765346, 0.9392120094720287, 0.028584458446956024, 0.028584458446956024, 0.9432871287495488, 0.9444779405702829, 0.02340048860397751, 0.959420032763078, 0.7949103460356979, 0.09671016079366057, 0.06840474787844285, 0.04009933496322512, 0.02491461670523966, 0.034880463387335525, 0.06976092677467105, 0.8720115846833881, 0.12559664994046554, 0.11337042737988924, 0.6824455138358039, 0.07891470925462879, 0.0387326678635111, 0.8472771095143053, 0.09199008617583887, 0.01936633393175555, 0.054899536302789875, 0.08234930445418481, 0.878392580844638, 0.027449768151394938, 0.15888179975781058, 0.5113373601961593, 0.29082197028839657, 0.03893619018455056, 0.03529139856326495, 0.017645699281632475, 0.9352220619265211, 0.05385459554025701, 0.026927297770128505, 0.8616735286441122, 0.026927297770128505, 0.02294799345070741, 0.02294799345070741, 0.9408677314790037, 0.9475494250462481, 0.46367505581954743, 0.32797890339383484, 0.18688468729137922, 0.02140611458018786, 0.04477278159907852, 0.03198055828505609, 0.04690481881808226, 0.8783993342295405, 0.9100224707613149, 0.03138008519866603, 0.03138008519866603, 0.03138008519866603, 0.08093212262337929, 0.8902533488571722, 0.054874896764160824, 0.0783927096630869, 0.7682485546982515, 0.10191052256201295, 0.09627597718248672, 0.8664837946423806, 0.60331857245538, 0.22639185520149765, 0.1440496787002585, 0.026137254116145127, 0.4411622535096128, 0.2877622666046105, 0.16736445894851937, 0.10376596454808201, 0.9737000928123409, 0.009352479533143346, 0.009352479533143346, 0.028057438599430037, 0.9539529123806213, 0.018890048916306117, 0.018890048916306117, 0.9633924947316119, 0.2815901616740446, 0.10053542121157327, 0.5800120454513843, 0.038212558288561786, 0.028511192943172285, 0.9123581741815131, 0.05702238588634457, 0.1877986656880196, 0.5160851793618846, 0.2661684934847508, 0.029614404973880012, 0.18393748923204187, 0.4864036622580073, 0.3062321345511904, 0.023487707407324313, 0.3085865779244429, 0.24059032948848624, 0.2163934663063215, 0.23431139663741818, 0.9402301352432173, 0.4574706927903376, 0.30591014207853506, 0.2084297699196423, 0.02816250807660963, 0.1748229246935162, 0.03746205529146776, 0.1945945649862353, 0.5931492087815728, 0.021412605321735192, 0.9207420288346132, 0.042825210643470384, 0.9528836799527287, 0.9376036967682037, 0.021309174926550083, 0.04261834985310017, 0.021309174926550083, 0.8890426957058197, 0.06407514924005908, 0.028032877792525848, 0.018021135723766617, 0.37839803634459596, 0.28416661873349036, 0.28045064765210004, 0.0569314814733763, 0.18814225804173446, 0.547626653670944, 0.24990179175710847, 0.014318284478061983, 0.012690918205878983, 0.9475885593722974, 0.029612142480384292, 0.008460612137252655, 0.3859444453092078, 0.2812388934563625, 0.2187656749527317, 0.11406012309988636, 0.08403021002067074, 0.08857238353530159, 0.08175912326335531, 0.7449164563994595, 0.9643118112168485, 0.3015349330064906, 0.1936721770748794, 0.1870875320906822, 0.31783976820545506, 0.03162490418766264, 0.9487471256298791, 0.9475534113348657, 0.03657057088473753, 0.016878725023725012, 0.9423954804913132, 0.002813120837287502, 0.017144118019862604, 0.921496343567615, 0.04286029504965651, 0.012858088514896953, 0.12610597683391148, 0.12198486647986208, 0.14588730653334855, 0.6066274441160708, 0.9734223173055477, 0.9820560293280948, 0.04483325484919086, 0.9265539335499445, 0.01494441828306362, 0.5399404578481541, 0.20547608370751214, 0.15282472305118194, 0.10183286086826042, 0.9446035029448933, 0.9142572834556286, 0.028275998457390573, 0.03770133127652077, 0.02356333204782548, 0.849495718519766, 0.043906520283044086, 0.0973579362797934, 0.009544895713705237, 0.0174793538847056, 0.13188967022096043, 0.8390089864658689, 0.011123225199358109, 0.0450642741751539, 0.07210283868024624, 0.7525733787250701, 0.1306863951079463, 0.9428748388097856, 0.8757828924282883, 0.01162834884223073, 0.9418962562206892, 0.040053201567683626, 0.007752232561487153, 0.008187188209817902, 0.016374376419635805, 0.9742753969683303, 0.016021168498373567, 0.08971854359089197, 0.03845080439609656, 0.8555303978131484, 0.3668150379144755, 0.2841137432423833, 0.25004598878352735, 0.09896642209781681, 0.04080853349448145, 0.06412769549132799, 0.061212800241722175, 0.8365749366368697, 0.07759901648096204, 0.8503032294526265, 0.05788330545322576, 0.014281252218808976, 0.9749940945261958, 0.9646614726594582, 0.3972562097045375, 0.07334959427551102, 0.5004649308532654, 0.028560903965685704, 0.09133352577450693, 0.8412298426599322, 0.057684332068109634, 0.00961405534468494, 0.6240514066395019, 0.1975640131572292, 0.10929320187004862, 0.0691067535735164, 0.30189520337129155, 0.27061367325557745, 0.1769965849456404, 0.2505934939815204, 0.03268605676699014, 0.9478956462427142, 0.03513219420996149, 0.5509366819289416, 0.10273505276549345, 0.3111328411473105, 0.010889833072023136, 0.8984112284419087, 0.06533899843213882, 0.02722458268005784, 0.942690318188054], "Term": ["able", "able", "able", "able", "adventuredome", "adventuredome", "adventuredome", "adventuredome", "aladdin", "aladdin", "aladdin", "aladdin", "alaskan", "alaskan", "alaskan", "alaskan", "aloha", "aloha", "aloha", "aloha", "apa", "apa", "aria", "aria", "aria", "aria", "artisan", "artisan", "artisan", "artisan", "asian", "asian", "asian", "asian", "asparagus", "asparagus", "asparagus", "asparagus", "augustus", "augustus", "augustus", "augustus", "aurora", "awesome", "awesome", "awesome", "awesome", "bad", "bad", "bad", "bad", "balcony", "balcony", "balcony", "balcony", "bamboo", "bamboo", "bamboo", "bamboo", "beautiful", "beautiful", "beautiful", "beautiful", "bella", "best", "best", "best", "best", "big", "big", "big", "big", "bigelow", "bigelow", "bluegreen", "bluegreen", "bluegreen", "bluegreen", "bora", "bouchon", "bouchon", "bouchon", "boulevard", "boulevard", "boulevard", "boulevard", "brulee", "brulee", "brunch", "brunch", "brunch", "brunch", "buca", "buffet", "buffet", "buffet", "buffet", "cal", "cal", "cal", "cal", "canal", "canal", "canal", "canal", "castle", "castle", "castle", "castle", "cellar", "cellar", "cellar", "cellar", "chandelier", "chandelier", "chandelier", "chandelier", "cheap", "cheap", "cheap", "cheap", "cheese", "cheese", "cheese", "cheese", "chicken", "chicken", "chicken", "chicken", "chinese", "chinese", "chinese", "chinese", "circus", "circus", "circus", "circus", "clean", "clean", "clean", "clean", "comfortable", "comfortable", "comfortable", "comfortable", "congee", "coronado", "cortez", "cortez", "cortez", "cortez", "cosmo", "cosmo", "cosmo", "cosmo", "cosmopolitan", "cosmopolitan", "cosmopolitan", "cosmopolitan", "couch", "couch", "couch", "couch", "cpk", "crab", "crab", "crab", "crab", "creamy", "creamy", "creamy", "creamy", "criss", "criss", "criss", "criss", "decent", "decent", "decent", "decent", "delano", "delano", "delano", "delano", "delicious", "delicious", "delicious", "delicious", "dessert", "dessert", "dessert", "dessert", "different", "different", "different", "different", "dirty", "dirty", "dirty", "dirty", "dish", "dish", "dish", "dish", "dolphin", "dolphin", "dolphin", "dome", "dome", "dome", "dome", "downtown", "downtown", "downtown", "downtown", "dry", "dry", "dry", "dry", "eataly", "eataly", "eggslut", "egypt", "egypt", "egypt", "egyptian", "egyptian", "egyptian", "egyptian", "el", "el", "el", "el", "elara", "elara", "elara", "elara", "embassy", "embassy", "embassy", "embassy", "encore", "encore", "encore", "encore", "entree", "entree", "entree", "entree", "equestrian", "equestrian", "espa", "excalibur", "excalibur", "excalibur", "excalibur", "excellent", "excellent", "excellent", "excellent", "extra", "extra", "extra", "extra", "eyecandy", "eyecandy", "favorite", "favorite", "favorite", "favorite", "fiamma", "figs", "filthy", "filthy", "filthy", "filthy", "firelight", "first", "first", "first", "first", "fish", "fish", "fish", "fish", "flamingo", "flamingo", "flamingo", "flamingo", "flavorful", "flavorful", "flavorful", "flavorful", "foie", "foie", "fondant", "fondant", "forum", "forum", "forum", "forum", "free", "free", "free", "free", "freemont", "freemont", "freemont", "freemont", "fremont", "fremont", "fremont", "fremont", "fresh", "fresh", "fresh", "fresh", "fried", "fried", "fried", "fried", "friendly", "friendly", "friendly", "friendly", "front", "front", "front", "front", "full", "full", "full", "full", "fulton", "fulton", "galavantier", "galavantier", "garlic", "garlic", "garlic", "garlic", "golden", "golden", "golden", "golden", "gondola", "gondola", "gondolas", "good", "good", "good", "good", "gorgeous", "gorgeous", "gorgeous", "gorgeous", "grand", "grand", "grand", "grand", "grazie", "grazie", "great", "great", "great", "great", "gross", "gross", "gross", "gross", "hakkasan", "hakkasan", "hakkasan", "hakkasan", "hard", "hard", "hard", "hard", "harrah", "harrah", "harrah", "harrah", "harrahs", "harrahs", "harrahs", "harrahs", "hibachi", "high", "high", "high", "high", "holstein", "horrible", "horrible", "horrible", "horrible", "horseradish", "horseradish", "horseradish", "hot", "hot", "hot", "hot", "hrh", "hrh", "hrh", "hrh", "huge", "huge", "huge", "huge", "hugo", "hugo", "hugo", "hugo", "ihg", "ihg", "ihg", "imperial", "imperial", "imperial", "imperial", "ip", "ip", "ip", "ip", "italian", "italian", "italian", "italian", "kreme", "kreme", "krispy", "krispy", "krispy", "krispy", "lamb", "lamb", "lamb", "lamb", "large", "large", "large", "large", "last", "last", "last", "last", "lavo", "lavo", "lazy", "lazy", "lazy", "lazy", "lebanese", "leek", "legs", "legs", "legs", "legs", "linq", "linq", "linq", "linq", "little", "little", "little", "little", "lobster", "lobster", "lobster", "lobster", "longhorn", "longhorn", "longhorn", "loud", "loud", "loud", "loud", "low", "low", "low", "low", "lsi", "lsi", "luxor", "luxor", "luxor", "luxor", "luxurious", "luxurious", "luxurious", "luxurious", "lvh", "lvh", "lvh", "lvh", "mandarin", "mandarin", "mandarin", "mandarin", "manor", "manor", "manor", "manor", "many", "many", "many", "many", "marquee", "marquee", "marquee", "marquee", "meal", "meal", "meal", "meal", "medieval", "medieval", "medieval", "medieval", "mgm", "mgm", "mgm", "mgm", "midway", "midway", "midway", "mirage", "mirage", "mirage", "mirage", "modern", "modern", "modern", "modern", "momofuku", "monaco", "monaco", "monte", "monte", "monte", "monte", "mozen", "much", "much", "much", "much", "nasty", "nasty", "nasty", "nasty", "new", "new", "new", "new", "next", "next", "next", "next", "nice", "nice", "nice", "nice", "nightingale", "nirvana", "nirvana", "nirvana", "nlhe", "nlhe", "nobu", "nobu", "nobu", "nobu", "nomad", "nomad", "nomad", "nomad", "octavious", "octavious", "octavious", "octavious", "octavius", "octavius", "octavius", "octavius", "ok", "ok", "ok", "ok", "old", "old", "old", "old", "older", "older", "older", "older", "open", "open", "open", "open", "oriental", "oriental", "oriental", "oriental", "osso", "osso", "overall", "overall", "overall", "overall", "ox", "oxtail", "oxtail", "palazzo", "palazzo", "palazzo", "palazzo", "palms", "palms", "palms", "palms", "panoramic", "panoramic", "panoramic", "panoramic", "paris", "paris", "paris", "paris", "pasta", "pasta", "pasta", "pasta", "ph", "ph", "ph", "ph", "phantom", "phantom", "piazza", "piazza", "picasso", "picasso", "picasso", "picasso", "planet", "planet", "planet", "planet", "plaza", "plaza", "plaza", "plaza", "poached", "poached", "portuguese", "portuguese", "prestige", "prestige", "prestige", "prestige", "prime", "prime", "prime", "prime", "prizes", "prizes", "pyramid", "pyramid", "pyramid", "pyramid", "quad", "quad", "quad", "quad", "quail", "quiet", "quiet", "quiet", "quiet", "rabbit", "rabbit", "rabbit", "ready", "ready", "ready", "ready", "red", "red", "red", "red", "rehab", "rehab", "rehab", "rehab", "republic", "republic", "republic", "republic", "rialto", "rib", "rib", "rib", "rib", "right", "right", "right", "right", "riviera", "riviera", "riviera", "riviera", "roller", "rollercoaster", "rollercoaster", "roy", "roy", "roy", "roy", "salad", "salad", "salad", "salad", "salmon", "salmon", "salmon", "salmon", "sam", "sam", "sam", "sam", "sams", "santana", "santana", "santana", "sashimi", "sashimi", "sashimi", "saut\u00e9ed", "scallop", "scallop", "scary", "scary", "scary", "scary", "seafood", "seafood", "seafood", "seafood", "secret", "secret", "secret", "secret", "sectional", "sectional", "sectional", "sectional", "senor", "senor", "senor", "senor", "separate", "separate", "separate", "separate", "sexxy", "sexxy", "sexxy", "shaun", "shaun", "shaun", "shaun", "shellfish", "shellfish", "shellfish", "shibuya", "shower", "shower", "shower", "shower", "shrimp", "shrimp", "shrimp", "shrimp", "sideways", "sideways", "sideways", "sideways", "siegfried", "siegfried", "signature", "signature", "signature", "signature", "silverado", "silverado", "sleep", "sleep", "sleep", "sleep", "small", "small", "small", "small", "snapper", "sommelier", "sommelier", "sommelier", "sommelier", "sorbet", "sorbet", "sorbet", "south", "south", "south", "south", "southpoint", "southpoint", "southpoint", "spa", "spa", "spa", "spa", "spacious", "spacious", "spacious", "spacious", "special", "special", "special", "special", "sphinx", "stay", "stay", "stay", "stay", "steak", "steak", "steak", "steak", "stk", "stk", "stk", "straddle", "strat", "strat", "strat", "strat", "stratosphere", "stratosphere", "stratosphere", "stratosphere", "strip", "strip", "strip", "strip", "suite", "suite", "suite", "suite", "sunken", "sunken", "sunken", "sunken", "sure", "sure", "sure", "sure", "sushi", "sushi", "sushi", "sushi", "sushisamba", "table", "table", "table", "table", "tableside", "tableside", "tabu", "tahiti", "tahiti", "tahiti", "tahiti", "tao", "tao", "tao", "tao", "tasty", "tasty", "tasty", "tasty", "tavo", "teppanyaki", "terrace", "terrace", "terrace", "terrible", "terrible", "terrible", "terrible", "thunder", "titanic", "titanic", "titanic", "titanic", "tropicana", "tropicana", "tropicana", "tropicana", "trump", "trump", "trump", "trump", "tuscany", "tuscany", "tuscany", "tuscany", "ugupewqih0yiccg8anm1pa", "uph", "vdara", "vdara", "vdara", "vdara", "veal", "veal", "veal", "vegan", "vegan", "vegan", "vegan", "vegas", "vegas", "vegas", "vegas", "vegetarian", "vegetarian", "vegetarian", "vegetarian", "venetian", "venetian", "venetian", "venetian", "venezia", "venice", "west", "west", "west", "west", "westin", "westin", "westin", "westin", "worst", "worst", "worst", "worst", "worth", "worth", "worth", "worth", "wraparound", "wraparound", "wynn", "wynn", "wynn", "wynn", "xs", "xs", "xs", "xs", "yardbird"]}, "R": 30, "lambda.step": 0.01, "plot.opts": {"xlab": "PC1", "ylab": "PC2"}, "topic.order": [4, 1, 2, 3]};

function LDAvis_load_lib(url, callback){
  var s = document.createElement('script');
  s.src = url;
  s.async = true;
  s.onreadystatechange = s.onload = callback;
  s.onerror = function(){console.warn("failed to load library " + url);};
  document.getElementsByTagName("head")[0].appendChild(s);
}

if(typeof(LDAvis) !== "undefined"){
   // already loaded: just create the visualization
   !function(LDAvis){
       new LDAvis("#" + "ldavis_el1320814014550495448262675019", ldavis_el1320814014550495448262675019_data);
   }(LDAvis);
}else if(typeof define === "function" && define.amd){
   // require.js is available: use it to load d3/LDAvis
   require.config({paths: {d3: "https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min"}});
   require(["d3"], function(d3){
      window.d3 = d3;
      LDAvis_load_lib("https://cdn.rawgit.com/bmabey/pyLDAvis/files/ldavis.v1.0.0.js", function(){
        new LDAvis("#" + "ldavis_el1320814014550495448262675019", ldavis_el1320814014550495448262675019_data);
      });
    });
}else{
    // require.js not available: dynamically load d3 & LDAvis
    LDAvis_load_lib("https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js", function(){
         LDAvis_load_lib("https://cdn.rawgit.com/bmabey/pyLDAvis/files/ldavis.v1.0.0.js", function(){
                 new LDAvis("#" + "ldavis_el1320814014550495448262675019", ldavis_el1320814014550495448262675019_data);
            })
         });
}
</script></div></div>
</div>
<p>Unfortunately, since the dynamic user interface requires the notebook to be run before displaying, let us show a screenshot with the user interface in action, to get an example of how it behaves.</p>
<p><em>Screenshot image, since the pyLDAviz UI does not show without re-running the notebook:</em></p>
<p><img alt="Image of the LDA user interface" src="https://i.imgur.com/vxQa6Ei.png" /></p>
<p><em><strong>In order to view the above dynamic visualization “in action”, please find it on our website, with link <a class="reference external" href="https://hanlululu.github.io/SocialGraphYelp.io/Page3_Network.html">here</a>.</strong></em></p>
<p>After using the LDA algorithm to find 4 large topics, it can be observed that the topics do indeed have a number of similar words shown in wordclouds (which is created through Louvain for partitioning and TF-IDF for scoring).</p>
<p>For example, topic 4 presented here is clearly showing words related to food and dessert, such as: ‘<em>salad</em>’, ‘<em>steak</em>’ or ‘<em>buffet</em>’, which is very similar to the words shown in the wordcloud for community 2.</p>
<p>Since the bag of words used for LDA has not been cleaned by TF-IDF to remove commom words, some topics will share several words with little information power (such as ‘<em>great</em>’ or ‘<em>good</em>’).</p>
<p>The value of <span class="math notranslate nohighlight">\(\lambda\)</span>, which is used to compute the most relevant terms for each topic, has been set to 0.6, as research literature (<a class="reference external" href="https://nlp.stanford.edu/events/illvi2014/papers/sievert-illvi2014.pdf">Sievert &amp; Sherley, 2014</a>) mentions this to be “optimal value” for identifing topic keywords.</p>
<hr class="docutils" />
<p><a id='7.'></a></p>
</div>
<div class="section" id="looking-into-the-future">
<h1>7. Looking into the future<a class="headerlink" href="#looking-into-the-future" title="Permalink to this headline">¶</a></h1>
<p><a id='7.1.'></a></p>
<div class="section" id="finding-the-sentiment-trends">
<h2>7.1. Finding the sentiment trends<a class="headerlink" href="#finding-the-sentiment-trends" title="Permalink to this headline">¶</a></h2>
<p>Finally for our project, we are interested in understanding which hotels were given the most positive reviews and which hotels were performing poorest. Since there is a large set of reviews written by independent users, we can suggest that, by performing sentiment analysis upon the aggregated reviews for each hotel in part, we will be able to find the best hotels in Las Vegas.</p>
<p>Our sentiment analysis is dependent on an initial set of words which have sentiment scoring, used for comparing back to the words found in our reviews.</p>
<p>This happens to be one of major researches of Prof. <strong>Finn Årup Nielsen</strong>, researcher at DTU Compute, which created the <strong><a class="reference external" href="https://github.com/fnielsen/afinn">AFINN</a> dataset</strong>. AFINN is a list of words rated for sentimental valence, and scored on an integer scale between -5 (negative) and 5 (positive). Therefore, a completely neutral word or sentence would have a score of 0. This dataset has been updated several times throughout the years, with the latest update being in 2015. This is the dataset which we are using.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">afinn</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./AFINN-165.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">skiprows</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;word&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;sentiment_score&#39;</span><span class="p">})</span>

<span class="n">afinn</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>word</th>
      <th>sentiment_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>abandons</td>
      <td>-2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>abducted</td>
      <td>-2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>abduction</td>
      <td>-2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>abductions</td>
      <td>-2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>abhor</td>
      <td>-3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a dictionary containing the avg happiness score of each word from AFINN</span>

<span class="n">afinn_sentiment_score</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">afinn</span><span class="p">[</span><span class="s1">&#39;word&#39;</span><span class="p">],</span> <span class="n">afinn</span><span class="p">[</span><span class="s1">&#39;sentiment_score&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p>In order to compute sentiment score of each business or community, we create a function to realize the following steps:</p>
<ul class="simple">
<li><p>Extract words from reviews</p></li>
<li><p>Remove stopwords to minimize the influence of the most common words (which often do not indicate emotional feelings on purpose)</p></li>
<li><p>Use AFINN-165 sentiment score dictionary (as reference) to obtain the sentiment score of each word</p></li>
<li><p>Sum up the sentiment scores of each word shown in the review text and compute the average sentiment by dividing the number of words</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sentiment_score</span><span class="p">(</span><span class="n">reviews</span><span class="p">,</span> <span class="n">remove_stopwords</span><span class="p">,</span> <span class="n">sentiment_score</span> <span class="o">=</span> <span class="n">afinn_sentiment_score</span><span class="p">):</span>
    <span class="c1"># Create a dictionary for storing the sentiment score of each community or business</span>
    <span class="n">sentiment</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c1"># Get the set of stopwords</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">))</span>  
    
    <span class="c1"># For each community or business</span>
    <span class="k">for</span> <span class="n">comm</span> <span class="ow">in</span> <span class="n">reviews</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        
        <span class="c1"># Tokenize the original review, only extracting words and setting words to lowercase</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">word_tokenize</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[^a-zA-Z\s]&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">reviews</span><span class="p">[</span><span class="n">comm</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
          
        <span class="c1"># Remove stopwords</span>
        <span class="k">if</span> <span class="n">remove_stopwords</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop_words</span><span class="p">]</span>
            
        <span class="c1"># Create the sentiment list of each word in the word list which also has a sentiment score in LabMT, of each community or business</span>
        <span class="n">sentiments</span> <span class="o">=</span> <span class="p">[</span><span class="n">sentiment_score</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sentiment_score</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        
        <span class="c1"># Compute the average sentiment score and round it</span>
        <span class="n">avg_sentiment</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sentiments</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        
        <span class="c1">#  Store avg sentiment for each community or business</span>
        <span class="n">sentiment</span><span class="p">[</span><span class="n">comm</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_sentiment</span>
    
    <span class="k">return</span> <span class="n">sentiment</span>
</pre></div>
</div>
</div>
</div>
<p>Now we are able to calculate the sentiment score of each business/hotel:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">business_sentiment_without_stopwords</span> <span class="o">=</span> <span class="n">sentiment_score</span><span class="p">(</span><span class="n">business_reviews</span><span class="p">,</span> <span class="n">remove_stopwords</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">business_sentiment_with_stopwords</span> <span class="o">=</span> <span class="n">sentiment_score</span><span class="p">(</span><span class="n">business_reviews</span><span class="p">,</span> <span class="n">remove_stopwords</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sort business sentiment by its value for plotting histogram</span>

<span class="n">business_sentiment_without_stopwords_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">business_sentiment_without_stopwords</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">business_sentiment_with_stopwords_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">business_sentiment_with_stopwords</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We will plot the histogram of scores <strong>with</strong> and <strong>without</strong> stopwords, across all the hotels in Las Vegas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the histogram of sentiment scores over each hotel</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">sharex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">hist_without_stopwords</span><span class="p">,</span> <span class="n">bin_edge_without_stopwords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">business_sentiment_without_stopwords_sorted</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_edge_without_stopwords</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">hist_without_stopwords</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">hist_without_stopwords</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">drawstyle</span> <span class="o">=</span> <span class="s1">&#39;steps&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Sentiment histogram of hotels in Las Vegas (without stopwords)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number of hotels&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sentiment score&#39;</span><span class="p">)</span>

<span class="n">hist_with_stopwords</span><span class="p">,</span> <span class="n">bin_edge_with_stopwords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">business_sentiment_with_stopwords_sorted</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_edge_with_stopwords</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">hist_with_stopwords</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">hist_with_stopwords</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">drawstyle</span> <span class="o">=</span> <span class="s1">&#39;steps&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Sentiment histogram of hotels in Las Vegas (with stopwords)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number of hotels&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sentiment score&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Project_B_221_0.png" src="_images/Project_B_221_0.png" />
</div>
</div>
<p>From the histogram of sentiment-score distribution over hotels, it can be noticed that the sentiment scores are ranging between <span class="math notranslate nohighlight">\((-1.5, 2.5)\)</span> and follow a positively skewed distribution, which indicates that the overall distribution of all hotels is slightly emotionally positive.</p>
<p>Also, we are able to observe that the sentiment-score distribution of the diagram <strong>‘without stopwords’</strong> seems to spread out slightly more than <strong>‘with stopwords’</strong>, which is a consequence of the fact that the stopwords are often neutral. However, in general, these two cases are following a similar trend in terms of distribution shape, therefore <strong>only the version with stopwords will be considered in the subsequent analysis</strong>, so as to guarantee the accuracy of sentiment scores.</p>
<p>Next, let us look at the “best and worst” hotels, meaning the hotels where the sentiment scores are most positive or most negative:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add sentiment score to business_df</span>
<span class="n">business_df</span><span class="p">[</span><span class="s1">&#39;sentiment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">business_df</span><span class="p">[</span><span class="s1">&#39;business_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">business_sentiment_with_stopwords</span><span class="p">)</span>  
</pre></div>
</div>
</div>
</div>
<p>In our dataset, there already is an aggregate “rating” score (from 1 to 5) corresponding to the average of the number of stars that a hotel accumulated across all its user reviews.</p>
<p>We would like to try and understand if there is any relationship between the sentiment scores we find and the ratings of such hotels:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Sort the sentiment score dictionary of businesses by value from highest to lowest and pick top 10</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">business_sentiment_with_stopwords</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;#</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> - Sentiment: </span><span class="si">{}</span><span class="s1">, Rating: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> 
                                                      <span class="n">business_df</span><span class="p">[</span><span class="n">business_df</span><span class="o">.</span><span class="n">business_id</span> <span class="o">==</span> <span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                                      <span class="n">value</span><span class="p">,</span> 
                                                      <span class="n">business_df</span><span class="p">[</span><span class="n">business_df</span><span class="o">.</span><span class="n">business_id</span> <span class="o">==</span> <span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">stars</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>#1 Roberta&#39;s Steakhouse - Sentiment: 2.471, Rating: 4.5
#2 Team Kaizen - Sentiment: 2.303, Rating: 5.0
#3 Sands Hotel - Sentiment: 2.25, Rating: 4.5
#4 Fortunes - Sentiment: 2.2, Rating: 3.5
#5 Jennifer Romas&#39; Sexxy - Sentiment: 2.087, Rating: 4.5
#6 Star Motel - Sentiment: 2.067, Rating: 4.5
#7 Lip Smacking Foodie Tours - Sentiment: 2.053, Rating: 5.0
#8 Venetian Casino Grazie Club Gold Room - Sentiment: 2.033, Rating: 4.0
#9 Las Vegas Strip Trips - Sentiment: 2.027, Rating: 5.0
#10 HGVClub - Sentiment: 1.941, Rating: 4.5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># Sort the sentiment score dictionary of businesses by value from highest to lowest and pick top 10</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">business_sentiment_with_stopwords</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;#</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> - Sentiment: </span><span class="si">{}</span><span class="s1">, Rating: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>
                                                      <span class="n">business_df</span><span class="p">[</span><span class="n">business_df</span><span class="o">.</span><span class="n">business_id</span> <span class="o">==</span> <span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                                      <span class="n">value</span><span class="p">,</span> 
                                                      <span class="n">business_df</span><span class="p">[</span><span class="n">business_df</span><span class="o">.</span><span class="n">business_id</span> <span class="o">==</span> <span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">stars</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>#1 Exotic Escapes - Sentiment: -1.364, Rating: 1.0
#2 Umpire - Sentiment: -1.222, Rating: 1.0
#3 Siegel Suites - Sentiment: -1.091, Rating: 2.0
#4 Las Vegas Villa - Sentiment: -0.962, Rating: 2.0
#5 Holiday Motel - Sentiment: -0.926, Rating: 1.5
#6 Desert Star Motel - Sentiment: -0.907, Rating: 1.5
#7 Holiday House Holiday Motel - Sentiment: -0.741, Rating: 2.0
#8 Lamplighter Motel - Sentiment: -0.72, Rating: 1.0
#9 Siegel Suites Bonanza - Sentiment: -0.706, Rating: 1.0
#10 Sahara Westwood Hotel - Sentiment: -0.697, Rating: 1.0
</pre></div>
</div>
</div>
</div>
<p>It can be clearly seen that hotels with most positive sentiment scores are also rated relatively high, and vice versa, which shows consistency between sentiment scores and rating scores.</p>
<p>When it comes to the communities, there are many possible discussions regarding sentiment score, however here, we will be interested in showing what each community’s overall sentiment is.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">community_sentiment_with_stopwords</span> <span class="o">=</span> <span class="n">sentiment_score</span><span class="p">(</span><span class="n">community_reviews</span><span class="p">,</span> <span class="n">remove_stopwords</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">community_sentiment_with_stopwords</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{0: 0.63, 1: 0.369, 2: 0.932, 3: 0.928}
</pre></div>
</div>
</div>
</div>
<p>Since we already have looked at the community wordclouds in a previous section, we can see that the results fall very well in line with our findings: community nr. 1 was the community which contained most top keywords as negative or inappropriate words, such as ‘<em>immature</em>’, ‘<em>disaster</em>’ or ‘<em>strip</em>’.</p>
<p>As it can be noted, the overall community score is not very far from neutral, since the number of reviews for each community is very large, and therefore strong sentiments on either positive or negative scales ‘cancel out’, and the general trend becomes almost-neutral.</p>
<p><a id='7.2.'></a></p>
</div>
<div class="section" id="temporal-sentiment-geomapping">
<h2>7.2. Temporal sentiment geomapping<a class="headerlink" href="#temporal-sentiment-geomapping" title="Permalink to this headline">¶</a></h2>
<p>Now that we have identified the general sentiment trends across our Yelp Hotels dataset, it is important to also link these sentiments to the geo-temporal dimension that our dataset comes from. In other words, we know that each hotel is located at a specific (latitude, longitude) location, and that every review has been written at a certain date and hour in time.</p>
<p>We will use these two dimensions to analyze an interactive geo-map, where we position the hotels according to their location on the map, and their sentiment scores in the time domain will dictate the color of their node.</p>
<p>The following two cases are considered:</p>
<ol class="simple">
<li><p>Seasonal temporal map, where we will check if sentiment scores change based on the year quarter (<em>e.g. Q1 - January to March, etc.</em>) in which they were written;</p></li>
<li><p>Time-of-day temporal map, where we will check the trend of sentiment scores across the 5 different times of day during which they were written (morning, noon, afternoon, evening, night);</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert date object to datetime type</span>
<span class="n">business_review_df</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">business_review_df</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function for split date into quarters</span>
<span class="k">def</span> <span class="nf">quarter</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="c1"># Q1</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">month</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Q1&#39;</span>
    <span class="c1"># Q2</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">month</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Q2&#39;</span>
    <span class="c1"># Q3</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">month</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Q3&#39;</span>
    <span class="c1"># Q4</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">month</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Q4&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function for split date into quarters</span>
<span class="k">def</span> <span class="nf">hour</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="c1"># Midnight</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Night&#39;</span>
    <span class="c1"># Morning</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Morning&#39;</span>
    <span class="c1"># Noon</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&gt;=</span> <span class="mi">11</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Noon&#39;</span>   
    <span class="c1"># Afternoon</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Afternoon&#39;</span>  
    <span class="c1"># Night</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&lt;=</span> <span class="mi">23</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Evening&#39;</span>      
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">business_review_df</span><span class="p">[</span><span class="s1">&#39;quarter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">business_review_df</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">quarter</span><span class="p">)</span>
<span class="n">business_review_df</span><span class="p">[</span><span class="s1">&#39;day_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">business_review_df</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id='7.2.1.'></a></p>
<div class="section" id="geomap-of-the-overall-sentiment-score">
<h3>7.2.1.  Geomap of the overall sentiment score<a class="headerlink" href="#geomap-of-the-overall-sentiment-score" title="Permalink to this headline">¶</a></h3>
<p>This first geomap is showing the overall sentiments across each hotel in Las Vegas. This visualization does not take into account any temporal domain separation, and is included as a baseline reference of how the Las Vegas landscape looks like, in terms of sentiment analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_all_sentiment</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">business_df</span><span class="p">,</span>
                                      <span class="n">lat</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span>
                                      <span class="n">lon</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span>
                                      <span class="n">hover_name</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> 
                                      <span class="n">hover_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;top_keywords&#39;</span><span class="p">],</span>
                                      <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;sentiment&#39;</span><span class="p">,</span> 
                                      <span class="n">color_continuous_scale</span> <span class="o">=</span> <span class="s1">&#39;balance&#39;</span><span class="p">,</span> 
                                      <span class="n">size</span> <span class="o">=</span> <span class="s1">&#39;review_count&#39;</span><span class="p">,</span> 
                                      <span class="n">zoom</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                                      <span class="n">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>

<span class="n">fig_all_sentiment</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">mapbox_style</span><span class="o">=</span><span class="s1">&#39;carto-positron&#39;</span><span class="p">)</span>
<span class="n">fig_all_sentiment</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

<span class="c1"># fig_all_sentiment.show()</span>
</pre></div>
</div>
</div>
</div>
<p><em>Screenshot image, since the Plotly interactive graph does not show without re-running the notebook:</em></p>
<p><img alt="Image of overall sentiment geo-map" src="https://i.imgur.com/e3hLZM4.png" /></p>
<p><em><strong>In order to view the above dynamic visualization “in action”, please find it on our website, with link <a class="reference external" href="https://hanlululu.github.io/SocialGraphYelp.io/Page4_Sentiment.html">here</a>.</strong></em></p>
<p>As we can see, most hotels have a slighly positive experience rating, with the ones in the center of the city being more inclined to have a better overall score, while the perifery of the city shows some hotels with a rather neutral outlook.</p>
<p><a id='7.2.2.'></a></p>
</div>
<div class="section" id="seasonal-temporal-map-based-on-yearly-quarters">
<h3>7.2.2. Seasonal temporal map (based on yearly quarters)<a class="headerlink" href="#seasonal-temporal-map-based-on-yearly-quarters" title="Permalink to this headline">¶</a></h3>
<p>For our second geomap, we will compute sentiment scores of businesses in each quarter of year, to see if there is any variation between seasons. Based on the segmentation of time, now it is possible to compute the sentiment score for every hotel during each time-period:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">temporal_sentiment</span><span class="p">(</span><span class="n">business_review_df</span><span class="p">,</span> <span class="n">business_df</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;quarter&#39;</span><span class="p">:</span>
        <span class="c1"># For each quarter</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">business_review_df</span><span class="o">.</span><span class="n">quarter</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            
            <span class="c1">#  Filter the business_review_df according to specific quarter</span>
            <span class="n">business_review_quarter_df</span> <span class="o">=</span> <span class="n">business_review_df</span><span class="p">[</span><span class="n">business_review_df</span><span class="o">.</span><span class="n">quarter</span> <span class="o">==</span> <span class="n">q</span><span class="p">]</span>
            
            <span class="c1">#  Combine reviews of each business</span>
            <span class="n">business_reviews_quarter</span> <span class="o">=</span> <span class="n">reviews</span><span class="p">(</span><span class="n">df</span> <span class="o">=</span> <span class="n">business_review_quarter_df</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;business&#39;</span><span class="p">)</span>
            
            <span class="c1"># Compute the sentiment score dictionary of each business in a quarter</span>
            <span class="n">business_sentiment_quarter</span> <span class="o">=</span> <span class="n">sentiment_score</span><span class="p">(</span><span class="n">business_reviews_quarter</span><span class="p">,</span> <span class="n">remove_stopwords</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            
            <span class="c1">#  Add sentiment dictionary of each quarter as a column to business_df</span>
            <span class="n">business_df</span><span class="p">[</span><span class="s1">&#39;sentiment_&#39;</span><span class="o">+</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">business_df</span><span class="p">[</span><span class="s1">&#39;business_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">business_sentiment_quarter</span><span class="p">)</span>     
            <span class="n">business_df</span><span class="p">[</span><span class="s1">&#39;sentiment_&#39;</span><span class="o">+</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">business_df</span><span class="p">[</span><span class="s1">&#39;sentiment_&#39;</span><span class="o">+</span><span class="n">q</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;day_time&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">business_review_df</span><span class="o">.</span><span class="n">day_time</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            
            <span class="c1">#  Filter the business_review_df according to specific day time</span>
            <span class="n">business_review_hour_df</span> <span class="o">=</span> <span class="n">business_review_df</span><span class="p">[</span><span class="n">business_review_df</span><span class="o">.</span><span class="n">day_time</span> <span class="o">==</span> <span class="n">time</span><span class="p">]</span>
            
            <span class="c1">#  Combine reviews of each business</span>
            <span class="n">business_reviews_hour</span> <span class="o">=</span> <span class="n">reviews</span><span class="p">(</span><span class="n">df</span> <span class="o">=</span> <span class="n">business_review_hour_df</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;business&#39;</span><span class="p">)</span>
            
            <span class="c1"># Compute the sentiment score dictionary of each business within a certain day time</span>
            <span class="n">business_sentiment_hour</span> <span class="o">=</span> <span class="n">sentiment_score</span><span class="p">(</span><span class="n">business_reviews_hour</span><span class="p">,</span> <span class="n">remove_stopwords</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            
            <span class="c1">#  Add sentiment dictionary of each day time as a column to business_df</span>
            <span class="n">business_df</span><span class="p">[</span><span class="s1">&#39;sentiment_&#39;</span><span class="o">+</span><span class="n">time</span><span class="p">]</span> <span class="o">=</span> <span class="n">business_df</span><span class="p">[</span><span class="s1">&#39;business_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">business_sentiment_hour</span><span class="p">)</span>
            <span class="n">business_df</span><span class="p">[</span><span class="s1">&#39;sentiment_&#39;</span><span class="o">+</span><span class="n">time</span><span class="p">]</span> <span class="o">=</span> <span class="n">business_df</span><span class="p">[</span><span class="s1">&#39;sentiment_&#39;</span><span class="o">+</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">return</span>  <span class="n">business_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">business_df</span> <span class="o">=</span> <span class="n">temporal_sentiment</span><span class="p">(</span><span class="n">business_review_df</span> <span class="o">=</span> <span class="n">business_review_df</span><span class="p">,</span> <span class="n">business_df</span> <span class="o">=</span> <span class="n">business_df</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;quarter&#39;</span><span class="p">)</span>
<span class="n">business_df</span> <span class="o">=</span> <span class="n">temporal_sentiment</span><span class="p">(</span><span class="n">business_review_df</span> <span class="o">=</span> <span class="n">business_review_df</span><span class="p">,</span> <span class="n">business_df</span> <span class="o">=</span> <span class="n">business_df</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;day_time&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot sentiment geomaps of different quarters of year</span>
<span class="n">fig_quarter</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">business_df</span><span class="p">,</span> 
                                <span class="n">lat</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span>
                                <span class="n">lon</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span>
                                <span class="n">hover_name</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> 
                                <span class="n">hover_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;top_keywords&#39;</span><span class="p">],</span>
                                <span class="n">color</span> <span class="o">=</span>  <span class="s1">&#39;sentiment_Q1&#39;</span><span class="p">,</span>
                                <span class="n">color_continuous_scale</span> <span class="o">=</span> <span class="s1">&#39;balance&#39;</span><span class="p">,</span> 
                                <span class="n">size</span> <span class="o">=</span> <span class="s1">&#39;review_count&#39;</span><span class="p">,</span> 
                                <span class="n">zoom</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                                <span class="n">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>

<span class="n">fig_quarter</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">business_df</span><span class="p">,</span>
                                        <span class="n">lat</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span>
                                        <span class="n">lon</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span>
                                        <span class="n">hover_name</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> 
                                        <span class="n">hover_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;top_keywords&#39;</span><span class="p">],</span>
                                        <span class="n">color</span> <span class="o">=</span>  <span class="s1">&#39;sentiment_Q2&#39;</span><span class="p">,</span>
                                        <span class="n">color_continuous_scale</span> <span class="o">=</span> <span class="s1">&#39;balance&#39;</span><span class="p">,</span> 
                                        <span class="n">size</span> <span class="o">=</span> <span class="s1">&#39;review_count&#39;</span><span class="p">,</span> 
                                        <span class="n">zoom</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                                        <span class="n">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">fig_quarter</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">business_df</span><span class="p">,</span>
                                        <span class="n">lat</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span>
                                        <span class="n">lon</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span>
                                        <span class="n">hover_name</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> 
                                        <span class="n">hover_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;top_keywords&#39;</span><span class="p">],</span>
                                        <span class="n">color</span> <span class="o">=</span>  <span class="s1">&#39;sentiment_Q3&#39;</span><span class="p">,</span>
                                        <span class="n">color_continuous_scale</span> <span class="o">=</span> <span class="s1">&#39;balance&#39;</span><span class="p">,</span> 
                                        <span class="n">size</span> <span class="o">=</span> <span class="s1">&#39;review_count&#39;</span><span class="p">,</span> 
                                        <span class="n">zoom</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                                        <span class="n">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">fig_quarter</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">business_df</span><span class="p">,</span>
                                        <span class="n">lat</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span>
                                        <span class="n">lon</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span>
                                        <span class="n">hover_name</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> 
                                        <span class="n">hover_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;top_keywords&#39;</span><span class="p">],</span>
                                        <span class="n">color</span> <span class="o">=</span>  <span class="s1">&#39;sentiment_Q4&#39;</span><span class="p">,</span>
                                        <span class="n">color_continuous_scale</span> <span class="o">=</span> <span class="s1">&#39;balance&#39;</span><span class="p">,</span> 
                                        <span class="n">size</span> <span class="o">=</span> <span class="s1">&#39;review_count&#39;</span><span class="p">,</span> 
                                        <span class="n">zoom</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                                        <span class="n">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Add button</span>
<span class="n">updatemenus</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;buttons&quot;</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span><span class="p">,</span>
                    <span class="n">buttons</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span>
                        <span class="nb">dict</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span> <span class="s1">&#39;type&#39;</span><span class="p">],</span>
                             <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q1&quot;</span><span class="p">,</span> 
                             <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">),</span>

                        <span class="nb">dict</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span> <span class="s1">&#39;type&#39;</span><span class="p">],</span>
                             <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q2&quot;</span><span class="p">,</span> 
                             <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">),</span>
                                   
                        <span class="nb">dict</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span> <span class="s1">&#39;type&#39;</span><span class="p">],</span>
                            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q3&quot;</span><span class="p">,</span> 
                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">),</span>
                                   
                        <span class="nb">dict</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]},</span> <span class="s1">&#39;type&#39;</span><span class="p">],</span>
                            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q4&quot;</span><span class="p">,</span> 
                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>
                    <span class="p">]))]</span>


<span class="n">fig_quarter</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">updatemenus</span> <span class="o">=</span> <span class="n">updatemenus</span><span class="p">,</span>
                         <span class="n">legend_title_text</span> <span class="o">=</span> <span class="s1">&#39;Sentiment score over year quarters&#39;</span><span class="p">)</span>
<span class="n">fig_quarter</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">mapbox_style</span> <span class="o">=</span> <span class="s1">&#39;carto-positron&#39;</span><span class="p">)</span>
<span class="n">fig_quarter</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

<span class="c1"># fig_quarter.show()</span>
</pre></div>
</div>
</div>
</div>
<p><em>Screenshot image, since the Plotly interactive graph does not show without re-running the notebook:</em></p>
<p><img alt="Image of the seasonal temporal map" src="https://i.imgur.com/DdXgpbk.png" /></p>
<p><em><strong>In order to view the above dynamic visualization “in action”, please find it on our website, with link <a class="reference external" href="https://hanlululu.github.io/SocialGraphYelp.io/Page4_Sentiment.html">here</a>.</strong></em></p>
<p>Based on the interactive <em><strong><code class="docutils literal notranslate"><span class="pre">plotly</span></code></strong></em> visualization above, we can identify that most positive sentiment scores are given in Q1 of the year, meaning in the months between January &amp; March (inclusive), while the lowest sentiment scores can be found from reviews written in the Q3 period of the year (meaning in the months of July, August &amp; September).</p>
<p>It seems that this behavior is in connection with the both the higher tourist expectations, who generally arrive in the summer months, as well as the increased crime rate during the summertime (statistics found from US journalism house: <a class="reference external" href="https://www.governing.com/topics/public-justice-safety/gov-summer-crime-rates-increases-police.html">report here</a>).</p>
<p><a id='7.2.3.'></a></p>
</div>
<div class="section" id="time-of-day-temporal-map">
<h3>7.2.3. Time-of-day temporal map<a class="headerlink" href="#time-of-day-temporal-map" title="Permalink to this headline">¶</a></h3>
<p>Our final geomap refers to the sentiment scores received by reviews, grouped by the time of day during which they were written. We are interested in seeing if there is any change between the different periods of a day during which a review is submitted. For that, we will again compute sentiment scores of businesses for each time of day individually, and use an interactive <em><strong><code class="docutils literal notranslate"><span class="pre">plotly</span></code></strong></em> visualization to show the differences in scores as changing node colors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot sentiment geomaps of different parts of day</span>
<span class="n">fig_day</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">business_df</span><span class="p">,</span> 
                            <span class="n">lat</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span>
                            <span class="n">lon</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span>
                            <span class="n">hover_name</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> 
                            <span class="n">hover_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;top_keywords&#39;</span><span class="p">],</span>
                            <span class="n">color</span> <span class="o">=</span>  <span class="s1">&#39;sentiment_Morning&#39;</span><span class="p">,</span>
                            <span class="n">color_continuous_scale</span> <span class="o">=</span> <span class="s1">&#39;balance&#39;</span><span class="p">,</span> 
                            <span class="n">size</span> <span class="o">=</span> <span class="s1">&#39;review_count&#39;</span><span class="p">,</span> 
                            <span class="n">zoom</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                            <span class="n">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>

<span class="n">fig_day</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">business_df</span><span class="p">,</span>
                                    <span class="n">lat</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span>
                                    <span class="n">lon</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span>
                                    <span class="n">hover_name</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> 
                                    <span class="n">hover_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;top_keywords&#39;</span><span class="p">],</span>
                                    <span class="n">color</span> <span class="o">=</span>  <span class="s1">&#39;sentiment_Noon&#39;</span><span class="p">,</span>
                                    <span class="n">color_continuous_scale</span> <span class="o">=</span> <span class="s1">&#39;balance&#39;</span><span class="p">,</span> 
                                    <span class="n">size</span> <span class="o">=</span> <span class="s1">&#39;review_count&#39;</span><span class="p">,</span> 
                                    <span class="n">zoom</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                                    <span class="n">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">fig_day</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">business_df</span><span class="p">,</span>
                                    <span class="n">lat</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span>
                                    <span class="n">lon</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span>
                                    <span class="n">hover_name</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> 
                                    <span class="n">hover_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;top_keywords&#39;</span><span class="p">],</span>
                                    <span class="n">color</span> <span class="o">=</span>  <span class="s1">&#39;sentiment_Afternoon&#39;</span><span class="p">,</span>
                                    <span class="n">color_continuous_scale</span> <span class="o">=</span> <span class="s1">&#39;balance&#39;</span><span class="p">,</span> 
                                    <span class="n">size</span> <span class="o">=</span> <span class="s1">&#39;review_count&#39;</span><span class="p">,</span> 
                                    <span class="n">zoom</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                                    <span class="n">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">fig_day</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">business_df</span><span class="p">,</span>
                                    <span class="n">lat</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span>
                                    <span class="n">lon</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span>
                                    <span class="n">hover_name</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> 
                                    <span class="n">hover_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;top_keywords&#39;</span><span class="p">],</span>
                                    <span class="n">color</span> <span class="o">=</span>  <span class="s1">&#39;sentiment_Evening&#39;</span><span class="p">,</span>
                                    <span class="n">color_continuous_scale</span> <span class="o">=</span> <span class="s1">&#39;balance&#39;</span><span class="p">,</span> 
                                    <span class="n">size</span> <span class="o">=</span> <span class="s1">&#39;review_count&#39;</span><span class="p">,</span> 
                                    <span class="n">zoom</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                                    <span class="n">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">fig_day</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">business_df</span><span class="p">,</span>
                                    <span class="n">lat</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span>
                                    <span class="n">lon</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span>
                                    <span class="n">hover_name</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> 
                                    <span class="n">hover_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;top_keywords&#39;</span><span class="p">],</span>
                                    <span class="n">color</span> <span class="o">=</span>  <span class="s1">&#39;sentiment_Night&#39;</span><span class="p">,</span>
                                    <span class="n">color_continuous_scale</span> <span class="o">=</span> <span class="s1">&#39;balance&#39;</span><span class="p">,</span> 
                                    <span class="n">size</span> <span class="o">=</span> <span class="s1">&#39;review_count&#39;</span><span class="p">,</span> 
                                    <span class="n">zoom</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                                    <span class="n">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Add button</span>
<span class="n">updatemenus</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;buttons&quot;</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span><span class="p">,</span>
                    <span class="n">buttons</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span>
                        <span class="nb">dict</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span> <span class="s1">&#39;type&#39;</span><span class="p">],</span>
                             <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Morning&quot;</span><span class="p">,</span> 
                             <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">),</span>
                        
                        <span class="nb">dict</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span> <span class="s1">&#39;type&#39;</span><span class="p">],</span>
                             <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Noon&quot;</span><span class="p">,</span> 
                             <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">),</span>
                                   
                        <span class="nb">dict</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span> <span class="s1">&#39;type&#39;</span><span class="p">],</span>
                             <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Afternoon&quot;</span><span class="p">,</span> 
                             <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">),</span>
                                   
                        <span class="nb">dict</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span> <span class="s1">&#39;type&#39;</span><span class="p">],</span>
                             <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Evening&quot;</span><span class="p">,</span> 
                             <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">),</span>
                                   
                        <span class="nb">dict</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]},</span> <span class="s1">&#39;type&#39;</span><span class="p">],</span>
                             <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Night&quot;</span><span class="p">,</span> 
                             <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>
                    <span class="p">]))]</span>


<span class="n">fig_day</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">updatemenus</span> <span class="o">=</span> <span class="n">updatemenus</span><span class="p">,</span>
                         <span class="n">legend_title_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">fig_day</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">mapbox_style</span><span class="o">=</span><span class="s1">&#39;carto-positron&#39;</span><span class="p">)</span>
<span class="n">fig_day</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

<span class="n">fig_day</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><em>Screenshot image, since the Plotly interactive graph does not show without re-running the notebook:</em></p>
<p><img alt="Image of the time-of-day temporal map" src="https://i.imgur.com/DYEAHeH.png" /></p>
<p><em><strong>In order to view the above dynamic visualization “in action”, please find it on our website, with link <a class="reference external" href="https://hanlululu.github.io/SocialGraphYelp.io/Page4_Sentiment.html">here</a>.</strong></em></p>
<p>Through understanding the geomap above, we can clearly see that the least-positive reviews are written during the morning time (between 06:00 AM and 11:00 AM), with almost no hotel at all received an aggregated sentiment score above 1 (out of max. +5). In contrast, reviews written during the evening are the most positive, with aggregated sentiments for the same hotel crossing above the 1.00 score mark, and, for the best hotels, averaging around 1.7-1.8 in total. Reviews posted during the afternoon or nighttime seem to be more neutral than during the evening, however still manage to cross the borderline 0.00 score.</p>
<p>In general, this clearly shows a trend in the review-posting behavior of users, and by clicking the buttons of the visualization, one can get a quick overview that this trend is applicable across the vast majority of the hotels, making it a temporal trend effect (rather than localized behaviour of a specific hotel).</p>
<p><a id='8.'></a></p>
</div>
</div>
</div>
<div class="section" id="discussion">
<h1>8. Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¶</a></h1>
<p>The project was completed successfully, with a good learning curve in terms of network visualizations, topic modelling, as well as NLP and graph theory. Interactive visualizations and maps were very useful for discovering trends in the data, and the temporal discussion of the sentiment scores (at the end of the project) was one of the most interesting parts to think about and try to unravel in ideas.</p>
<p>At the same time, it was slightly challenging to see that some of the interactive tools we were trying to use could not save their state without rerunning, when sharing the notebook further to others. That is something that it is good to take into consideration, however we have solved the problem by creating an interactive website for the dynamic visualizations, as well as posting static screenshots for reference.</p>
<p>One potential suggestion for further research is to take the network of users into consideration as well, so that businesses are connected indirectly by the users who commonly review them, thereby creating a bipartite-like network structure.</p>
<p><a id='9.'></a></p>
</div>
<div class="section" id="contributions">
<h1>9. Contributions<a class="headerlink" href="#contributions" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><em>Website creation and setup: <strong>Hanlu</strong></em></p></li>
<li><p><em>Part 1: Introduction and Motivation: ****</em></p></li>
<li><p><em>Part 2: Dataset segmentation and cleaning: ****</em></p></li>
<li><p><em>Part 3: Descriptive statistics about the dataset: ****</em></p></li>
<li><p><em>Part 4: Keyword detection using TF-IDF: ****</em></p></li>
<li><p><em>Part 5: Network Analysis upon the Yelp hotel dataset: ****</em></p></li>
<li><p><em>Part 6: Topic detection using LDA: ****</em></p></li>
<li><p><em>Part 7: Sentiment Analysis upon the hotel reviews: ****</em></p></li>
<li><p><em>Part 8: Discussion: ****</em></p></li>
</ul>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Kathrine, David, Hanlu<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>